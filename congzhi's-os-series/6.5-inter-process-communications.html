<!DOCTYPE html> <html><head>
		<title>6.5 Inter-Process Communications</title>
		<base href="../">
		<meta id="root-path" root-path="../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="Congzhi's Notes Vault - 6.5 Inter-Process Communications">
		<meta property="og:title" content="6.5 Inter-Process Communications">
		<meta property="og:description" content="Congzhi's Notes Vault - 6.5 Inter-Process Communications">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://congzhi.wiki/congzhi's-os-series/6.5-inter-process-communications.html">
		<meta property="og:image" content="https://congzhi.wiki/congzhi's-os-series/pics/pasted-image-20241130023253.jpg">
		<meta property="og:site_name" content="Congzhi's Notes Vault">
		<meta name="author" content="Congzhi"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://congzhi.wiki/lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-light show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles">mjx-munder{display:inline-block;text-align:left}mjx-over{text-align:left}mjx-munder:not([limits=false]){display:inline-table}mjx-munder>mjx-row{text-align:left}mjx-under{padding-bottom:.1em}mjx-c.mjx-c5C::before{padding:.75em .5em .25em 0;content:"\\"}mjx-msqrt{display:inline-block;text-align:left}mjx-root{display:inline-block;white-space:nowrap}mjx-surd{display:inline-block;vertical-align:top}mjx-sqrt{display:inline-block;padding-top:.07em}mjx-sqrt>mjx-box{border-top:.07em solid}mjx-sqrt.mjx-tall>mjx-box{padding-left:.3em;margin-left:-.3em}mjx-c.mjx-c221A::before{padding:.8em .853em .2em 0;content:"âˆš"}mjx-c.mjx-c2061::before{padding:0;content:""}mjx-c.mjx-c1D442.TEX-I::before{padding:.704em .763em .022em 0;content:"O"}mjx-c.mjx-c4B::before{padding:.683em .778em 0 0;content:"K"}mjx-c.mjx-c46::before{padding:.68em .653em 0 0;content:"F"}mjx-c.mjx-c7A::before{padding:.431em .444em 0 0;content:"z"}mjx-c.mjx-cD7::before{padding:.491em .778em 0 0;content:"Ã—"}mjx-c.mjx-c4D::before{padding:.683em .917em 0 0;content:"M"}mjx-c.mjx-c1D43A.TEX-I::before{padding:.705em .786em .022em 0;content:"G"}mjx-c.mjx-c70::before{padding:.442em .556em .194em 0;content:"p"}mjx-c.mjx-cB1::before{padding:.666em .778em 0 0;content:"Â±"}mjx-c.mjx-c5F::before{padding:0 .5em .062em 0;content:"_"}mjx-mtable{display:inline-block;text-align:center;vertical-align:.25em;position:relative;box-sizing:border-box;border-spacing:0px;border-collapse:collapse}mjx-mstyle[size="s"] mjx-mtable{vertical-align:.354em}mjx-labels{position:absolute;left:0;top:0}mjx-table{display:inline-block;vertical-align:-.5ex;box-sizing:border-box}mjx-table>mjx-itable{vertical-align:middle;text-align:left;box-sizing:border-box}mjx-labels>mjx-itable{position:absolute;top:0}mjx-mtable[justify=left]{text-align:left}mjx-mtable[justify=right]{text-align:right}mjx-mtable[justify=left][side=left]{padding-right:0!important}mjx-mtable[justify=left][side=right]{padding-left:0!important}mjx-mtable[justify=right][side=left]{padding-right:0!important}mjx-mtable[justify=right][side=right]{padding-left:0!important}mjx-mtable[align]{vertical-align:baseline}mjx-mtable[align=top]>mjx-table{vertical-align:top}mjx-mtable[align=bottom]>mjx-table{vertical-align:bottom}mjx-mtable[side=right] mjx-labels{min-width:100%}mjx-mtr{display:table-row;text-align:left}mjx-mtr[rowalign=top]>mjx-mtd{vertical-align:top}mjx-mtr[rowalign=center]>mjx-mtd{vertical-align:middle}mjx-mtr[rowalign=bottom]>mjx-mtd{vertical-align:bottom}mjx-mtr[rowalign=baseline]>mjx-mtd{vertical-align:baseline}mjx-mtr[rowalign=axis]>mjx-mtd{vertical-align:.25em}mjx-mtd{display:table-cell;text-align:center;padding:.215em .4em}mjx-mtd:first-child{padding-left:0}mjx-mtd:last-child{padding-right:0}mjx-mtable>*>mjx-itable>:first-child>mjx-mtd{padding-top:0}mjx-mtable>*>mjx-itable>:last-child>mjx-mtd{padding-bottom:0}mjx-tstrut{display:inline-block;height:1em;vertical-align:-.25em}mjx-labels[align=left]>mjx-mtr>mjx-mtd{text-align:left}mjx-labels[align=right]>mjx-mtr>mjx-mtd{text-align:right}mjx-mtd[extra]{padding:0}mjx-mtd[rowalign=top]{vertical-align:top}mjx-mtd[rowalign=center]{vertical-align:middle}mjx-mtd[rowalign=bottom]{vertical-align:bottom}mjx-mtd[rowalign=baseline]{vertical-align:baseline}mjx-mtd[rowalign=axis]{vertical-align:.25em}mjx-stretchy-v.mjx-c5B mjx-beg mjx-c::before{content:"â¡";padding:1.154em .667em .645em 0}mjx-stretchy-v.mjx-c5B mjx-ext mjx-c::before{content:"â¢";width:.667em}mjx-stretchy-v.mjx-c5B mjx-end mjx-c::before{content:"â£";padding:1.155em .667em .644em 0}mjx-stretchy-v.mjx-c5B>mjx-end{margin-top:-1.799em}mjx-stretchy-v.mjx-c5B>mjx-ext{border-top-width:1.769em;border-bottom-width:1.769em}mjx-stretchy-v.mjx-c5D mjx-beg mjx-c::before{content:"â¤";padding:1.154em .667em .645em 0}mjx-stretchy-v.mjx-c5D mjx-ext mjx-c::before{content:"â¥";width:.667em}mjx-stretchy-v.mjx-c5D mjx-end mjx-c::before{content:"â¦";padding:1.155em .667em .644em 0}mjx-stretchy-v.mjx-c5D>mjx-end{margin-top:-1.799em}mjx-stretchy-v.mjx-c5D>mjx-ext{border-top-width:1.769em;border-bottom-width:1.769em}mjx-c.mjx-c1D703.TEX-I::before{padding:.705em .469em .01em 0;content:"Î¸"}mjx-c.mjx-c1D434.TEX-I::before{padding:.716em .75em 0 0;content:"A"}mjx-c.mjx-c5B::before{padding:.75em .278em .25em 0;content:"["}mjx-c.mjx-c5D::before{padding:.75em .278em .25em 0;content:"]"}mjx-c.mjx-c22EF::before{padding:.31em 1.172em 0 0;content:"â‹¯"}mjx-c.mjx-c22EE::before{padding:1.3em .278em .03em 0;content:"â‹®"}mjx-c.mjx-c22F1::before{padding:1.52em 1.282em 0 0;content:"â‹±"}mjx-c.mjx-c1D44A.TEX-I::before{padding:.683em 1.048em .022em 0;content:"W"}mjx-c.mjx-c1D444.TEX-I::before{padding:.704em .791em .194em 0;content:"Q"}mjx-c.mjx-c3E::before{padding:.54em .778em .04em 0;content:">"}mjx-c.mjx-c1D70F.TEX-I::before{padding:.431em .517em .013em 0;content:"Ï„"}mjx-c.mjx-c1D458.TEX-I::before{padding:.694em .521em .011em 0;content:"k"}mjx-c.mjx-c2211.TEX-S2::before{padding:.95em 1.444em .45em 0;content:"âˆ‘"}mjx-c.mjx-c3C::before{padding:.54em .778em .04em 0;content:"<"}mjx-c.mjx-c44::before{padding:.683em .764em 0 0;content:"D"}mjx-c.mjx-c20::before{padding:0 .25em 0 0;content:" "}mjx-c.mjx-c6D::before{padding:.442em .833em 0 0;content:"m"}mjx-c.mjx-c2D::before{padding:.252em .333em 0 0;content:"-"}mjx-c.mjx-c75::before{padding:.442em .556em .011em 0;content:"u"}mjx-c.mjx-c6B::before{padding:.694em .528em 0 0;content:"k"}mjx-c.mjx-c52::before{padding:.683em .736em .022em 0;content:"R"}mjx-c.mjx-c67::before{padding:.453em .5em .206em 0;content:"g"}mjx-c.mjx-c45::before{padding:.68em .681em 0 0;content:"E"}mjx-c.mjx-c78::before{padding:.431em .528em 0 0;content:"x"}mjx-c.mjx-c220F.TEX-S2::before{padding:.95em 1.278em .45em 0;content:"âˆ"}mjx-c.mjx-c2264::before{padding:.636em .778em .138em 0;content:"â‰¤"}mjx-c.mjx-c1D457.TEX-I::before{padding:.661em .412em .204em 0;content:"j"}mjx-c.mjx-c1D435.TEX-I::before{padding:.683em .759em 0 0;content:"B"}mjx-c.mjx-c47::before{padding:.705em .785em .022em 0;content:"G"}mjx-c.mjx-c4C::before{padding:.683em .625em 0 0;content:"L"}mjx-c.mjx-c42::before{padding:.683em .708em 0 0;content:"B"}mjx-c.mjx-c41::before{padding:.716em .75em 0 0;content:"A"}mjx-c.mjx-c43::before{padding:.705em .722em .021em 0;content:"C"}mjx-c.mjx-c79::before{padding:.431em .528em .204em 0;content:"y"}mjx-c.mjx-c6C::before{padding:.694em .278em 0 0;content:"l"}mjx-c.mjx-c69::before{padding:.669em .278em 0 0;content:"i"}mjx-c.mjx-c6E::before{padding:.442em .556em 0 0;content:"n"}mjx-c.mjx-c64::before{padding:.694em .556em .011em 0;content:"d"}mjx-c.mjx-c65::before{padding:.448em .444em .011em 0;content:"e"}mjx-c.mjx-c72::before{padding:.442em .392em 0 0;content:"r"}mjx-c.mjx-c4E::before{padding:.683em .75em 0 0;content:"N"}mjx-c.mjx-c68::before{padding:.694em .556em 0 0;content:"h"}mjx-c.mjx-c61::before{padding:.448em .5em .011em 0;content:"a"}mjx-c.mjx-c48::before{padding:.683em .75em 0 0;content:"H"}mjx-c.mjx-c63::before{padding:.448em .444em .011em 0;content:"c"}mjx-c.mjx-c74::before{padding:.615em .389em .01em 0;content:"t"}mjx-c.mjx-c6F::before{padding:.448em .5em .01em 0;content:"o"}mjx-c.mjx-c53::before{padding:.705em .556em .022em 0;content:"S"}mjx-c.mjx-c54::before{padding:.677em .722em 0 0;content:"T"}mjx-c.mjx-c5A::before{padding:.683em .611em 0 0;content:"Z"}mjx-msup{display:inline-block;text-align:left}mjx-c.mjx-c38::before{padding:.666em .5em .022em 0;content:"8"}mjx-c.mjx-c39::before{padding:.666em .5em .022em 0;content:"9"}mjx-c.mjx-c73::before{padding:.448em .394em .011em 0;content:"s"}mjx-c.mjx-c1D448.TEX-I::before{padding:.683em .767em .022em 0;content:"U"}mjx-c.mjx-c37::before{padding:.676em .5em .022em 0;content:"7"}mjx-c.mjx-c1D438.TEX-I::before{padding:.68em .764em 0 0;content:"E"}mjx-c.mjx-c1D6FC.TEX-I::before{padding:.442em .64em .011em 0;content:"Î±"}mjx-c.mjx-c1D463.TEX-I::before{padding:.443em .485em .011em 0;content:"v"}mjx-c.mjx-c1D6FD.TEX-I::before{padding:.705em .566em .194em 0;content:"Î²"}mjx-c.mjx-c7C::before{padding:.75em .278em .249em 0;content:"|"}mjx-c.mjx-c1D43C.TEX-I::before{padding:.683em .504em 0 0;content:"I"}mjx-mtext{display:inline-block;text-align:left}mjx-mfrac{display:inline-block;text-align:left}mjx-frac{display:inline-block;vertical-align:.17em;padding:0 .22em}mjx-frac[type="d"]{vertical-align:.04em}mjx-frac[delims]{padding:0 .1em}mjx-frac[atop]{padding:0 .12em}mjx-frac[atop][delims]{padding:0}mjx-dtable{display:inline-table;width:100%}mjx-dtable>*{font-size:2000%}mjx-dbox{display:block;font-size:5%}mjx-num{display:block;text-align:center}mjx-den{display:block;text-align:center}mjx-mfrac[bevelled]>mjx-num{display:inline-block}mjx-mfrac[bevelled]>mjx-den{display:inline-block}mjx-den[align=right],mjx-num[align=right]{text-align:right}mjx-den[align=left],mjx-num[align=left]{text-align:left}mjx-nstrut{display:inline-block;height:.054em;width:0;vertical-align:-.054em}mjx-nstrut[type="d"]{height:.217em;vertical-align:-.217em}mjx-dstrut{display:inline-block;height:.505em;width:0}mjx-dstrut[type="d"]{height:.726em}mjx-line{display:block;box-sizing:border-box;min-height:1px;height:.06em;border-top:.06em solid;margin:.06em -.1em;overflow:hidden}mjx-line[type="d"]{margin:.18em -.1em}mjx-mrow{display:inline-block;text-align:left}mjx-munderover{display:inline-block;text-align:left}mjx-munderover:not([limits=false]){padding-top:.1em}mjx-munderover:not([limits=false])>*{display:block}mjx-msubsup{display:inline-block;text-align:left}mjx-script{display:inline-block;padding-right:.05em;padding-left:.033em}mjx-script>mjx-spacer{display:block}mjx-c.mjx-c210E.TEX-I::before{padding:.694em .576em .011em 0;content:"h"}mjx-c.mjx-c3A::before{padding:.43em .278em 0 0;content:":"}mjx-c.mjx-c1D464.TEX-I::before{padding:.443em .716em .011em 0;content:"w"}mjx-c.mjx-c1D45A.TEX-I::before{padding:.442em .878em .011em 0;content:"m"}mjx-c.mjx-c1D446.TEX-I::before{padding:.705em .645em .022em 0;content:"S"}mjx-c.mjx-c1D454.TEX-I::before{padding:.442em .477em .205em 0;content:"g"}mjx-c.mjx-c1D453.TEX-I::before{padding:.705em .55em .205em 0;content:"f"}mjx-c.mjx-c1D465.TEX-I::before{padding:.442em .572em .011em 0;content:"x"}mjx-c.mjx-c2217::before{padding:.465em .5em 0 0;content:"âˆ—"}mjx-c.mjx-c1D447.TEX-I::before{padding:.677em .704em 0 0;content:"T"}mjx-c.mjx-cA0::before{padding:0 .25em 0 0;content:"Â "}mjx-c.mjx-c34::before{padding:.677em .5em 0 0;content:"4"}mjx-c.mjx-c36::before{padding:.666em .5em .022em 0;content:"6"}mjx-c.mjx-c2248::before{padding:.483em .778em 0 0;content:"â‰ˆ"}mjx-c.mjx-c1D449.TEX-I::before{padding:.683em .769em .022em 0;content:"V"}mjx-c.mjx-c1D43F.TEX-I::before{padding:.683em .681em 0 0;content:"L"}mjx-c.mjx-c1D436.TEX-I::before{padding:.705em .76em .022em 0;content:"C"}mjx-c.mjx-c2265::before{padding:.636em .778em .138em 0;content:"â‰¥"}mjx-c.mjx-c7B::before{padding:.75em .5em .25em 0;content:"{"}mjx-c.mjx-c7D::before{padding:.75em .5em .25em 0;content:"}"}mjx-c.mjx-c1D443.TEX-I::before{padding:.683em .751em 0 0;content:"P"}mjx-c.mjx-c2211.TEX-S1::before{padding:.75em 1.056em .25em 0;content:"âˆ‘"}mjx-container[jax=CHTML]{line-height:0}mjx-container [space="1"]{margin-left:.111em}mjx-container [space="2"]{margin-left:.167em}mjx-container [space="3"]{margin-left:.222em}mjx-container [space="4"]{margin-left:.278em}mjx-container [space="5"]{margin-left:.333em}mjx-container [rspace="1"]{margin-right:.111em}mjx-container [rspace="2"]{margin-right:.167em}mjx-container [rspace="3"]{margin-right:.222em}mjx-container [rspace="4"]{margin-right:.278em}mjx-container [rspace="5"]{margin-right:.333em}mjx-container [size="s"]{font-size:70.7%}mjx-container [size=ss]{font-size:50%}mjx-container [size=Tn]{font-size:60%}mjx-container [size=sm]{font-size:85%}mjx-container [size=lg]{font-size:120%}mjx-container [size=Lg]{font-size:144%}mjx-container [size=LG]{font-size:173%}mjx-container [size=hg]{font-size:207%}mjx-container [size=HG]{font-size:249%}mjx-container [width=full]{width:100%}mjx-box{display:inline-block}mjx-block{display:block}mjx-itable{display:inline-table}mjx-row{display:table-row}mjx-row>*{display:table-cell}mjx-mtext{display:inline-block}mjx-mstyle{display:inline-block}mjx-merror{display:inline-block;color:red;background-color:#ff0}mjx-mphantom{visibility:hidden}mjx-assistive-mml{top:0;left:0;clip:rect(1px,1px,1px,1px);user-select:none;position:absolute!important;padding:1px 0 0!important;border:0!important;display:block!important;width:auto!important;overflow:hidden!important}mjx-assistive-mml[display=block]{width:100%!important}mjx-math{display:inline-block;text-align:left;line-height:0;text-indent:0;font-style:normal;font-weight:400;font-size:100%;letter-spacing:normal;border-collapse:collapse;overflow-wrap:normal;word-spacing:normal;white-space:nowrap;direction:ltr;padding:1px 0}mjx-container[jax=CHTML][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=CHTML][display=true][width=full]{display:flex}mjx-container[jax=CHTML][display=true] mjx-math{padding:0}mjx-container[jax=CHTML][justify=left]{text-align:left}mjx-container[jax=CHTML][justify=right]{text-align:right}mjx-mi{display:inline-block;text-align:left}mjx-c{display:inline-block}mjx-utext{display:inline-block;padding:.75em 0 .2em}mjx-msub{display:inline-block;text-align:left}mjx-texatom{display:inline-block;text-align:left}mjx-mo{display:inline-block;text-align:left}mjx-stretchy-h{display:inline-table;width:100%}mjx-stretchy-h>*{display:table-cell;width:0}mjx-stretchy-h>*>mjx-c{display:inline-block;transform:scaleX(1)}mjx-stretchy-h>*>mjx-c::before{display:inline-block;width:initial}mjx-stretchy-h>mjx-ext{overflow:clip visible;width:100%}mjx-stretchy-h>mjx-ext>mjx-c::before{transform:scaleX(500)}mjx-stretchy-h>mjx-ext>mjx-c{width:0}mjx-stretchy-h>mjx-beg>mjx-c{margin-right:-.1em}mjx-stretchy-h>mjx-end>mjx-c{margin-left:-.1em}mjx-stretchy-v{display:inline-block}mjx-stretchy-v>*{display:block}mjx-stretchy-v>mjx-beg{height:0}mjx-stretchy-v>mjx-end>mjx-c{display:block}mjx-stretchy-v>*>mjx-c{transform:scaleY(1);transform-origin:left center;overflow:hidden}mjx-stretchy-v>mjx-ext{display:block;height:100%;box-sizing:border-box;border:0 solid transparent;overflow:visible clip}mjx-stretchy-v>mjx-ext>mjx-c::before{width:initial;box-sizing:border-box}mjx-stretchy-v>mjx-ext>mjx-c{transform:scaleY(500) translateY(.075em);overflow:visible}mjx-mark{display:inline-block;height:0}mjx-mn{display:inline-block;text-align:left}mjx-c::before{display:block;width:0}.MJX-TEX{font-family:MJXZERO,MJXTEX}.TEX-B{font-family:MJXZERO,MJXTEX-B}.TEX-I{font-family:MJXZERO,MJXTEX-I}.TEX-MI{font-family:MJXZERO,MJXTEX-MI}.TEX-BI{font-family:MJXZERO,MJXTEX-BI}.TEX-S1{font-family:MJXZERO,MJXTEX-S1}.TEX-S2{font-family:MJXZERO,MJXTEX-S2}.TEX-S3{font-family:MJXZERO,MJXTEX-S3}.TEX-S4{font-family:MJXZERO,MJXTEX-S4}.TEX-A{font-family:MJXZERO,MJXTEX-A}.TEX-C{font-family:MJXZERO,MJXTEX-C}.TEX-CB{font-family:MJXZERO,MJXTEX-CB}.TEX-FR{font-family:MJXZERO,MJXTEX-FR}.TEX-FRB{font-family:MJXZERO,MJXTEX-FRB}.TEX-SS{font-family:MJXZERO,MJXTEX-SS}.TEX-SSB{font-family:MJXZERO,MJXTEX-SSB}.TEX-SSI{font-family:MJXZERO,MJXTEX-SSI}.TEX-SC{font-family:MJXZERO,MJXTEX-SC}.TEX-T{font-family:MJXZERO,MJXTEX-T}.TEX-V{font-family:MJXZERO,MJXTEX-V}.TEX-VB{font-family:MJXZERO,MJXTEX-VB}mjx-stretchy-h mjx-c,mjx-stretchy-v mjx-c{font-family:MJXZERO,MJXTEX-S1,MJXTEX-S4,MJXTEX,MJXTEX-A!important}@font-face{font-family:MJXZERO;src:url("lib/fonts/mathjax_zero.woff") format("woff")}@font-face{font-family:MJXTEX;src:url("lib/fonts/mathjax_main-regular.woff") format("woff")}@font-face{font-family:MJXTEX-B;src:url("lib/fonts/mathjax_main-bold.woff") format("woff")}@font-face{font-family:MJXTEX-I;src:url("lib/fonts/mathjax_math-italic.woff") format("woff")}@font-face{font-family:MJXTEX-MI;src:url("lib/fonts/mathjax_main-italic.woff") format("woff")}@font-face{font-family:MJXTEX-BI;src:url("lib/fonts/mathjax_math-bolditalic.woff") format("woff")}@font-face{font-family:MJXTEX-S1;src:url("lib/fonts/mathjax_size1-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S2;src:url("lib/fonts/mathjax_size2-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S3;src:url("lib/fonts/mathjax_size3-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S4;src:url("lib/fonts/mathjax_size4-regular.woff") format("woff")}@font-face{font-family:MJXTEX-A;src:url("lib/fonts/mathjax_ams-regular.woff") format("woff")}@font-face{font-family:MJXTEX-C;src:url("lib/fonts/mathjax_calligraphic-regular.woff") format("woff")}@font-face{font-family:MJXTEX-CB;src:url("lib/fonts/mathjax_calligraphic-bold.woff") format("woff")}@font-face{font-family:MJXTEX-FR;src:url("lib/fonts/mathjax_fraktur-regular.woff") format("woff")}@font-face{font-family:MJXTEX-FRB;src:url("lib/fonts/mathjax_fraktur-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SS;src:url("lib/fonts/mathjax_sansserif-regular.woff") format("woff")}@font-face{font-family:MJXTEX-SSB;src:url("lib/fonts/mathjax_sansserif-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SSI;src:url("lib/fonts/mathjax_sansserif-italic.woff") format("woff")}@font-face{font-family:MJXTEX-SC;src:url("lib/fonts/mathjax_script-regular.woff") format("woff")}@font-face{font-family:MJXTEX-T;src:url("lib/fonts/mathjax_typewriter-regular.woff") format("woff")}@font-face{font-family:MJXTEX-V;src:url("lib/fonts/mathjax_vector-regular.woff") format("woff")}@font-face{font-family:MJXTEX-VB;src:url("lib/fonts/mathjax_vector-bold.woff") format("woff")}mjx-c.mjx-c1D437.TEX-I::before{padding:.683em .828em 0 0;content:"D"}mjx-c.mjx-c1D452.TEX-I::before{padding:.442em .466em .011em 0;content:"e"}mjx-c.mjx-c1D459.TEX-I::before{padding:.694em .298em .011em 0;content:"l"}mjx-c.mjx-c1D44E.TEX-I::before{padding:.441em .529em .01em 0;content:"a"}mjx-c.mjx-c1D466.TEX-I::before{padding:.442em .49em .205em 0;content:"y"}mjx-c.mjx-c1D45B.TEX-I::before{padding:.442em .6em .011em 0;content:"n"}mjx-c.mjx-c1D45C.TEX-I::before{padding:.441em .485em .011em 0;content:"o"}mjx-c.mjx-c1D451.TEX-I::before{padding:.694em .52em .01em 0;content:"d"}mjx-c.mjx-c3D::before{padding:.583em .778em .082em 0;content:"="}mjx-c.mjx-c1D45D.TEX-I::before{padding:.442em .503em .194em 0;content:"p"}mjx-c.mjx-c1D45F.TEX-I::before{padding:.442em .451em .011em 0;content:"r"}mjx-c.mjx-c1D450.TEX-I::before{padding:.442em .433em .011em 0;content:"c"}mjx-c.mjx-c2B::before{padding:.583em .778em .082em 0;content:"+"}mjx-c.mjx-c1D45E.TEX-I::before{padding:.442em .46em .194em 0;content:"q"}mjx-c.mjx-c1D462.TEX-I::before{padding:.442em .572em .011em 0;content:"u"}mjx-c.mjx-c1D461.TEX-I::before{padding:.626em .361em .011em 0;content:"t"}mjx-c.mjx-c1D460.TEX-I::before{padding:.442em .469em .01em 0;content:"s"}mjx-c.mjx-c2212::before{padding:.583em .778em .082em 0;content:"âˆ’"}mjx-c.mjx-c1D441.TEX-I::before{padding:.683em .888em 0 0;content:"N"}mjx-c.mjx-c28::before{padding:.75em .389em .25em 0;content:"("}mjx-c.mjx-c29::before{padding:.75em .389em .25em 0;content:")"}mjx-c.mjx-c1D445.TEX-I::before{padding:.683em .759em .021em 0;content:"R"}mjx-c.mjx-c1D440.TEX-I::before{padding:.683em 1.051em 0 0;content:"M"}mjx-c.mjx-c1D456.TEX-I::before{padding:.661em .345em .011em 0;content:"i"}mjx-c.mjx-c31::before{padding:.666em .5em 0 0;content:"1"}mjx-c.mjx-c2C::before{padding:.121em .278em .194em 0;content:","}mjx-c.mjx-c32::before{padding:.666em .5em 0 0;content:"2"}mjx-c.mjx-c33::before{padding:.665em .5em .022em 0;content:"3"}mjx-c.mjx-c2E::before{padding:.12em .278em 0 0;content:"."}mjx-c.mjx-c1D439.TEX-I::before{padding:.68em .749em 0 0;content:"F"}mjx-c.mjx-c2F::before{padding:.75em .5em .25em 0;content:"/"}mjx-c.mjx-c1D44F.TEX-I::before{padding:.694em .429em .011em 0;content:"b"}mjx-c.mjx-c35::before{padding:.666em .5em .022em 0;content:"5"}mjx-c.mjx-c30::before{padding:.666em .5em .022em 0;content:"0"}mjx-c.mjx-c1D43E.TEX-I::before{padding:.683em .889em 0 0;content:"K"}mjx-c.mjx-c1D43B.TEX-I::before{padding:.683em .888em 0 0;content:"H"}</style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">tags</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> OS</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="6.5 Inter-Process Communications"><p dir="auto">6.5 Inter-Process Communications</p></h1><div class="el-h2 heading-wrapper"><h2 data-heading="ç¬¬ä¸€è¯¾ IPC" dir="auto" class="heading" id="ç¬¬ä¸€è¯¾_IPC"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>ç¬¬ä¸€è¯¾ IPC</h2><div class="heading-children"><div class="el-hr"><hr></div><div class="el-h3 heading-wrapper"><h3 data-heading="1.1 IPC Motivation" dir="auto" class="heading" id="1.1_IPC_Motivation"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.1 IPC Motivation</h3><div class="heading-children"><div class="el-p"><p dir="auto">äººç±»éœ€è¦æ²Ÿé€šå’Œäº¤æµï¼Œäº¤æµä¸åˆä½œå…±åŒå»ºé€ äº†æˆ‘ä»¬è¿™ä¸ªç¾å¥½çš„ä¸–ç•Œã€‚åœ¨åŸå§‹æ‘è½æ—¶ä»£ï¼Œäººç±»åªèƒ½é€šè¿‡é¢å¯¹é¢äº¤æµè¿›è¡Œåä½œï¼Œæ²Ÿé€šèŒƒå›´å±€é™åœ¨åŒæ‘å±…æ°‘ä¹‹é—´ã€‚ç”µè¯çš„å‘æ˜æ‰“ç ´äº†ç‰©ç†è·ç¦»çš„å£å’ï¼Œä½¿è·¨åœ°åŸŸçš„å®æ—¶æ²Ÿé€šæˆä¸ºå¯èƒ½ï¼Œæå¤§åœ°æ‰©å±•äº†åä½œçš„è¾¹ç•Œã€‚</p></div><div class="el-p"><p dir="auto">å¯¹äºè¿›ç¨‹ä¹Ÿä¸€æ ·ï¼Œåœ¨æ²¡æœ‰ç½‘ç»œçš„æ—¶ä»£ï¼Œè¿›ç¨‹é—´é€šä¿¡åªå±€é™åœ¨ä¸€å°ä¸»æœºä¸Šã€‚éšç€ç½‘ç»œåŸºç¡€è®¾æ–½çš„å»ºè®¾ï¼Œæˆ‘ä»¬å·²ç»è¿›å…¥äº†å…‰çº¤å…¥æˆ·(FTTH)çš„æ—¶ä»£ã€‚è¿›ç¨‹é—´é€šä¿¡ä¸å†å…·æœ‰å±€é™æ€§ï¼Œè¿œè·ç¦»çš„é€šä¿¡æˆä¸ºäº†å¯èƒ½ã€‚é€šè¿‡ç½‘ç»œï¼Œåˆ†å¸ƒåœ¨ä¸åŒåœ°ç†ä½ç½®çš„è¿›ç¨‹å¯ä»¥äº’ç›¸é€šä¿¡ï¼ŒååŒå·¥ä½œï¼Œå…±åŒå®Œæˆå¤æ‚çš„ä»»åŠ¡ã€‚</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="1.3 IPC Types" dir="auto" class="heading" id="1.3_IPC_Types"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.3 IPC Types</h3><div class="heading-children"><div class="el-p"><p dir="auto">æˆ‘ä»¬æœ‰ä¸¤ç±»è¿›ç¨‹é—´é€šä¿¡ï¼Œä¸€ç±»æ˜¯åŒä¸€å°ä¸»æœºä¸Šçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œè¿˜æœ‰ä¸€ç±»æ˜¯ä¸åŒä¸»æœºä¹‹é—´çš„è¿›ç¨‹é—´é€šä¿¡ã€‚è¿™ä¸¤ç±»è¿›ç¨‹é—´é€šä¿¡çš„ä¸»ä½“æ€æƒ³éƒ½å¾ˆç®€å•ï¼Œå³å‘é€æ–¹è¿›ç¨‹å‘é€ä¿¡æ¯ï¼Œæ¥æ”¶æ–¹è¿›ç¨‹æ¥æ”¶ä¿¡æ¯ã€‚</p></div><div class="el-p"><p dir="auto">ä¸ç®¡æ˜¯å“ªç§è¿›ç¨‹é—´é€šä¿¡ï¼Œä½ éƒ½éœ€è¦è€ƒè™‘æ”¶å‘è¿‡ç¨‹çš„åŒæ­¥å’Œäº’æ–¥é—®é¢˜ã€åŒæ­¥æ€§å’Œå¼‚æ­¥æ€§ï¼Œæˆ‘ä»¬æœ¬èŠ‚ä¸åšä»‹ç»ï¼Œç›¸å…³å†…å®¹å°†åœ¨åç»­çš„åŒæ­¥äº’æ–¥ç¯‡ç« è¿›è¡Œä»‹ç»ã€‚</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="1.3.1 IPC on the Same Machine" dir="auto" class="heading" id="1.3.1_IPC_on_the_Same_Machine"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.3.1 IPC on the Same Machine</h4><div class="heading-children"><div class="el-p"><p dir="auto">å¯¹äºåŒä¸€å°ä¸»æœºä¸Šçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯<strong>åœ¨å†…æ ¸æˆ–ç”¨æˆ·ç©ºé—´åˆ›å»ºå…±äº«å­˜å‚¨åŒºåŸŸ</strong>ï¼Œå…¶ä¸­ä¸€ä¸ªè¿›ç¨‹Wå¾€é‡Œé¢å†™ï¼Œå¦å¤–ä¸€ä¸ªè¿›ç¨‹Rå¾€å¤–è¯»ã€‚è¿™ç§æ¨¡å‹æœ¬è´¨ä¸Šå°±æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜çš„å®ç°ï¼Œéœ€è¦åŒæ­¥æœºåˆ¶æ¥ä¿è¯<strong>ç¼“å†²åŒºç©º</strong>ã€<strong>ç¼“å†²åŒºæ»¡</strong>å’Œç«Ÿæ€æ¡ä»¶çš„é—®é¢˜ã€‚å…±äº«å­˜å‚¨å™¨å¯ä»¥ç”¨<strong>å†…æ ¸ç¼“å†²åŒº(pipe)</strong> æˆ– <strong>ç”¨æˆ·å†…å­˜ç©ºé—´(Shared memory, shm)</strong> çš„æ–¹å¼æ¥å®ç°ã€‚</p></div><div class="el-p"><p dir="auto">è¿˜æœ‰å°†æ•°æ®æ”¾åˆ°ç£ç›˜ä¸­çš„IPCæœºåˆ¶å«<strong>å†…å­˜æ˜ å°„æ–‡ä»¶(Memory&nbsp;Mapped&nbsp;Files)</strong>ã€‚è¿™ç§æ–¹æ³•å…è®¸å¤šä¸ªè¿›ç¨‹é€šè¿‡æ˜ å°„æ–‡ä»¶åˆ°å…±äº«å†…å­˜çš„æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œå¹¶å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚</p></div><div class="el-p"><p dir="auto">æ­¤å¤–ï¼Œ<strong>ä¿¡å·</strong>ä¹Ÿæ˜¯ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚ä¸ä¸Šé¢ä¸åŒçš„æ˜¯ï¼Œä¿¡å·æœ¬èº«å¹¶ä¸æºå¸¦ä¿¡æ¯(messages)ï¼Œå› è€Œä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚ä¿¡å·ä¸»è¦ç”¨äºé€šçŸ¥è¿›ç¨‹å‘é€æŸäº›äº‹ä»¶ï¼Œæ¯”å¦‚ç»ˆæ­¢ã€ä¸­æ–­å’Œè‡ªå®šä¹‰äº‹ä»¶ç­‰ã€‚</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="1.3.2 IPC on Different Machines" dir="auto" class="heading" id="1.3.2_IPC_on_Different_Machines"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.3.2 IPC on Different Machines</h4><div class="heading-children"><div class="el-p"><p dir="auto">å¦‚æœä¸¤ä¸ªè¿›ç¨‹ä¸åœ¨åŒä¸€å°ä¸»æœºä¸Šï¼Œæˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©ç½‘ç»œçš„åŠ›é‡ï¼Œä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„Socket&nbsp;APIå‘ç‰¹å®šçš„ä¸»æœºå‘é€æ¶ˆæ¯æŠ¥æ–‡ã€‚å¯¹äºä¸Šå±‚åº”ç”¨è€…æ¥è¯´ï¼Œå®Œå…¨å¯ä»¥å°†Socketçœ‹ä½œæ˜¯é‚®é€’æ•°æ®çš„â€œé‚®æ”¿å…¬å¸â€ã€‚æˆ‘ä»¬å°†æ•°æ®äº¤ç»™â€œé‚®æ”¿å…¬å¸â€ï¼ˆSocket&nbsp;APIï¼‰ï¼Œå®ƒä»¬ä¼šå¦¥å–„å¤„ç†ä¸€åˆ‡ã€‚</p></div><div class="el-p"><p dir="auto">é€šè¿‡Socketsï¼Œåˆ†å¸ƒåœ¨ä¸åŒä¸»æœºä¸Šçš„è¿›ç¨‹å¯ä»¥å»ºç«‹è¿æ¥ï¼Œè¿›è¡Œæ•°æ®äº¤æ¢ã€‚è¿™ç§æ–¹å¼å¹¿æ³›åº”ç”¨äºç½‘ç»œåº”ç”¨ã€åˆ†å¸ƒå¼ç³»ç»Ÿå’Œå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ä¸­ã€‚</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="1.3 Send-Receive Protocol" dir="auto" class="heading" id="1.3_Send-Receive_Protocol"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.3 Send-Receive Protocol</h3><div class="heading-children"><div class="el-h4 heading-wrapper"><h4 data-heading="1.3.1 Formats" dir="auto" class="heading" id="1.3.1_Formats"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.3.1 Formats</h4><div class="heading-children"><div class="el-p"><p dir="auto">è¿›ç¨‹é—´é€šä¿¡æ€»æ˜¯ä¼´éšç€ä¸åŒçš„æ ¼å¼è¿›è¡Œçš„ï¼Œæ­£å¦‚äººç±»äº¤æµä¸€æ ·ã€‚è®²è¯æ–¹ï¼ˆå‘é€æ–¹ï¼‰ä½¿ç”¨ä¸åŒçš„è¯­è¨€ä¸åŒï¼ˆä¸åŒçš„æ ¼å¼ï¼‰ï¼Œå¦‚æœè†å¬æ–¹å¬ä¸æ‡‚é‚£ç§è¯­è¨€ï¼ˆæ²¡æœ‰å¯¹åº”çš„parserå‡½æ•°ï¼‰ï¼Œè¿™ç§äº¤æµä¾¿æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚åœ¨è¿›ç¨‹é—´é€šä¿¡ä¸­ï¼Œå°½ç®¡ä¿¡æ¯éƒ½æ˜¯ä»¥0å’Œ1åœ¨è®¡ç®—æœºä¸–ç•Œä¸­ä¼ è¾“çš„ï¼Œä½†åªè¦è§„å®šäº†ä¸€å®šçš„æ ¼å¼ï¼Œæ¥æ”¶åŒæ–¹è¾¾æˆä¸€å®šå…±è¯†ï¼ˆä½¿ç”¨åŒä¸€ç§æ ¼å¼ï¼‰ï¼Œäº¤æµå°±å¯ä»¥è¾¾æˆã€‚</p></div><div class="el-p"><p dir="auto">å¸¸è§çš„é€šä¿¡æ ¼å¼æœ‰JSONå’ŒXMLï¼Œé€šè¿‡æ ¼å¼æä¾›çš„çº¦å®šï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§æ¥æ”¶/å‘é€ä¹‹é—´çš„çº¦å®šå°†ä¿¡æ¯è¿›è¡ŒåŒ…è£…(packet)å’Œè§£ç (parse)ï¼ˆä¹Ÿå«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼‰ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å®˜æ–¹æ‰€æä¾›çš„åº“ã€‚</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="1.3.2 Order" dir="auto" class="heading" id="1.3.2_Order"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.3.2 Order</h4><div class="heading-children"><div class="el-p"><p dir="auto">ä¸€æ—¦æ¶‰åŠåˆ°ä¿¡æ¯çš„å‘é€å’Œæ¥æ”¶ï¼Œæ”¶å‘çš„é¡ºåºæ˜¯éœ€è¦æœ‰ä¸€å®šçš„çº¦æŸçš„ã€‚</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="1.3.2.1 Synchronous" dir="auto" class="heading" id="1.3.2.1_Synchronous"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.3.2.1 Synchronous</h5><div class="heading-children"><div class="el-p"><p dir="auto">åŒæ­¥é€šä¿¡è¦æ±‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹åœ¨æŸä¸€ç‰¹å®šæ—¶é—´ç‚¹ä¸Šè¿›è¡ŒååŒã€‚æ¯”æ–¹å¦‚ï¼Œå‘é€æ–¹å¿…é¡»ç­‰å¾…æ¥æ”¶æ–¹å‡†å¤‡å¥½æ¥æ”¶æ•°æ®åå†å‘é€ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ç¡®ä¿æ•°æ®çš„å¯é ä¼ è¾“ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ç­‰å¾…æ—¶é—´çš„å¢åŠ ã€‚</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="1.3.2.2 Asynchronous" dir="auto" class="heading" id="1.3.2.2_Asynchronous"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>1.3.2.2 Asynchronous</h5><div class="heading-children"><div class="el-p"><p dir="auto">å¼‚æ­¥åˆ™å…è®¸å‘é€æ–¹å’Œæ¥æ”¶æ–¹æ— éœ€ååŒã€ç‹¬ç«‹å·¥ä½œã€‚å‘é€æ–¹åœ¨å‘é€æ•°æ®åå¯ä»¥ç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œè€Œæ¥æ”¶æ–¹åœ¨å‡†å¤‡å¥½æ¥æ”¶æ•°æ®æ—¶å†è¿›è¡Œå¤„ç†ã€‚è¿™ç§æ–¹å¼æé«˜äº†ç³»ç»Ÿçš„å¹¶å‘æ€§å’Œæ•ˆç‡ï¼Œä½†éœ€è¦é¢å¤–çš„æœºåˆ¶æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚</p></div></div></div></div></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="ç¬¬äºŒè¯¾ Sockets for Network Communication" dir="auto" class="heading" id="ç¬¬äºŒè¯¾_Sockets_for_Network_Communication"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>ç¬¬äºŒè¯¾ Sockets for Network Communication</h2><div class="heading-children"><div class="el-hr"><hr></div><div class="el-p"><p dir="auto">å¯¹äºä¸åŒä¸»æœºé—´çš„é€šä¿¡ï¼Œè™½ç„¶è¿˜æœ‰å…¶ä»–çš„æ–¹å¼ï¼Œä½†æˆ‘ä»¬ä¸»è¦å€ŸåŠ© Socket API æ¥è¿›è¡Œã€‚å°½ç®¡ä½ å¯ä»¥ç”¨ç½‘ç»œæ¥äº¤æ¢è¿›ç¨‹ä¹‹é—´çš„æ•°æ®ã€‚ä½†ä¸€èˆ¬æ¥è¯´ï¼Œsocket å¹¶ä¸ä½œä¸º IPC çš„ä¸€éƒ¨åˆ†ã€‚</p></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.1 Sockets" dir="auto" class="heading" id="2.1_Sockets"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.1 Sockets</h3><div class="heading-children"><div class="el-p"><p dir="auto">Socket APIçš„å‘½åçµæ„Ÿæ¥æºäºç”µæºæ’åº§ğŸ”Œ(power socket)ã€‚å½“è®¾å¤‡ä¸ç”µæºæ’åº§è¿æ¥æ—¶ï¼Œæ’åº§å…è®¸è®¾å¤‡è¿æ¥å¹¶äº¤æ¢ç”µæµï¼Œå½“è®¾å¤‡æ–­å¼€ä¸ç”µæºæ’åº§çš„è¿æ¥ï¼Œç”µæµçš„äº¤æ¢ä¹Ÿéšä¹‹ç»“æŸã€‚åŒæ ·çš„é“ç†ï¼ŒSocket APIä¹Ÿå…è®¸ä¸åŒçš„è¿›ç¨‹ä¹‹é—´è¿›è¡Œæ•°æ®çš„äº¤æµã€‚Socket APIä¸ºä¸Šå±‚åº”ç”¨å°è£…å±è”½äº†ä¸‹å±‚ä¼ è¾“å±‚çš„ç»†èŠ‚ã€‚</p></div><div class="el-p"><p dir="auto">æˆ‘ä»¬çŸ¥é“ï¼Œä¼ è¾“å±‚æä¾›ä¸¤ç§é€šä¿¡èŒƒå¼ï¼š<strong>æ•°æ®æŠ¥(datagram)</strong> å’Œ <strong>è¿æ¥æµ(connection stream)</strong>ã€‚TCPæ˜¯é¢å‘è¿æ¥çš„ä¼ è¾“å±‚åè®®ï¼Œä¸ºä¸Šå±‚çš„åº”ç”¨æä¾›å¯é ä¼ è¾“(reliable transfer)æœåŠ¡ã€‚TCPä¿è¯æ•°æ®å®Œæ•´æœ‰åºçš„é€è¾¾ã€‚å¸¸è§çš„ä½¿ç”¨TCPä½œä¸ºä¼ è¾“å±‚åè®®çš„åº”ç”¨å±‚åè®®æœ‰FTPã€SMTPå’ŒHTTPã€‚</p></div><div class="el-p"><p dir="auto">UDPæ˜¯é¢å‘éè¿æ¥çš„åè®®ï¼Œå®ƒä¸ºä¸Šå±‚åº”ç”¨æä¾›ä¸å¯é çš„ä¼ è¾“æœåŠ¡ã€‚ç”±äºUDPä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œå› æ­¤UDPä¸ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œé¡ºåºï¼Œä½†å®ƒçš„å¼€é”€è¾ƒå°ï¼Œä¼ è¾“é€Ÿåº¦è¾ƒå¿«ã€‚æ‰€ä»¥UDPæ¯”TCPæ›´åŠ ç®€å•é«˜æ•ˆã€‚UDPå¸¸è§äºè¯­éŸ³/è§†é¢‘é€šè¯å’Œæ¸¸æˆä¸­ã€‚</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.2 Sockets as Files" dir="auto" class="heading" id="2.2_Sockets_as_Files"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2 Sockets as Files</h3><div class="heading-children"><div class="el-p"><p dir="auto">åœ¨Linuxç­‰ç±»Unixçš„ç³»ç»Ÿä¸­ï¼Œsocketä¹Ÿè¢«è§†ä¸ºä¸€ç§æ–‡ä»¶ã€‚æ‰€ä»¥ä½ èƒ½å¤ç”¨éƒ¨åˆ†æ ‡å‡†çš„æ–‡ä»¶å¤„ç†ï¼ˆreadã€writeï¼‰æ¥æ“ä½œsocketã€‚ä½†æ˜¯socketæä¾›äº†ä¸€äº›å…¶ä»–çš„è¯­ä¹‰æŠ½è±¡ã€‚è¿™ç§æŠ½è±¡ç®€åŒ–äº†ç¼–ç¨‹æ¥å£ï¼Œä½ å¯ä»¥ç”¨socketç³»ç»Ÿè°ƒç”¨æ¥åˆ›å»ºä¸€ä¸ªsocketã€‚</p></div><div class="el-p"><p dir="auto"><code>socket()</code>çš„å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">socket</span><span class="token punctuation">(</span><span class="token keyword">int</span> domain<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">int</span> protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. Domain: address format; 
		- AF_INET: IPv4
		- AF_INET6: IPv6
		- AF_UNIX or AF_LOCAL: Unix domain sockets
		- AF_PACKET: Low-level packet interface
	    - AF_NETLINK: Kernel/user-space communication
	    - et cetera...
	2. Type: what kind of data;
		- SOCK_DGRAM: Datagram socket (UDP)
	    - SOCK_STREAM: Stream socket (TCP)
	    - SOCK_RAW: Original socket (IPPROTO_RAW)
	    - SOCK_SEQPACKET
	3. Protocol: how data is transported; 0 for type inference
		- IPPROTO_TCP: Used with SOCK_STREAM for TCP
	    - IPPROTO_UDP: Used with SOCK_DGRAM for UDP
	    - IPPROTO_ICMP: Used with SOCK_RAW for sending/recving ICMP packets
		- IPPROTO_SCTP
Return value: 
	- Return a socketfd on success.
	- -1 on failure.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.2.1 socket() Attr." dir="auto" class="heading" id="2.2.1_socket()_Attr."><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.1 socket() Attr.</h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>socket()</code>ç³»ç»Ÿè°ƒç”¨æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯<code>domain</code>, <code>type</code> å’Œ <code>protocol</code>ã€‚</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.1.1 `domain`" dir="auto" class="heading" id="2.2.1.1_`domain`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.1.1 <code>domain</code></h5><div class="heading-children"><div class="el-p"><p dir="auto">è¿™ä¸ªå‚æ•°å®šä¹‰äº†åœ°å€æ ¼å¼å’Œé€šä¿¡èŒƒå›´ï¼Œå†³å®šäº†socketçš„åº•å±‚åè®®æ—ã€‚å¸¸è§çš„æœ‰<code>AF_INET</code>, <code>AF_INET6</code> å’Œ <code>AF_UNIX/AF_LOCAL</code>ã€‚è¿™é‡Œçš„<code>AF_</code>æŒ‡çš„æ˜¯Address Familyã€‚<code>AF_INET</code> å’Œ <code>AF_INET6</code>ç”¨äºç½‘ç»œé€šä¿¡ï¼Œå…¶ä¸­ä¸€ä¸ªç”¨äºIPv4ï¼Œä¸€ä¸ªç”¨äºIPv6ã€‚å®ƒä»¬çš„åœ°å€ç»“æ„ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œåˆ†åˆ«æ˜¯ï¼š<code>struct sockaddr_in</code>å’Œ<code>struct sockaddr_in6</code>ã€‚</p></div><div class="el-p"><p dir="auto"><code>AF_UNIX</code>æˆ–è€…<code>AF_LOCAL</code>ï¼Œåˆ™ç”¨äºæœ¬åœ°çš„è¿›ç¨‹é—´é€šä¿¡ã€‚å› ä¸ºå®ƒå¹¶ä¸æ¶‰åŠç½‘ç»œé€šä¿¡ï¼Œæ‰€ä»¥æ²¡æœ‰ç½‘ç»œåè®®æ ˆå°åŒ…æ‹†åŒ…æ‰€é€ æˆçš„å¼€é”€ã€‚</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.1.2 `type`" dir="auto" class="heading" id="2.2.1.2_`type`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.1.2 <code>type</code></h5><div class="heading-children"><div class="el-p"><p dir="auto">è¿™ä¸ªå‚æ•°å®šä¹‰äº†socketçš„ç±»å‹ï¼Œç”¨äºé€‰æ‹©æ•°æ®çš„ä¼ è¾“æ–¹å¼å’ŒæœåŠ¡ç±»å‹ã€‚æˆ‘ä»¬å…³æ³¨<code>SOCK_STREAM</code>è·Ÿ<code>SOCK_DGRAM</code>ã€‚å‰è€…ï¼Œ<code>SOCK_STREAM</code>å®šä¹‰socketçš„ç±»å‹ä¸ºå¯é ã€æœ‰åºå’ŒåŒå‘çš„é¢å‘è¿æ¥çš„å­—èŠ‚æµï¼ˆTCPï¼‰ï¼Œå’Œ<code>SOCK_DGRAM</code>ï¼Œä¹Ÿå°±æ˜¯å°†socketçš„ç±»å‹å®šä¹‰ä¸ºä¸å¯é çš„æ— è¿æ¥çš„æ•°æ®æŠ¥æ–‡ã€‚</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.1.3 `protocol`" dir="auto" class="heading" id="2.2.1.3_`protocol`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.1.3 <code>protocol</code></h5><div class="heading-children"><div class="el-p"><p dir="auto">è¿™ä¸ªå‚æ•°æ˜ç¡®åœ°æŒ‡å®šä¼ è¾“å±‚ä½¿ç”¨ä½•ç§ç½‘ç»œåè®®ã€‚æˆ‘ä»¬å…³æ³¨<code>IPPROTO_TCP</code>å’Œ<code>IPPROTO_UDP</code>ã€‚å½“ä½ è®¾ç½®ä¸º<code>0</code>æ—¶ï¼Œå†…æ ¸ä¼šæ ¹æ®å‰ä¸¤ä¸ªå‚æ•°è‡ªåŠ¨æ¨å¯¼ã€‚</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.1.4 Illegal Combination" dir="auto" class="heading" id="2.2.1.4_Illegal_Combination"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.1.4 Illegal Combination</h5><div class="heading-children"><div class="el-p"><p dir="auto">å½“ç»„åˆéæ³•æˆ–ä¸å…¼å®¹ï¼Œå°±ä¼šè¿”å›<code>-1</code>å¹¶è®¾ç½®<code>errno = EINVAL</code>ã€‚</p></div></div></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.2.2 Creating an Socket" dir="auto" class="heading" id="2.2.2_Creating_an_Socket"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.2 Creating an Socket</h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>socket()</code>å‡½æ•°ä¸­æœ‰è®¸å¤šå‚æ•°ï¼Œé€‰æ‹©ä¸åŒçš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸åŒç±»å‹çš„socketã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ç”¨IPv4åˆ›å»ºä¸€ä¸ªTCPå’Œä¸€ä¸ªUDPçš„ä¼ è¾“åè®®çš„ç½‘ç»œè¿æ¥ã€‚</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.2.1 TCP Sockets in IPv4" dir="auto" class="heading" id="2.2.2.1_TCP_Sockets_in_IPv4"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.2.1 TCP Sockets in IPv4</h5><div class="heading-children"><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sockfd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"TCP socket creation failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.2.2 UDP Sockets in IPv4" dir="auto" class="heading" id="2.2.2.2_UDP_Sockets_in_IPv4"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.2.2 UDP Sockets in IPv4</h5><div class="heading-children"><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_DGRAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sockfd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"UDP socket creation failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.2.3. `setsockopt()`" dir="auto" class="heading" id="2.2.3._`setsockopt()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.3. <code>setsockopt()</code></h4><div class="heading-children"><div class="el-p"><p dir="auto">socketåˆ›å»ºå¥½ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>setsockopt</code>&nbsp;å‡½æ•°é€šè¿‡å„ç§é€‰é¡¹æ¥é…ç½®å’Œè°ƒæ•´å¥—æ¥å­—ã€‚è¿™ä¸ªå‡½æ•°å…è®¸ä½ æ§åˆ¶å’Œä¿®æ”¹å¥—æ¥å­—çš„è¡Œä¸ºï¼Œæ¯”å¦‚è¶…æ—¶æ—¶é—´ã€ç¼“å†²åŒºå¤§å°ã€é‡ç”¨åœ°å€ã€å¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šåè®®ç‰¹æ€§ç­‰ã€‚åœ¨åé¢çš„å­¦ä¹ ä¸­ï¼Œæ£€æµ‹å¦ä¸€æ–¹æ˜¯å¦è¿˜åœ¨å‘é€æŠ¥æ–‡å°±å°‘ä¸äº†<code>setsockopt()</code>ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">setsockopt</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">int</span> level<span class="token punctuation">,</span> <span class="token keyword">int</span> optname<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>optval<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> optlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. sockfd: The file descriptor of the socket on which to set the option.
	2. level: The level at which the option is defined (e.g., SOL_SOCKET for socket-level options, IPPROTO_TCP for TCP options).
	3. optname: The option name to set.
	   - Under SOL_SOCKET level:
	     1. SO_RCVTIMEO: set receive timeout time.
	     2. SO_SNDTIMEO: set send timeout time.
	     3. SO_REUSEADDR: allow local address reuse.
	     4. SO_KEEPALIVE: keep connections alive by enabling periodic transmissions.
	     5. SO_RCVBUF: set the receive buffer size.
	     6. SO_SNDBUF: set the send buffer size.
	     7. SO_LINGER: linger on close if data is present.
	     8. SO_BROADCAST: permit sending of broadcast messages.
	     9. SO_ERROR: retrieve and clear the socket error status.
	     10. SO_OOBINLINE: leave received out-of-band data in the input stream.
	   - Under IPPROTO_TCP level:
	     1. TCP_NODELAY: disable Nagle's algorithm.
	     2. TCP_KEEPIDLE: set the idle time before keep-alive probes are sent.
	     3. TCP_KEEPINTVL: set the interval between keep-alive probes.
	     4. TCP_KEEPCNT: set the number of keep-alive probes to be sent.
	   - Under IPPROTO_IP level:
	     1. IP_TTL: set the IP time-to-live value.
	     2. IP_MULTICAST_TTL: set the multicast time-to-live value.
	     3. IP_MULTICAST_LOOP: control the loopback of multicast packets.
	     4. IP_ADD_MEMBERSHIP: join a multicast group.
	     5. IP_DROP_MEMBERSHIP: leave a multicast group.
	   - Under IPPROTO_IPV6 level:
	     1. IPV6_V6ONLY: restrict the socket to IPv6 communications only.
	     2. IPV6_MULTICAST_HOPS: set the multicast hop limit.
	     3. IPV6_MULTICAST_LOOP: control the loopback of multicast packets.
	     4. IPV6_JOIN_GROUP: join an IPv6 multicast group.
	     5. IPV6_LEAVE_GROUP: leave an IPv6 multicast group.
	4. optval: A pointer to the buffer containing the value for the option. This buffer contains the value to be set for the specified option.
	5. optlen: The size, in bytes, of the buffer pointed to by optval.

Return value:
	- On success: Returns 0.
	- On failure: Returns -1, and errno is set to indicate the error. You can use the perror function or strerror to print the error message.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.2.4 Endianness and Network Byte Order" dir="auto" class="heading" id="2.2.4_Endianness_and_Network_Byte_Order"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.4 Endianness and Network Byte Order</h4><div class="heading-children"><div class="el-p"><p dir="auto">æˆ‘ä»¬åœ¨<a data-href="Endianness" href="some-notes/endianness.html" class="internal-link" target="_self" rel="noopener nofollow">Endianness</a>ä¸­å¯¹å¤§å°ç«¯å­—èŠ‚åºè¿›è¡Œäº†ä»‹ç»ã€‚åœ¨ç½‘ç»œä¼ è¾“ä¸­ï¼Œä¸ºäº†é¿å…ä¸¤å°è®¡ç®—æœºå› ä¸ºå¤§å°ç«¯é—®é¢˜äº§ç”Ÿçš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œæˆ‘ä»¬è§„å®šå°†å¤§ç«¯åºä½œä¸ºç½‘ç»œå­—èŠ‚åºï¼ˆå†å²åŸå› ï¼‰ã€‚è¿™æ ·åšä¸ä½†ç»Ÿä¸€äº†è®¡ç®—æœºç½‘ç»œçš„äº¤æµæ–¹å¼ï¼Œä¹Ÿä½¿å¾—å·¥ç¨‹å¸ˆæŠ“åŒ…åæ–¹ä¾¿é˜…è¯»å„ç§ä¿¡æ¯ã€‚</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.4.1 Host&nbsp;and&nbsp;Network&nbsp;Byte&nbsp;Order&nbsp;Conversion" dir="auto" class="heading" id="2.2.4.1_Host&nbsp;and&nbsp;Network&nbsp;Byte&nbsp;Order&nbsp;Conversion"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.4.1 Host&nbsp;and&nbsp;Network&nbsp;Byte&nbsp;Order&nbsp;Conversion</h5><div class="heading-children"><div class="el-p"><p dir="auto">åœ¨<code>arpa/inet.h</code>å¤´æ–‡ä»¶ä¸­ï¼Œæä¾›äº†ä¸€äº›è½¬æ¢å­—èŠ‚åºçš„åº“å‡½æ•°ã€‚å¦‚æœä½ ä¸æ¸…æ¥šä½ æ‰€ç”¨ç³»ç»Ÿçš„å­—èŠ‚åºï¼Œå»ºè®®åŠ ä¸Šè¿™äº›è½¬æ¢å‡½æ•°æ¥ç¡®ä¿æ•°æ®åœ¨ç½‘ç»œä¸Šä¼ è¾“æ—¶çš„æ­£ç¡®æ€§ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>

<span class="token comment">// Host TO Network Long/Short</span>
<span class="token class-name">uint32_t</span> <span class="token function">htonl</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> hostlong<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">uint16_t</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> hostshort<span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// Network TO Host Long/Short</span>
<span class="token class-name">uint32_t</span> <span class="token function">ntohl</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> netlong<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">uint16_t</span> <span class="token function">ntohs</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> netshort<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.4.2 Decimal Presentation and&nbsp;Network Byte Order Address Conversion" dir="auto" class="heading" id="2.2.4.2_Decimal_Presentation_and&nbsp;Network_Byte_Order_Address_Conversion"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.4.2 Decimal Presentation and&nbsp;Network Byte Order Address Conversion</h5><div class="heading-children"><div class="el-p"><p dir="auto">é™¤æ­¤ä¹‹å¤–ï¼Œ<code>arpa/inet.h</code>å¤´æ–‡ä»¶ä¸­è¿˜æœ‰å°†ç‚¹åˆ†åè¿›åˆ¶ï¼ˆåå…­è¿›åˆ¶ï¼‰ä¸ç½‘ç»œå­—èŠ‚åºæ•°å€¼è¿›è¡Œè½¬æ¢çš„åº“å‡½æ•°ã€‚è¿™äº›è½¬æ¢åœ¨è®¾ç½®æˆ–æ¥æ”¶ç½‘ç»œåœ°å€æ—¶éå¸¸æœ‰ç”¨ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">inet_aton</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>cp<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">in_addr</span> <span class="token operator">*</span>inp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. cp: IP address in decimal form (as a string, e.g., "192.168.1.1")
	2. inp: Pointer to a struct in_addr where the function will store the network address

Return value: Returns 1 on success, 0 if the input is not a valid IP address.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token comment">// Internet Presentation TO Network</span>
<span class="token keyword">int</span> <span class="token function">inet_pton</span><span class="token punctuation">(</span><span class="token keyword">int</span> af<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>src<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. af: Address family (AF_INET for IPv4, AF_INET6 for IPv6)
	2. src: IP address in decimal form (as a string, e.g., "192.168.1.1")
	3. dst: Pointer to a buffer where the function will store the network address (usually a struct in_addr or struct in6_addr) 

Return value: Returns 1 on success, 0 if inputs is not a valid IP address, and -1 on error.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token comment">// Internet Network TO Presentation</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">inet_ntop</span><span class="token punctuation">(</span><span class="token keyword">int</span> af<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>src<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>dst<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. af: Address family (AF_INET for IPv4, AF_INET6 for IPv6)
	2. src: Pointer to the network address structure (e.g., struct in_addr or struct in6_addr)
	3. dst: Pointer to a buffer where the function will store the IP address in decimal form (as a string)
	4. size: Size of the destination buffer 

Return value: 
	- Returns a pointer to the destination buffer `dst` on success. 
	- NULL on failure.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.2.5 Socket Addresses" dir="auto" class="heading" id="2.2.5_Socket_Addresses"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.5 Socket Addresses</h4><div class="heading-children"><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.5.1 IPv4 Address" dir="auto" class="heading" id="2.2.5.1_IPv4_Address"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.5.1 IPv4 Address</h5><div class="heading-children"><div class="el-p"><p dir="auto">å’Œå‘å¿«é€’æ—¶ä½ éœ€è¦çŸ¥é“å¯¹æ–¹çš„åœ°å€ä¿¡æ¯ä¸€æ ·ï¼Œå½“æˆ‘ä»¬åœ¨ç½‘ç»œä¸Šä¼ è¾“æŠ¥æ–‡æ—¶ï¼Œä½ éœ€è¦ç”¨ä¸€ç§çº¦å®šå¥½çš„æ ¼å¼æ¥åˆ›å»ºä¸€ä¸ªaddress structureã€‚æˆ‘ä»¬ç”¨&nbsp;<code>sockaddr_in</code>&nbsp;ç»“æ„ä½“æ¥è¡¨ç¤ºIPv4åœ°å€ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>

<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> <span class="token punctuation">{</span>
    <span class="token class-name">sa_family_t</span> sin_family<span class="token punctuation">;</span> <span class="token comment">// Address Family</span>
    <span class="token class-name">in_port_t</span> sin_port<span class="token punctuation">;</span>     <span class="token comment">// Port number</span>
    <span class="token keyword">struct</span> <span class="token class-name">in_addr</span> sin_addr<span class="token punctuation">;</span> <span class="token comment">// IP address</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">in_addr</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint32_t</span> s_addr<span class="token punctuation">;</span> <span class="token comment">// 32-bit IPv4 address</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.5.2 IPv6 Address" dir="auto" class="heading" id="2.2.5.2_IPv6_Address"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.5.2 IPv6 Address</h5><div class="heading-children"><div class="el-p"><p dir="auto">æˆ‘ä»¬ç”¨<code>addrinfo</code>æ¥è¡¨ç¤ºIPv6çš„å¥—æ¥å­—çš„åœ°å€ä¿¡æ¯ã€‚è¿™ä¸ªç»“æ„ä½“æ˜¯ä¸€ä¸ªé€šç”¨çš„ç»“æ„ä½“ï¼Œèƒ½å¤Ÿè¡¨ç¤ºå„ç§ä¸åŒç±»å‹çš„åœ°å€ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span>              ai_flags<span class="token punctuation">;</span>
    <span class="token keyword">int</span>              ai_family<span class="token punctuation">;</span>
    <span class="token keyword">int</span>              ai_socktype<span class="token punctuation">;</span>
    <span class="token keyword">int</span>              ai_protocol<span class="token punctuation">;</span>
    <span class="token class-name">socklen_t</span>        ai_addrlen<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>ai_addr<span class="token punctuation">;</span>
    <span class="token keyword">char</span>            <span class="token operator">*</span>ai_canonname<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> <span class="token operator">*</span>ai_next<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.5.3 Local Domain Address" dir="auto" class="heading" id="2.2.5.3_Local_Domain_Address"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.5.3 Local Domain Address</h5><div class="heading-children"><div class="el-p"><p dir="auto">æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰<code>sockaddr_un</code>ç»“æ„ä½“ç”¨äºè¡¨ç¤ºUnix domain sockets:</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/un.h&gt;</span></span>

<span class="token keyword">struct</span> <span class="token class-name">sockaddr_un</span> <span class="token punctuation">{</span>
    <span class="token class-name">sa_family_t</span> sun_family<span class="token punctuation">;</span> <span class="token comment">// Address Family (AF_UNIX)</span>
    <span class="token keyword">char</span> sun_path<span class="token punctuation">[</span><span class="token number">108</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// Path name</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.5.4 Port Number: Just Like the House Number" dir="auto" class="heading" id="2.2.5.4_Port_Number:_Just_Like_the_House_Number"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.5.4 Port Number: Just Like the House Number</h5><div class="heading-children"><div class="el-p"><p dir="auto">æ¯å½“ä¸»æœºä¸Šæœ‰è¿è¡Œä¸€ä¸ªç¨‹åºï¼Œé‚£ä¸ªç¨‹åºå°±ä¼šæ³¨å†Œä¸€ä¸ªç«¯å£å·ä»¥ä¾¿æ ‡è¯†ç¨‹åºçš„å…¥å£ã€‚è®¡ç®—æœºä¸Šæœ‰å¤šä¸ªç«¯å£ï¼ˆä¸€èˆ¬ä¸º 65536 ä¸ªï¼‰ï¼Œé€šè¿‡è¿™äº›ç«¯å£ï¼Œæ•°æ®å¯ä»¥å‡†ç¡®çš„å‘é€é“æ­£ç¡®çš„è¿›ç¨‹å¤„ã€‚å‘é‚®é€’å‘˜ç”¨é—¨ç‰Œå·æ¥å‘ä»¶é€ä»¶ä¸€æ ·ï¼Œç½‘ç»œé€šä¿¡ä¹Ÿéœ€è¦è¿™äº›ç«¯å£å·æ¥æ¥æ”¶æ•°æ®ã€‚</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.5.5 String <---> IP Address" dir="auto" class="heading" id="2.2.5.5_String_<--->_IP_Address"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.5.5 String &lt;---&gt; IP Address</h5><div class="heading-children"><div class="el-p"><p dir="auto">åœ¨å®šä¹‰å¹¶åˆå§‹åŒ–IPv4/IPv6çš„å¥—æ¥å­—ç»“æ„ä½“æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠäººç±»å¯è¯»çš„å­—ç¬¦ä¸²è½¬æ¢æˆæœºå™¨å¯è¯»çš„IPåœ°å€æ ¼å¼ä»¥ä¾¿è·¯ç”±å™¨å’Œå…¶ä»–ç½‘ç»œè®¾å¤‡èƒ½å¤Ÿè¿›è¡Œæ­£å¸¸çš„å¤„ç†å’Œæ•°æ®åŒ…è·¯ç”±ã€‚</p></div><div class="el-p"><p dir="auto">æˆ‘ä»¬å‰é¢åœ¨<a data-tooltip-position="top" aria-label="6.5 Inter-Process Communications > 2.2.4.2 Decimal Presentation and Network Byte Order Address Conversion" data-href="6.5 Inter-Process Communications#2.2.4.2 Decimal Presentation and Network Byte Order Address Conversion" href="congzhi's-os-series/6.5-inter-process-communications.html#2.2.4.2_Decimal_Presentation_and_Network_Byte_Order_Address_Conversion" class="internal-link" target="_self" rel="noopener nofollow">è¿™é‡Œ</a>è®¨è®ºäº†ä¸€ç‚¹IPåœ°å€å’ŒStingäº’ç›¸è½¬æ¢çš„åº“å‡½æ•°ã€‚å…¶ä¸­<code>inet_aton</code>ç”¨äºå°†IPv4åœ°å€ä»ç‚¹åˆ†åè¿›åˆ¶å­—ç¬¦è½¬æ¢æˆäºŒè¿›åˆ¶æ ¼å¼ã€‚è€Œåè€…<code>inet_pton</code>æ˜¯æ›´é€šç”¨çš„å‡½æ•°ï¼Œæ”¯æŒIPv4å’ŒIPv6çš„åœ°å€è½¬æ¢ã€‚</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.2.5.6 Initial the Network Address (IPv4)" dir="auto" class="heading" id="2.2.5.6_Initial_the_Network_Address_(IPv4)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.5.6 Initial the Network Address (IPv4)</h5><div class="heading-children"><div class="el-p"><p dir="auto">ç½‘ç»œåœ°å€å®šä¹‰å¥½ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ¥åˆå§‹åŒ–&nbsp;<code>sockaddr_in</code>&nbsp;ç»“æ„ä½“çš„å„ä¸ªå­—æ®µã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span> <span class="token comment">// for memset</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> addr<span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Clear the addr structure</span>
    addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span> <span class="token comment">// Use IPv4.</span>
    addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Indicate the port number.</span>
    addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token string">"192.168.1.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// inet_addr(INADDR_ANY); </span>
    <span class="token comment">// or inet_pton(AF_INET, "192.128.1.1", &amp;addr.sin_addr); // Recommended</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Address: %s, Port: %d\n"</span><span class="token punctuation">,</span> <span class="token function">inet_ntoa</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ntohs</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>sin_port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.2.6 Get the Address" dir="auto" class="heading" id="2.2.6_Get_the_Address"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.2.6 Get the Address</h4><div class="heading-children"><div class="el-p"><p dir="auto">è¿™ä¸ªå‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯å°†ä¸»æœºåï¼ˆå¦‚"example.com"ï¼‰æˆ–æœåŠ¡åï¼ˆå¦‚&nbsp;"http"ï¼‰è½¬æ¢ä¸ºå¯ä»¥ç”¨äºåˆ›å»ºå¥—æ¥å­—çš„åœ°å€ä¿¡æ¯ã€‚é€šå¸¸æ˜¯å®¢æˆ·ç«¯ç”¨æ¥è·å–æœåŠ¡å™¨ç«¯çš„ç½‘ç»œåœ°å€ä¿¡æ¯æ¥åˆ›å»ºæƒ³è¦çš„å¥—æ¥å­—ã€‚å¾—åˆ°æœåŠ¡å™¨çš„åœ°å€ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netdb.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">getaddrinfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>node<span class="token punctuation">,</span>    <span class="token comment">// e.g. "www,example.com" or IP</span>
				<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>service<span class="token punctuation">,</span> <span class="token comment">// e.g. "http" or port number</span>
				<span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> <span class="token operator">*</span>hints<span class="token punctuation">,</span>
				<span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> <span class="token operator">*</span><span class="token operator">*</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* 
Parameters:
	1. node: hostname or IP address
	2. service: protocol or port number
	3. hints: used to restrict the kind of connection you want
	4. res: pointer to be updated with the result

Return value: 
	- Returns 0 on success, and update the pointer res points to. 
	- Else on error.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">å½“æˆ‘ä»¬ä½¿ç”¨<code>getaddrinfo</code>æ—¶ï¼Œä¼šè¿”å›ç»“æ„ä½“<code>addrinfo</code>ï¼Œé€šè¿‡å…¶ä¸­çš„<code>ai_addr</code>å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æŒ‡å‘çš„<code>sockaddr_in</code>ç»“æ„ä½“ã€‚å¦‚ä¸‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> hints<span class="token punctuation">,</span> <span class="token operator">*</span>res<span class="token punctuation">;</span>
<span class="token function">getaddrinfo</span><span class="token punctuation">(</span><span class="token string">"example.com"</span><span class="token punctuation">,</span> <span class="token string">"http"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> <span class="token operator">*</span>ipv4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> <span class="token operator">*</span><span class="token punctuation">)</span>res<span class="token operator">-&gt;</span>ai_addr<span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.3 Client Workflow: Connect (TCP)" dir="auto" class="heading" id="2.3_Client_Workflow:_Connect_(TCP)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.3 Client Workflow: Connect (TCP)</h3><div class="heading-children"><div class="el-p"><p dir="auto">æˆ‘ä»¬å°†ä¸»æœºä¸Šçš„ä¸åŒçš„è¿›ç¨‹ç”¨ç«¯å£å·è¿›è¡Œæ ‡è¯†ï¼Œåœ¨ç½‘ç»œçš„è¿›ç¨‹é—´é€šä¿¡ä¸­ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“ä¸»æœºçš„åœ°å€ï¼ˆå³IPåœ°å€ï¼‰å’Œç«¯å£å·ï¼Œæˆ‘ä»¬å°±èƒ½å’Œé‚£ä¸ªâ€œè¿œæ–¹çš„â€è¿›ç¨‹è¿›è¡Œé€šä¿¡ã€‚åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œå®¢æˆ·ç«¯è¦åšåˆ°å®é™…ä¸Šè¿œä¸åŠæœåŠ¡å™¨ç«¯åšçš„å¤šã€‚å®¢æˆ·ç«¯è¦åšçš„ï¼Œå°±æ˜¯æ‰“æ‹›å‘¼ï¼ˆ<code>connect()</code>ï¼‰å¹¶è¯´è¯ï¼ˆsocketé€šä¿¡ï¼‰ã€‚</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.3.1 `connect()`" dir="auto" class="heading" id="2.3.1_`connect()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.3.1 <code>connect()</code></h4><div class="heading-children"><div class="el-p"><p dir="auto">ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹çœ‹å®¢æˆ·ç«¯æ˜¯å¦‚ä½•é€šè¿‡<code>connect()</code>æ¥ä¸æœåŠ¡å™¨æ‰“æ‹›å‘¼çš„ï¼Œä»¥ä¸‹æ˜¯å…¶å‡½æ•°åŸå‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* Blocking the thread by default.
Parameters:
	1. sockfd: The file descriptor for the socket to be connected. This is the integer value returned by the socket() function.
	2. addr: A pointer to a struct sockaddr, which contains the address of the target host. This can be cast to a pointer of specific address types, like sockaddr_in for IPv4 or sockaddr_in6 for IPv6.
	3. len: The size, in bytes, of the address structure pointed to by addr. Typically, this will be sizeof(struct sockaddr_in) or sizeof(struct sockaddr_in6).

Return value:
	- On success: Returns 0.
	- On failure: Returns -1, and errno is set to indicate the error. You can use the perror function or strerror to print the error message.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.3.2 Say Hello to Server" dir="auto" class="heading" id="2.3.2_Say_Hello_to_Server"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.3.2 Say Hello to Server</h4><div class="heading-children"><div class="el-p"><p dir="auto">åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å­¦è¿‡äº†<code>getaddrinfo</code>å‡½æ•°ï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æœåŠ¡å™¨çš„ç½‘ç»œåœ°å€ã€‚åœ¨å®¢æˆ·ç«¯çœ¼ä¸­ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†æœåŠ¡å™¨å«ä»€ä¹ˆåå­—äº†ã€‚çŸ¥é“äº†ç½‘ç»œåœ°å€ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>connect</code>å‡½æ•°æ¥ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ï¼Œä¸ºä¹‹åçš„äº¤æµåšå¥½é“ºå«ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> hints<span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> <span class="token operator">*</span>res<span class="token punctuation">;</span>
<span class="token keyword">int</span> sockfd<span class="token punctuation">;</span>

<span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>hints<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hints<span class="token punctuation">.</span>ai_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
hints<span class="token punctuation">.</span>ai_socktype <span class="token operator">=</span> SOCK_STREAM<span class="token punctuation">;</span>

<span class="token function">getaddrinfo</span><span class="token punctuation">(</span><span class="token string">"www.example.com"</span><span class="token punctuation">,</span> <span class="token string">"80"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>res<span class="token operator">-&gt;</span>ai_family<span class="token punctuation">,</span> res<span class="token operator">-&gt;</span>ai_socktype<span class="token punctuation">,</span> res<span class="token operator">-&gt;</span>ai_protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> status <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> res<span class="token operator">-&gt;</span>ai_addr<span class="token punctuation">,</span> res<span class="token operator">-&gt;</span>ai_addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœè¿”å›å€¼<code>status</code>ä¸º 0 å°±è¡¨ç¤ºæœåŠ¡å™¨æ”¶åˆ°äº†æˆ‘ä»¬çš„è¿æ¥è¯·æ±‚å¹¶æˆåŠŸå»ºç«‹è¿æ¥ã€‚</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.4 Server Workflow: Bind, Listen and Accept (TCP)" dir="auto" class="heading" id="2.4_Server_Workflow:_Bind,_Listen_and_Accept_(TCP)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.4 Server Workflow: Bind, Listen and Accept (TCP)</h3><div class="heading-children"><div class="el-p"><p dir="auto">åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼ŒæœåŠ¡å™¨çš„èŒè´£å¯æ¯”å®¢æˆ·ç«¯å¤§å¾—å¤šã€‚è¦å’ŒæœåŠ¡å™¨æ‰“æ‹›å‘¼ï¼Œå®¢æˆ·ç«¯å¯ä¸éœ€è¦çŸ¥é“è‡ªå·±çš„åå­—æ˜¯ä»€ä¹ˆï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªä¸´æ—¶çš„ç«¯å£å·ã€‚è€ŒæœåŠ¡å™¨å¯ä¸ä¸€æ ·ï¼Œå› ä¸ºè¦æ—¶æ—¶åˆ»åˆ»ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚æœåŠ¡å™¨å¿…é¡»æ˜¾å¼è°ƒç”¨<code>bind()</code>å°†å¥—æ¥å­—<strong>ç»‘å®š</strong>åˆ°ç‰¹å®šçš„ç«¯å£å·ä¸Šã€‚ï¼ˆæ¯•ç«Ÿè¦æ˜¯ä½ çš„åå­—è¦æ˜¯éšæœºçš„ï¼Œå®¢æˆ·ç«¯å¯¹å»ºç«‹è¿æ¥å°†æ¯«æ— å¤´ç»ªï¼‰</p></div><div class="el-p"><p dir="auto">ç»‘å®šå®Œæˆä¹‹åï¼ŒæœåŠ¡å™¨å¼€å§‹è¿è¡Œå¹¶éœ€è¦æŒç»­<strong>ç›‘å¬</strong>æ¥è‡ªå¤–ç•Œçš„è¿æ¥è¯·æ±‚ï¼Œä»¥ä¾¿å¯¹å®¢æˆ·ç«¯è¿›è¡ŒæœåŠ¡ã€‚å½“æœåŠ¡å™¨ç›‘å¬åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ä¹‹åï¼Œå®¢æˆ·ç«¯ä¼šæ¥å—å¹¶å»ºç«‹ä¸€ä¸ªä¸“é—¨çš„å¥—æ¥å­—æ¥äºè¿™ä¸ªç‰¹å®šçš„å®¢æˆ·ç«¯è¿›è¡Œé€šè®¯ã€‚</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.4.1 `bind()`" dir="auto" class="heading" id="2.4.1_`bind()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.4.1 <code>bind()</code></h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>bind()</code>å‡½æ•°ç”¨æ¥è®©è¿›ç¨‹ä¸ä¸€ä¸ªç‰¹å®šçš„ç«¯å£å·è¿›è¡Œç»‘å®šçš„å‡½æ•°ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. sockfd: The file descriptor of the socket to be bound. This is the integer value returned by the socket() function.
	2. addr: A pointer to a struct sockaddr, which contains the address to bind to the socket. This can be cast to a pointer of specific address types, like sockaddr_in for IPv4 or sockaddr_in6 for IPv6.
	3. addrlen: The size, in bytes, of the address structure pointed to by addr. Typically, this will be sizeof(struct sockaddr_in) or sizeof(struct sockaddr_in6).

Return value:
	- On success: Returns 0.
	- On failure: Returns -1, and errno is set to indicate the error. You can use the perror function or strerror to print the error message.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><strong>ä¾‹å­1</strong>ï¼š</p></div><div class="el-pre"><pre class="language-cpp" tabindex="0"><code data-line="0" class="language-cpp is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> sockfd<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> server_addr<span class="token punctuation">;</span>

    sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sockfd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"socket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    server_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> INADDR_ANY<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>server_addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>server_addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"bind"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Other code...</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">å®¢æˆ·ç«¯è¿›ç¨‹çš„<code>bind()</code>å¹¶ä¸æ˜¯å¿…è¦çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.4.2 `listen()`" dir="auto" class="heading" id="2.4.2_`listen()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.4.2 <code>listen()</code></h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>listen()</code>&nbsp;å‡½æ•°ç”¨äºå°†å¥—æ¥å­—è®¾ç½®ä¸ºè¢«åŠ¨æ¨¡å¼ï¼Œä»¥ä¾¿æ¥å—ä¼ å…¥çš„è¿æ¥è¯·æ±‚ã€‚<code>listen()</code>ç³»ç»Ÿè°ƒç”¨ä¼šåˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º<code>backlog</code>çš„é˜Ÿåˆ—ä¿å­˜æœªå¤„ç†çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚æˆ‘ä»¬ä¼šäººä¸ºåœ°è®¾ç½®ä¸€ä¸ª<code>backlog</code>ã€‚å½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„è¿æ¥æ•°ç­‰äºè¿™ä¸ªæ•°å­—æ—¶ï¼Œå®¢æˆ·ç«¯çš„è¿æ¥å°†è¢«æœåŠ¡å™¨æ‹’ç»ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">listen</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">int</span> backlog<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. sockfd: The file descriptor of the socket that will be put into a listening state. This is the integer value returned by the socket() function.
	2. backlog: The maximum length to which the queue of pending connections may grow. Typically a small positive integer.

Return value:
	- On success: Returns 0.
	- On failure: Returns -1, and errno is set to indicate the error. You can use the perror function or strerror to print the error message.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><strong>ä¾‹å­2</strong>ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token comment">// Assume the bind() function has been called</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">listen</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"listen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Other code...</span>
<span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.4.3 `accept()`" dir="auto" class="heading" id="2.4.3_`accept()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.4.3 <code>accept()</code></h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>accept()</code>&nbsp;å‡½æ•°ç”¨äºæ¥å—ä¼ å…¥çš„è¿æ¥è¯·æ±‚ï¼Œä»ç›‘å¬å¥—æ¥å­—é˜Ÿåˆ—ä¸­æå–ç¬¬ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸ºæ–°çš„è¿æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¥—æ¥å­—ã€‚<code>accept</code>æ˜¯ä¸€ä¸ªé˜»å¡è°ƒç”¨(blocking call)ï¼Œå½“è°ƒç”¨<code>accept</code>æ—¶ï¼Œå®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨çš„ç›‘å¬å°†ä¼šè¢«é˜»å¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ¬¡æœåŠ¡å™¨åªèƒ½æ¥å—ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> <span class="token operator">*</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. sockfd: The file descriptor of the listening socket. This is the integer value returned by the socket() function and used by the bind() and listen() functions.
	2. addr: A pointer to a struct sockaddr, which will be filled with the address of the connecting entity. Can be cast to a pointer of specific address types, like sockaddr_in for IPv4 or sockaddr_in6 for IPv6.
	3. addrlen: A pointer to a socklen_t, which on input contains the size of addr, and on output contains the size of the address returned.

Return value:
	- On success: Returns a new file descriptor for the accepted socket.
	- On failure: Returns -1, and errno is set to indicate the error. You can use the perror function or strerror to print the error message.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><strong>ä¾‹å­3</strong>ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded">    <span class="token comment">// Assume bind() and listen() functions have been called</span>

    sin_size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    new_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>client_addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sin_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>new_fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"accept"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Connection accepted"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

    <span class="token comment">// Other code...</span>
    <span class="token function">close</span><span class="token punctuation">(</span>new_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">å¦‚æœä½ ä¸å…³å¿ƒå®¢æˆ·ç«¯æ˜¯è°ï¼Œä½ å¯ä»¥å°†<code>accept()</code>åé¢çš„å­—æ®µè®¾ç½®æˆNULLã€‚å±Šæ—¶ï¼ŒæœåŠ¡å™¨å°±ä¸éœ€è¦å­˜å‚¨å®¢æˆ·ç«¯çš„è¿™äº›ä¿¡æ¯äº†ï¼Œç®€åŒ–äº†ä»£ç ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> new_fd <span class="token operator">=</span> <span class="token function">accept</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">ä¸Šé¢çš„ä¾‹å­ä¸­<code>accept</code>è·å¾—çš„æ–°çš„æ–‡ä»¶æè¿°ç¬¦<code>new_fd</code>ä»£è¡¨äº†ä¸å®¢æˆ·ç«¯çš„è¿æ¥ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¥—æ¥å­—è¿›è¡Œæ¥æ”¶å’Œå‘é€æ•°æ®ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤å®¢æˆ·ç«¯çš„åœ°å€ä¿¡æ¯ã€‚</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.5 Communication (TCP)" dir="auto" class="heading" id="2.5_Communication_(TCP)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.5 Communication (TCP)</h3><div class="heading-children"><div class="el-p"><p dir="auto">å½“è¿æ¥å»ºç«‹ã€ä¸€åˆ‡å‡†å¤‡å°±ç»ªä¹‹åï¼Œé€šä¿¡å°±å¯ä»¥å¼€å§‹äº†ã€‚åœ¨TCPçš„ç½‘ç»œé€šä¿¡ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨<code>send()</code>å’Œ<code>recv()</code>ä¸¤ä¸ªå‡½æ•°æ¥å‘é€å’Œæ¥æ”¶ä¿¡æ¯ã€‚</p></div><div class="el-p"><p dir="auto">å› ä¸ºå¥—æ¥å­—ä¹Ÿå¯ä»¥çœ‹æˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æœ€åº•å±‚çš„<code>read()</code>å’Œ<code>write()</code>ç³»ç»Ÿè°ƒç”¨æ¥æ¥æ”¶å’Œå‘é€ç½‘ç»œä¿¡æ¯ã€‚åœ¨ä½¿ç”¨<code>read()</code>æ—¶ï¼Œä½ éœ€è¦é€šè¿‡å¾ªç¯ä¸€ç›´æ¥æ”¶æ•°æ®ï¼Œå› ä¸ºä½ ä¸çŸ¥é“è¦æ¥æ”¶å¤šå°‘æ•°æ®ã€‚åœ¨<code>write()</code>æ—¶ï¼Œä½ ä¹Ÿéœ€è¦ä½¿ç”¨å¾ªç¯æ¥ç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½èƒ½å¤Ÿå‘å‡ºå»ï¼ˆç¼“å­˜æ»¡ï¼‰ã€‚</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.5.1 `send()`" dir="auto" class="heading" id="2.5.1_`send()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.5.1 <code>send()</code></h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>send()</code>&nbsp;å‡½æ•°ç”¨äºé€šè¿‡å¥—æ¥å­—å‘é€æ•°æ®ã€‚å®ƒå°†æŒ‡å®šç¼“å†²åŒºä¸­çš„æ•°æ®å‘é€åˆ°ä¸å¥—æ¥å­—å…³è”çš„å¦ä¸€ç«¯ã€‚<code>send()</code>æ“ä½œæ˜¯é˜»å¡çš„ï¼Œå³å¦‚æœå¥—æ¥å­—å‘é€ç¼“å†²åŒºå·²æ»¡ï¼Œ<code>send()</code>&nbsp;è°ƒç”¨å°†é˜»å¡ï¼Œç›´åˆ°æœ‰è¶³å¤Ÿçš„ç¼“å†²ç©ºé—´ä¸ºæ­¢ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> msg<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters
	1. sockfd: Socket to send the data to
	2. msg: Bytes of data to be sent
	3. length: Size of the message
	4. flags: Options, giving in 0 will suffice, common flags are:
	    - MSG_CONFIRM: Tell the link layer that the packet was received.
	    - MSG_DONTWAIT: Enable non-blocking operation.
	    - MSG_OOB: Send out-of-band data.
	    - MSG_PEEK: Peek at the incoming message.
	    - MSG_WAITALL: Wait for the full request or error.
	    - MSG_NOSIGNAL: Do not generate SIGPIPE.
	    - MSG_MORE: Sender will send more data.

Return value: number of bytes sent, returns -1 if something went wrong
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.5.2 `recv()`" dir="auto" class="heading" id="2.5.2_`recv()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.5.2 <code>recv()</code></h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>recv()</code>&nbsp;å‡½æ•°ç”¨äºé€šè¿‡å¥—æ¥å­—æ¥æ”¶æ•°æ®ã€‚å®ƒä¼šä»æŒ‡å®šçš„å¥—æ¥å­—æ¥æ”¶æ•°æ®å¹¶å°†å…¶å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­ã€‚ä¸&nbsp;<code>send()</code>&nbsp;ç±»ä¼¼ï¼Œ<code>recv()</code>ä¹Ÿæ˜¯é˜»å¡çš„ï¼Œå³å¦‚æœæ²¡æœ‰å¯ç”¨æ•°æ®ï¼Œ<code>recv()</code>&nbsp;å°†é˜»å¡ç¨‹åºï¼Œç›´åˆ°æ•°æ®åˆ°è¾¾ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">recv</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> buffer<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters
	1. sockfd: Where to receive data from
	2. buffer: Where the data goes
	3. length: The maximum size of the buffer
	4. flags: Flags can also be 0 here, common flags are:
	    - MSG_CONFIRM: Tell the link layer that the packet was received.
	    - MSG_DONTWAIT: Enable non-blocking operation.
	    - MSG_OOB: Receive out-of-band data.
	    - MSG_PEEK: Peek at the incoming message.
	    - MSG_WAITALL: Wait for the full request or error.
	    - MSG_NOSIGNAL: Do not generate SIGPIPE.

Return value: 
	- Returns the number of bytes actually read into the buffer on success.
	- Returns 0 if the connection has been closed.
	- Returns -1 on error.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.5.3 Are You Still There?" dir="auto" class="heading" id="2.5.3_Are_You_Still_There?"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.5.3 Are You Still There?</h4><div class="heading-children"><div class="el-p"><p dir="auto">çŸ¥é“å¦ä¸€æ–¹æ˜¯å¦è¿˜åœ¨å‘é€æŠ¥æ–‡å¹¶ä¸å®¹æ˜“ã€‚ä½†æ˜¯æˆ‘ä»¬æœ‰ä¸€äº›æœºåˆ¶æ¥æ£€æµ‹å¯¹æ–¹æ˜¯å¦ä»ç„¶åœ¨ä¼ è¾“æ•°æ®ã€‚æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ï¼Œå½“ä¸€ç«¯å‘é€äº†æŠ¥æ–‡ï¼Œä¸€æ®µæ—¶é—´åä»æœªæ¥å—åˆ°å‘æœ¬ç«¯å‘æ¥çš„å“åº”æŠ¥æ–‡å°±æ–­å¼€è¿æ¥ã€‚ç”¨è¿™ç§æ–¹æ³•é˜²æ­¢ç¨‹åºä¸€ç›´é˜»å¡ä¸‹å»ã€‚</p></div><div class="el-p"><p dir="auto">è¿™é‡Œï¼Œæˆ‘ä»¬ä¸»è¦é€šè¿‡é€šè¿‡<code>setsockopt</code>è®¾ç½®è¶…æ—¶æ—¶é—´ã€å¯ç”¨Keep-Aliveç­‰å„ç§å¥—æ¥å­—å±æ€§ã€‚</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.5.3.1 TCP Keep-Alive" dir="auto" class="heading" id="2.5.3.1_TCP_Keep-Alive"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.5.3.1 TCP Keep-Alive</h5><div class="heading-children"><div class="el-p"><p dir="auto">TCPåè®®æœ¬èº«æ”¯æŒ&nbsp;Keep-Alive&nbsp;æœºåˆ¶ï¼Œç”¨äºæ£€æµ‹ç©ºé—²è¿æ¥æ˜¯å¦ä»ç„¶æ´»è·ƒã€‚é€šè¿‡åœ¨åè®®å±‚é¢å‘é€æ¢æµ‹æŠ¥æ–‡å¹¶ç­‰å¾…å“åº”ï¼Œå¯ä»¥åˆ¤æ–­è¿æ¥çš„çŠ¶æ€ã€‚å¯ä»¥ä½¿ç”¨<code>setsockopt</code>å‡½æ•°åœ¨åº”ç”¨ç¨‹åºä¸­å¯ç”¨è¿™é¡¹åŠŸèƒ½ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">enable_tcp_keepalive</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Enable keep-alive.</span>
    <span class="token keyword">int</span> optval <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">setsockopt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_KEEPALIVE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>optval<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>optval<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> keepidle <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span> <span class="token comment">// ç©ºé—²æ—¶é—´ï¼ˆç§’ï¼‰</span>
    <span class="token keyword">int</span> keepinterval <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// æ¢æµ‹æŠ¥æ–‡å‘é€é—´éš”ï¼ˆç§’ï¼‰</span>
    <span class="token keyword">int</span> keepcount <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// æœ€å¤§é‡è¯•æ¬¡æ•°</span>

    <span class="token function">setsockopt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> IPPROTO_TCP<span class="token punctuation">,</span> TCP_KEEPIDLE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>keepidle<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>keepidle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setsockopt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> IPPROTO_TCP<span class="token punctuation">,</span> TCP_KEEPINTVL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>keepinterval<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>keepinterval<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setsockopt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> IPPROTO_TCP<span class="token punctuation">,</span> TCP_KEEPCNT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>keepcount<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>keepcount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ç”¨äº†TCPæ‰€æä¾›çš„Keep-aliveæœºåˆ¶ã€‚ä¹‹åï¼Œæˆ‘ä»¬è¿˜è®¾ç½®äº†å…¶ä½™å‡ é¡¹å‚æ•°ï¼š</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><strong>keepidle</strong>ï¼šè¡¨ç¤ºå¦‚æœè¿æ¥åœ¨keepidelç§’å†…æ²¡æœ‰ä»»ä½•æ´»åŠ¨ï¼Œå¼€å§‹å‘é€Keep-Aliveæ¢æµ‹æŠ¥æ–‡ã€‚</li>
<li data-line="1" dir="auto"><strong>keepinterval</strong>ï¼šè¡¨ç¤ºæ¯éš”å¤šå°‘ç§’å‘é€ä¸€æ¬¡æ¢æµ‹æŠ¥æ–‡ï¼Œç›´åˆ°æ”¶åˆ°å¯¹æ–¹çš„å“åº”æˆ–è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚</li>
<li data-line="2" dir="auto"><strong>keepcount</strong>ï¼šè¡¨ç¤ºåœ¨æœªæ”¶åˆ°å¯¹æ–¹å“åº”æ—¶ï¼Œæœ€å¤šå‘é€keepcountæ¬¡æ¢æµ‹æŠ¥æ–‡ã€‚å¦‚æœåœ¨å°è¯•è¿™ä¹ˆå¤šæ¬¡åä»æœªæ”¶åˆ°å“åº”ï¼Œå°±è®¤ä¸ºè¿æ¥å·²æ–­å¼€ã€‚</li>
</ol></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.5.3.2 Timeouts" dir="auto" class="heading" id="2.5.3.2_Timeouts"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.5.3.2 Timeouts</h5><div class="heading-children"><div class="el-p"><p dir="auto">é€šè¿‡è®¾ç½®æ¥æ”¶è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®æ—¶æ–­å¼€è¿æ¥ã€‚è¿™ç§æ–¹æ³•å¯¹çªå‘æ€§ä¼ è¾“è¾ƒä¸ºæœ‰æ•ˆï¼Œä½†å¯èƒ½ä¼šè¯¯åˆ¤ä¼ è¾“è¾ƒæ…¢çš„æƒ…å½¢ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">set_recv_timeout</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">int</span> seconds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">timeval</span> timeout<span class="token punctuation">;</span>
    timeout<span class="token punctuation">.</span>tv_sec <span class="token operator">=</span> seconds<span class="token punctuation">;</span>
    timeout<span class="token punctuation">.</span>tv_usec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">setsockopt</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_RCVTIMEO<span class="token punctuation">,</span> <span class="token operator">&amp;</span>timeout<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"setsockopt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.5.3.3 Heartbeat Messages" dir="auto" class="heading" id="2.5.3.3_Heartbeat_Messages"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.5.3.3 Heartbeat Messages</h5><div class="heading-children"><div class="el-p"><p dir="auto">é€šè¿‡å®šæœŸå‘é€å¿ƒè·³åŒ…ï¼ˆçŸ­çš„ç©ºæ•°æ®åŒ…ï¼‰æ¥ç¡®è®¤è¿æ¥æ˜¯å¦ä¿æŒã€‚å¯¹æ–¹æ”¶åˆ°å¿ƒè·³åŒ…æ—¶ï¼Œéœ€è¦å›å¤ä¸€ä¸ªç¡®è®¤åŒ…ã€‚å¦‚æœæ²¡æœ‰æ”¶åˆ°ç¡®è®¤åŒ…ï¼Œå¯ä»¥è®¤ä¸ºè¿æ¥å·²ç»æ–­å¼€ã€‚å¿ƒè·³æ£€æµ‹éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸¤ç«¯å…±åŒé…åˆã€‚åœ¨å®¢æˆ·ç«¯ï¼ŒåŒæ ·éœ€è¦å¤„ç†å¿ƒè·³æ¶ˆæ¯ï¼Œå¹¶å›å¤æœåŠ¡å™¨å‘é€çš„å¿ƒè·³åŒ…ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token comment">// server-side code</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>heartbeat <span class="token operator">=</span> <span class="token string">"HEARTBEAT"</span><span class="token punctuation">;</span>
    <span class="token function">send</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> heartbeat<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>heartbeat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> bytes_received <span class="token operator">=</span> <span class="token function">recv</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bytes_received <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errno <span class="token operator">==</span> EWOULDBLOCK <span class="token operator">||</span> errno <span class="token operator">==</span> EAGAIN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Receive timeout, no data received\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"recv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Received heartbeat response: %.*s\n"</span><span class="token punctuation">,</span> bytes_received<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// client side code</span>
<span class="token comment">// ...</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">è¿™ä¸ªä¾‹å­ä»éœ€å®Œå–„ï¼Œå› ä¸ºæ²¡æœ‰ç»“åˆè¶…æ—¶æœºåˆ¶ï¼Œå¦‚æœå¦ä¸€æ–¹ä¸€ç›´ä¸å‘é€å“åº”æŠ¥æ–‡å°±ä¼šä½¿å¾—<code>recv()</code>è°ƒç”¨æ— é™æœŸé˜»å¡ä¸‹å»ã€‚</p></div></div></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.5.4 Use Format to Serialization" dir="auto" class="heading" id="2.5.4_Use_Format_to_Serialization"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.5.4 Use Format to Serialization</h4><div class="heading-children"><div class="el-p"><p dir="auto">Sending and Receiving Struct Type. XML and JSON are popular format for information transfer.</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.6 Datagrams" dir="auto" class="heading" id="2.6_Datagrams"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.6 Datagrams</h3><div class="heading-children"><div class="el-p"><p dir="auto">ä¸åŒäºTCPï¼ŒUDPæ˜¯ç²—é²çš„ã€æ²¡æœ‰æ•™å…»çš„ï¼Œå› ä¸ºUDPå¿½ç•¥äº†æ‰“æ‹›å‘¼çš„è¿‡ç¨‹ã€‚åŒæ—¶ï¼ŒUDPä¸ä¿è¯æ•°æ®åŒ…åˆ°è¾¾çš„å®Œæ•´æ€§ï¼Œå› è€ŒUDPè¢«ç§°ä¸ºæ— è¿æ¥çš„ã€è½»é‡çº§çš„é€šä¿¡åè®®ã€‚</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.6.1 sendto()" dir="auto" class="heading" id="2.6.1_sendto()"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.6.1 sendto()</h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>sendto</code>&nbsp;å‡½æ•°ç”¨äºåœ¨æ— è¿æ¥ï¼ˆå¦‚UDPï¼‰å¥—æ¥å­—ä¸Šå‘é€æ•°æ®æŠ¥ï¼ˆdatagramï¼‰ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">sendto</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>msg<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>dest_addr<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. sockfd: The socket file descriptor.
	2. msg: A pointer to the buffer containing the message to be sent.
	3. len: The length of the message in bytes.
	4. flags: Options to modify the behavior of the function.
	5. dest_addr: A pointer to the struct sockaddr containing the destination address.
	6. addrlen: The size of the destination address structure.

Return value:
	- On success: Returns the number of bytes sent.
	- On failure: Returns -1, and errno is set to indicate the error. You can use the perror function or strerror to print the error message.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.6.2 recvfrom()" dir="auto" class="heading" id="2.6.2_recvfrom()"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.6.2 recvfrom()</h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>recvfrom</code>&nbsp;å‡½æ•°ç”¨äºåœ¨æ— è¿æ¥ï¼ˆå¦‚UDPï¼‰å¥—æ¥å­—ä¸Šæ¥æ”¶æ•°æ®æŠ¥ï¼ˆdatagramï¼‰ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">recvfrom</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>src_addr<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> <span class="token operator">*</span>addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. sockfd: The socket file descriptor.
	2. buf: A pointer to the buffer where the received message will be stored.
	3. len: The length of the buffer.
	4. flags: Options to modify the behavior of the function.
	5. src_addr: A pointer to the struct sockaddr where the source address will be stored. Can be NULL.
	6. addrlen: A pointer to a socklen_t object which will contain the size of the source address structure.

Return value:
	- On success: Returns the number of bytes received.
	- On failure: Returns -1, and errno is set to indicate the error. You can use the perror function or strerror to print the error message.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="2.7 cURL (libcurl)" dir="auto" class="heading" id="2.7_cURL_(libcurl)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.7 cURL (libcurl)</h3><div class="heading-children"><div class="el-p"><p dir="auto">This part will be discussed in the <a data-href="14. Asynchronous IO" href="congzhi's-os-series/14.-asynchronous-io.html" class="internal-link" target="_self" rel="noopener nofollow">14. Asynchronous IO</a>.</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.7.1 Webservices" dir="auto" class="heading" id="2.7.1_Webservices"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.7.1 Webservices</h4><div class="heading-children"><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;curl/curl.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    CURL <span class="token operator">*</span>curl<span class="token punctuation">;</span>
    CURLcode res<span class="token punctuation">;</span>

    <span class="token function">curl_global_init</span><span class="token punctuation">(</span>CURL_GLOBAL_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    curl <span class="token operator">=</span> <span class="token function">curl_easy_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>curl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">curl_easy_setopt</span><span class="token punctuation">(</span>curl<span class="token punctuation">,</span> CURLOPT_URL<span class="token punctuation">,</span> <span class="token string">"http://example.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_easy_setopt</span><span class="token punctuation">(</span>curl<span class="token punctuation">,</span> CURLOPT_FOLLOWLOCATION<span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res <span class="token operator">=</span> <span class="token function">curl_easy_perform</span><span class="token punctuation">(</span>curl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>res <span class="token operator">!=</span> CURLE_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"curl_easy_perform() failed: %s\n"</span><span class="token punctuation">,</span> <span class="token function">curl_easy_strerror</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">curl_easy_cleanup</span><span class="token punctuation">(</span>curl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">curl_global_cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="2.7.2 Callbacks Setting Up" dir="auto" class="heading" id="2.7.2_Callbacks_Setting_Up"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.7.2 Callbacks Setting Up</h4><div class="heading-children"><div class="el-h5 heading-wrapper"><h5 data-heading="2.7.2.1 Read Callback" dir="auto" class="heading" id="2.7.2.1_Read_Callback"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.7.2.1 Read Callback</h5><div class="heading-children"><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token class-name">size_t</span> <span class="token function">read_callback</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> buffer<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">,</span> <span class="token class-name">size_t</span> nitems<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>inputdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// size_t: represents a size and can be treated like an integer</span>
<span class="token comment">// buffer: the area where you are going to put the data to send</span>
<span class="token comment">// nitems: the number of items</span>
<span class="token comment">// return value: the number of bytes successfully put there, 0 signals EOF</span>

</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.7.2.2 Write Callback" dir="auto" class="heading" id="2.7.2.2_Write_Callback"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.7.2.2 Write Callback</h5><div class="heading-children"><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token class-name">size_t</span> <span class="token function">write_callback</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">,</span> <span class="token class-name">size_t</span> nmemb<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>userdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// size_t: represents a size and can be treated like an integer</span>
<span class="token comment">// ptr: points to whatever data we have received</span>
<span class="token comment">// nmemb: the size of the data</span>
<span class="token comment">// size: always 1</span>
<span class="token comment">// userdata: arbitrary structure we get to pass directly to this punction</span>
<span class="token comment">// return value: number of bytes processed</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="2.7.2.3 Registration of Callback" dir="auto" class="heading" id="2.7.2.3_Registration_of_Callback"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>2.7.2.3 Registration of Callback</h5><div class="heading-children"><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded">CURLcode <span class="token function">curl_easy_setopt</span><span class="token punctuation">(</span>CURL <span class="token operator">*</span>handle<span class="token punctuation">,</span> CURLOPT_READFUNCTION<span class="token punctuation">,</span> read_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
CURLcode <span class="token function">curl_easy_setopt</span><span class="token punctuation">(</span>CURL <span class="token operator">*</span>handle<span class="token punctuation">,</span> CURLOPT_READDATA<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>

CURLcode <span class="token function">curl_easy_setopt</span><span class="token punctuation">(</span>CURL <span class="token operator">*</span>handle<span class="token punctuation">,</span> CURLOPT_WRITEFUNCTION<span class="token punctuation">,</span> write_callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
CURLcode <span class="token function">curl_easy_setopt</span><span class="token punctuation">(</span>CURL <span class="token operator">*</span>handle<span class="token punctuation">,</span> CURLOPT_WRITEDATA<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="ç¬¬ä¸‰è¯¾ Pipes and Shared Memory" dir="auto" class="heading" id="ç¬¬ä¸‰è¯¾_Pipes_and_Shared_Memory"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>ç¬¬ä¸‰è¯¾ Pipes and Shared Memory</h2><div class="heading-children"><div class="el-hr"><hr></div><div class="el-h3 heading-wrapper"><h3 data-heading="3.1 UNIX Pipes" dir="auto" class="heading" id="3.1_UNIX_Pipes"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1 UNIX Pipes</h3><div class="heading-children"><div class="el-p"><p dir="auto">å½“æˆ‘ä»¬ç”¨<strong>ç®¡é“</strong>æœºåˆ¶è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨å†…æ ¸ç©ºé—´ä¸­åˆ’åˆ†é¢å¤–çš„å†…æ ¸ç©ºé—´ç”¨äºæ•°æ®å…±äº«ã€‚Pipeæ˜¯å•å‘ä¼ è¾“çš„ï¼ˆåƒæ°´ç®¡ä¸€æ ·ï¼‰ï¼Œä¸€ä¸ªç®¡é“çš„æ•°æ®<strong>åªèƒ½å‘ä¸€ä¸ªæ–¹å‘æµåŠ¨ï¼ˆå†™ç«¯åˆ°è¯»ç«¯ï¼‰</strong>ï¼Œæ‰€ç”¨å¦‚æœä½ æƒ³å®ç°<strong>å…¨åŒå·¥åˆ™éœ€è¦ä¸¤ä¸ªç®¡é“</strong>ã€‚ç®¡é“æœ‰ä¸¤ç§å®ç°æœºåˆ¶ï¼š<code>pipe()</code>å’Œ<code>mkfifo()</code>ã€‚</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20241130023253.jpg" src="Pasted image 20241130023253.jpg" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241130023253.jpg" src="congzhi's-os-series/pics/pasted-image-20241130023253.jpg"></span></p></div><div class="el-p"><p dir="auto">Pipeä¸€èˆ¬ä¸Šæ˜¯<strong>å¾ªç¯é˜Ÿåˆ—</strong>ï¼Œç®¡é“ç¼“å†²åŒºçš„å¤§å°ï¼ˆLinuxä¸Šï¼‰é€šå¸¸æ˜¯4KB-64KBä¹‹é—´ã€‚<strong>ç®¡é“ä»¥å­—èŠ‚æµçš„æ–¹å¼é€šä¿¡</strong>ï¼Œå‘é€æ–¹æ¯ä¸€æ¬¡å‘é€éƒ½ä¼šå°†æ¶ˆæ¯åˆ†ä¸ºå¾ˆå¤šä¸ªå°å—ï¼ˆä¸€å­—èŠ‚ï¼‰ä¹‹åå°†å­—èŠ‚å—æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åæ¥æ”¶æ–¹ä¼šä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„æ¥æ”¶æ•°æ®ã€‚<strong><code>pipe</code>çš„ç³»ç»Ÿè°ƒç”¨æä¾›åŒæ­¥æœºåˆ¶ï¼ˆé˜»å¡é”ï¼‰</strong>ï¼Œå¦‚æœç¼“å†²åŒºå·²æ»¡/ä¸ºç©ºæ—¶ï¼Œå†™æ“ä½œ/è¯»æ“ä½œå°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ•°æ®è¢«è¯»å‡º/å†™å…¥ã€‚å‘½åå’ŒåŒ¿åç®¡é“è€Œè¨€éƒ½æ˜¯å¦‚æ­¤ã€‚</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="3.1.1 Ordinary Pipes(Anonymous Pipes)" dir="auto" class="heading" id="3.1.1_Ordinary_Pipes(Anonymous_Pipes)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1.1 Ordinary Pipes(Anonymous Pipes)</h4><div class="heading-children"><div class="el-p"><p dir="auto">åœ¨ç±»Unixçš„ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥ç”¨<code>pipe()</code>ç³»ç»Ÿè°ƒç”¨å‡½æ•°æ¥åˆ›å»ºç”¨äºè¿›ç¨‹é—´é€šä¿¡çš„åŒ¿åç®¡é“ã€‚<strong>åŒ¿åç®¡é“åªèƒ½åœ¨æœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´ä½¿ç”¨</strong>ã€‚åŒ¿åç®¡é“çš„åˆ›å»ºå‡½æ•°å¦‚ä¸‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token function">pipe</span><span class="token punctuation">(</span><span class="token keyword">int</span> pipefd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// pipefd[0] is the read-end</span>
<span class="token comment">// pipefd[1] is the write-end</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.1.1.1 Creating an Anonymous Pipe" dir="auto" class="heading" id="3.1.1.1_Creating_an_Anonymous_Pipe"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1.1.1 Creating an Anonymous Pipe</h5><div class="heading-children"><div class="el-p"><p dir="auto">ä¸‹é¢ï¼Œæˆ‘ä»¬ä¸¾ä¸ªåˆ›å»ºåŒ¿åç®¡é“çš„ä¾‹å­ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">"hello world"</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> rdBuf<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> pipefd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pipe</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"pipe create fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"this is child process\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">memset</span><span class="token punctuation">(</span>readBuf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rdBuf<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"read fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"I have read the character string: %s\n"</span><span class="token punctuation">,</span>rd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">close</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span><span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"this is parent process\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">close</span><span class="token punctuation">(</span>pipefd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">å‚æ•°<code>pipefd</code>æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ•´å‹å…ƒç´ çš„æ•°ç»„ï¼Œç”¨æ¥å­˜æ”¾ç®¡é“çš„è¯»å†™æ–‡ä»¶æè¿°ç¬¦ã€‚</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>pipefd[0]</code>æ˜¯ç®¡é“çš„è¯»ç«¯ï¼Œ<code>read(pipefd[0], buffer, sizeof(buffer))</code>ä»ç®¡é“ä¸­è¯»å‡ºå¹¶å†™åˆ°<code>buffer</code>ä¸­ã€‚</li>
<li data-line="1" dir="auto"><code>pipefd[1]</code>æ˜¯ç®¡é“çš„å†™ç«¯ï¼Œ<code>write(pipefd[1]), message, strlen(message) + 1)</code> å°†messageä¸­çš„æ•°æ®å†™åˆ°ç®¡é“é‡Œé¢ã€‚<br>
å½“<code>pipe</code>ç³»ç»Ÿè°ƒç”¨æˆåŠŸï¼Œè¿”å›0ï¼Œå¤±è´¥è¿”å›-1å¹¶è®¾ç½®<code>errno</code>ã€‚</li>
</ul></div><div class="el-p"><p dir="auto">åªè¦ä»»ä¸€ç«¯çš„æ–‡ä»¶æè¿°ç¬¦æ²¡æœ‰è¢«å…³é—­ï¼Œpipeå°±ä¼šæ¥ç€å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰æˆ‘ä»¬<code>close()</code>pipeçš„ä¸¤ç«¯ä¹‹åï¼Œpipeæ‰ä¼šè¢«æ¸…ç†æ‰ã€‚</p></div></div></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="3.1.2 FIFO (Named Pipe)" dir="auto" class="heading" id="3.1.2_FIFO_(Named_Pipe)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1.2 FIFO (Named Pipe)</h4><div class="heading-children"><div class="el-p"><p dir="auto">ç®¡é“æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç±»å‹ï¼Œæœ¬è´¨è¿˜æ˜¯æ–‡ä»¶ã€‚æˆ‘ä»¬ç”¨<code>open</code>å‡½æ•°æ‰“å¼€ç£ç›˜æ–‡ä»¶çš„æ“ä½œä¼šå°†æ–‡ä»¶æè¿°ç¬¦(file descriptor, fd)å­˜æ”¾åœ¨è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ä¸­ã€‚åœ¨åŒ¿åç®¡é“çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å¯¹è¿™ç§ç®¡é“â€œæ–‡ä»¶â€å¹¶ä¸æ•æ„Ÿï¼Œå› ä¸ºåŒ¿åç®¡é“çš„æ–‡ä»¶æè¿°ç¬¦è™½ç„¶äº§ç”Ÿäº†ï¼Œä½†å´æ˜¯ä¸€ç›´å­˜æ”¾åœ¨è¿›ç¨‹çš„è™šå­˜ä¸­å¯¹å†…æ ¸ç©ºé—´çš„å†…å­˜è¿›è¡Œæ“ä½œï¼Œæœ¬è´¨ä¸Šä¸è¿›è¡Œå¯¹ç£ç›˜IOçš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå°±çœ‹ä¸åˆ°ç›¸å…³çš„æ–‡ä»¶ã€‚</p></div><div class="el-p"><p dir="auto">è€Œfifoå‘½åç®¡é“å°±æœ‰æ‰€ä¸åŒäº†ï¼Œåˆ›å»ºå‘½åç®¡é“çš„åŒæ—¶åœ¨ä¹Ÿä¼šåœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªfifoæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯æœ‰åç§°çš„ï¼Œä»»ä½•è¿›ç¨‹åªè¦çŸ¥é“è¿™ä¸ªåç§°ï¼Œå°±å¯ä»¥é€šè¿‡è¯¥åç§°æ‰“å¼€fifoæ–‡ä»¶ä»è€Œä¸å¦ä¸€ç«¯è¿›è¡Œé€šä¿¡ã€‚æ‰€ä»¥å‘½åç®¡é“å…è®¸åœ¨å¤šä¸ªä¸åŒè¿›ç¨‹ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚ï¼ˆfifoæ–‡ä»¶å……å½“ç®¡é“å…¥å£çš„ä½œç”¨ï¼‰</p></div><div class="el-p"><p dir="auto">å‘½åç®¡é“åœ¨åˆ›å»ºåä¼šä¸€ç›´å­˜åœ¨ï¼ˆæŒä¹…æ€§ï¼‰ï¼Œç›´è‡³æ˜¾ç¤ºåˆ é™¤ï¼Œé‚£æ€•æ²¡æœ‰è¿›ç¨‹ä½¿ç”¨ã€‚å‘½åè¿›ç¨‹åˆ›å»ºå¥½åï¼Œå¯¹è¯¥ç®¡é“çš„æ“ä½œå°±å’Œæ“ä½œæ–‡ä»¶ä¸€æ ·ï¼Œä½¿ç”¨<code>open</code>ã€<code>read</code>ã€<code>write</code>ç­‰ç³»ç»Ÿè°ƒç”¨æ¥ä½¿ç”¨ç®¡é“è¿›è¡Œé€šä¿¡ã€‚ç”±äºå‘½åç®¡é“ä¸æ”¯æŒæ–‡ä»¶å®šä½æ“ä½œï¼Œä¸”éµå®ˆå…ˆè¿›å…ˆå‡ºçš„åŸåˆ™ï¼Œæ‰€ä»¥å‘½åç®¡é“ä¹Ÿè¢«ç§°ä¸º FIFO special fileã€‚</p></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.1.2.1 Creating a Named Pipe" dir="auto" class="heading" id="3.1.2.1_Creating_a_Named_Pipe"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1.2.1 Creating a Named Pipe</h5><div class="heading-children"><div class="el-pre"><pre class="language-cpp" tabindex="0"><code data-line="0" class="language-cpp is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>

<span class="token comment">//å†™ç«¯</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> pipe_name <span class="token operator">=</span> <span class="token string">"tmp"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">"hello world"</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> readBuf<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">memset</span><span class="token punctuation">(</span>readBuf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mkfifo</span><span class="token punctuation">(</span>pipe_name<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"mkfifo func error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> fifo_Writefd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>pipe_name<span class="token punctuation">,</span> O_WRONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>fifo_Writefd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open fifofd error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>fifo_Writefd<span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write func error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span>
<span class="token function">close</span><span class="token punctuation">(</span>fifo_Writefd<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//è¯»ç«¯</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> pipe_name <span class="token operator">=</span> <span class="token string">"tmp"</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> fifo_Readfd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>pipe_name<span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>fifo_Readfd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open fifofd error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>fifo_Readfd<span class="token punctuation">,</span> readBuf<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"write func error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span>
std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> readBuf <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token function">close</span><span class="token punctuation">(</span>fifo_Readfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">unlink</span><span class="token punctuation">(</span>pipe_name<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"unlink func error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="3.1.3 Pipe and Disk I/O" dir="auto" class="heading" id="3.1.3_Pipe_and_Disk_I/O"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1.3 Pipe and Disk I/O</h4><div class="heading-children"><div class="el-h5 heading-wrapper"><h5 data-heading="3.1.3.1 Anonymous Pipes Have Nothing To Do with Disk" dir="auto" class="heading" id="3.1.3.1_Anonymous_Pipes_Have_Nothing_To_Do_with_Disk"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1.3.1 Anonymous Pipes Have Nothing To Do with Disk</h5><div class="heading-children"><div class="el-p"><p dir="auto">åœ¨ä¸Šé¢çš„å‘½åç®¡é“å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å…¶å®æåˆ°äº†ï¼Œåœ¨é€‚ç”¨ç³»ç»Ÿè°ƒç”¨<code>pipe()</code>åˆ›å»ºç®¡é“çš„æ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¹¶ä¸ç”¨åˆ°ç£ç›˜ã€‚è™½ç„¶æˆ‘ä»¬è¿›è¡Œäº†æ–‡ä»¶æ“ä½œï¼Œä½†æ˜¯è¿™äº›æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜çš„å†…æ ¸åŒºä¸­è¿›è¡Œçš„ï¼Œå¹¶ä¸ä¼šæ¶‰åŠå®é™…çš„â€œå¯¹æ–‡ä»¶æ“ä½œâ€ã€‚</p></div><div class="el-p"><p dir="auto">æ‰€ä»¥ï¼ŒåŒ¿åç®¡é“(pipe)æ˜¯ç”¨äºæœ‰äº²ç¼˜å…³ç³»è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ã€‚åŒ¿åç®¡é“æ˜¯ä¸´æ—¶å­˜åœ¨äºå†…å­˜ä¸­çš„ï¼Œå½“æ‰€æœ‰ç›¸å…³è¿›ç¨‹ç»ˆæ­¢æˆ–å…³é—­ç®¡é“æ–‡ä»¶æè¿°ç¬¦ï¼ˆè¯»ç«¯å’Œå†™ç«¯ï¼‰åï¼ŒåŒ¿åç®¡é“è‡ªåŠ¨é”€æ¯ã€‚åœ¨å¯¹åŒ¿åç®¡é“æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è°ƒç”¨<code>unlink</code>ç³»ç»Ÿè°ƒç”¨å‡½æ•°åˆ é™¤æ–‡ä»¶ã€‚</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.1.3.2 Named Pipes Use Disk I/O" dir="auto" class="heading" id="3.1.3.2_Named_Pipes_Use_Disk_I/O"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.1.3.2 Named Pipes Use Disk I/O</h5><div class="heading-children"><div class="el-p"><p dir="auto">åœ¨éäº²ç¼˜å…³ç³»è¿›ç¨‹ä¹‹é—´é€šä¿¡æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>mkfifo</code>å‘½ä»¤åˆ›å»ºå‘½åç®¡é“(fifo)ï¼Œfifoæ˜¯ä¸€ä¸ªæœ‰åå­—çš„ç‰¹æ®Šæ–‡ä»¶ã€‚å½“Aè¿›ç¨‹åˆ›å»ºäº†è¿™ä¸ªfifoï¼Œç”±äºå®ƒå…·æœ‰æ–‡ä»¶åå±æ€§ï¼Œå› æ­¤Bè¿›ç¨‹å¯ä»¥é€šè¿‡æ–‡ä»¶è·¯å¾„ã€æ–‡ä»¶åç­‰å±æ€§å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œè®¿é—®ï¼Œé€šè¿‡è®¿é—®fifoæ–‡ä»¶ï¼ŒBè¿›ç¨‹å¯ä»¥çŸ¥é“å†…æ ¸ç¼“å†²åŒºçš„å“ªä¸€éƒ¨åˆ†ä½œä¸ºç®¡é“ä½¿ç”¨ã€‚è¿™å°±æ˜¯fifoå®ç°éäº²ç¼˜å…³ç³»è¿›ç¨‹é€šä¿¡çš„åŸºæœ¬åŸç†ã€‚</p></div><div class="el-p"><p dir="auto">å¦‚æœè¿›ç¨‹Aä½¿ç”¨<code>mkfifo</code>å‘½ä»¤é¦–æ¬¡åˆ›å»ºFIFOæ–‡ä»¶æ—¶ï¼Œä¼šåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªç›¸åº”çš„inodeè®°å½•ï¼ˆé¦–æ¬¡è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚ä¹‹åç”¨<code>open()</code>ç³»ç»Ÿè°ƒç”¨æ‰“å¼€ç®¡é“æ—¶ï¼Œä¼šè¯»å–inodeè¡¨é¡¹ä»¥è·å–æ–‡ä»¶ç›¸å…³å…ƒæ•°æ®ï¼Œï¼ˆç¬¬äºŒæ¬¡è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚ç”±äºæ­¤å‰ç³»ç»Ÿå·²ç»ç¼“å­˜äº†æ–‡ä»¶çš„inodeï¼Œè¿™æ—¶è¿›ç¨‹Bé€šè¿‡ç³»ç»Ÿä¸Šçš„inodeè®°å½•æ‰“å¼€FIFOæ–‡ä»¶å¹¶åˆ›å»ºåˆé€‚çš„fdå°±ä¸å†éœ€è¦è®¿é—®æ–‡ä»¶ç³»ç»Ÿäº†ã€‚</p></div><div class="el-p"><p dir="auto">è¯·<strong>æ³¨æ„</strong>ï¼Œè¿™é‡Œè¯´çš„ä½¿ç”¨I/Oå¹¶ä¸æ˜¯è¯´ç®¡é“ä¼ è¾“çš„æ•°æ®ä¼šå…ˆæ”¾åˆ°ç£ç›˜ä¸Šï¼Œè¿™æ ·å¤ªæ…¢äº†ã€‚æˆ‘ä»¬è¯´ä½¿ç”¨I/Oæ˜¯æŒ‡ä½¿ç”¨å‘½åç®¡é“æ—¶ä¼šåœ¨æ–‡ä»¶ç³»ç»Ÿï¼ˆç£ç›˜ï¼‰ä¸Šåˆ›å»ºä¸€ä¸ªFIFOæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶çš„åˆ›å»ºæ˜¯ä½¿ç”¨I/Oçš„ã€‚</p></div></div></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="3.2 Shared Memory" dir="auto" class="heading" id="3.2_Shared_Memory"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2 Shared Memory</h3><div class="heading-children"><div class="el-p"><p dir="auto"><strong>å…±äº«å†…å­˜</strong>çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶åˆ’åˆ†å‡ºäº†ä¸€æ®µå†…å­˜ç”¨äºå…±äº«ï¼Œä¸ç®¡é“ä¸åŒçš„æ˜¯ï¼Œé€šå¸¸è€Œè¨€å…±äº«å†…å­˜çš„æ–¹å¼èƒ½å¤Ÿåˆ’åˆ†çš„å†…å­˜æ›´å¤§ï¼ˆé€šå¸¸ç®¡é“åˆ†é…4KB-64KBï¼‰ï¼Œè€Œä¸”å…±äº«å†…å­˜æ®µ(shm)ä½äºç”¨æˆ·ç©ºé—´ã€‚</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="3.2.1&nbsp;shm&nbsp;in&nbsp;POSIX" dir="auto" class="heading" id="3.2.1&nbsp;shm&nbsp;in&nbsp;POSIX"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.1&nbsp;shm&nbsp;in&nbsp;POSIX</h4><div class="heading-children"><div class="el-p"><p dir="auto">POSIX&nbsp;æ ‡å‡†å¼ºè°ƒç»Ÿä¸€æ€§å’Œå¯ç§»æ¤æ€§ï¼Œæ‰€ä»¥POSIXçš„æ ‡å‡†åˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿæ¥å£ï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰æ¥æ“ä½œshmï¼Œä¹Ÿç®€åŒ–äº†ç³»ç»Ÿçš„å®ç°å’Œä½¿ç”¨ã€‚é€šå¸¸ä¸<code>mmap()</code>ç»“åˆä½¿ç”¨ï¼Œå¸¸ç”¨åˆ°çš„ç³»ç»Ÿè°ƒç”¨æœ‰ï¼š</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>shm_open</code>ï¼šé€šè¿‡<code>shm_open</code>å‡½æ•°åˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªå…±äº«å†…å­˜å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦<code>shm_fd</code>ã€‚è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦å°†ç”¨äºåç»­çš„å…±äº«å†…å­˜æ“ä½œï¼Œå°±åƒæ“ä½œä¸€ä¸ªæ™®é€šæ–‡ä»¶ä¸€æ ·ã€‚</li>
<li data-line="1" dir="auto"><code>ftruncate</code>ï¼šä½¿ç”¨<code>ftruncate</code>å‡½æ•°è®¾ç½®å…±äº«å†…å­˜å¯¹è±¡çš„å¤§å°ã€‚è¿™ä¸€æ­¥ç¡®ä¿å…±äº«å†…å­˜å¯¹è±¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥å­˜å‚¨æ•°æ®ã€‚</li>
<li data-line="2" dir="auto"><code>mmap</code>ï¼šé€šè¿‡<code>mmap</code>å‡½æ•°å°†å…±äº«å†…å­˜å¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå¹¶è¿”å›è¿™æ®µå†…å­˜çš„èµ·å§‹åœ°å€ï¼ˆ<code>*ptr</code>ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹ä½¿å¾—ä½ å¯ä»¥åƒæ“ä½œæ™®é€šå†…å­˜ä¸€æ ·æ“ä½œå…±äº«å†…å­˜ã€‚</li>
<li data-line="3" dir="auto">ä½¿ç”¨<code>memcpy</code>æˆ–<code>strcpy</code>ï¼šä¸€æ—¦å…±äº«å†…å­˜è¢«æ˜ å°„åˆ°åœ°å€ç©ºé—´ï¼Œä½ å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„å†…å­˜æ“ä½œå‡½æ•°ï¼ˆå¦‚<code>memcpy</code>æˆ–<code>strcpy</code>ï¼‰æ¥æ“ä½œè¿™æ®µå†…å­˜ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸æ“ä½œæ™®é€šå†…å­˜æ²¡æœ‰åŒºåˆ«ã€‚</li>
<li data-line="4" dir="auto"><code>close(shm_fd)</code>ï¼šåœ¨ä½¿ç”¨å®Œå…±äº«å†…å­˜åï¼Œé€šè¿‡<code>close</code>å‡½æ•°å…³é—­å…±äº«å†…å­˜å¯¹è±¡çš„æ–‡ä»¶æè¿°ç¬¦ã€‚è¿™ä¸ªæ­¥éª¤ç±»ä¼¼äºå…³é—­æ–‡ä»¶ï¼Œè¡¨ç¤ºä¸å†éœ€è¦è®¿é—®è¯¥å…±äº«å†…å­˜å¯¹è±¡ã€‚</li>
<li data-line="5" dir="auto"><code>shm_unlink</code>ï¼šæœ€åï¼Œä½¿ç”¨<code>shm_unlink</code>å‡½æ•°åˆ é™¤å…±äº«å†…å­˜å¯¹è±¡ã€‚è¿™ä¸€æ­¥ç±»ä¼¼äºåˆ é™¤æ–‡ä»¶ï¼Œé‡Šæ”¾æ‰ä¸å†éœ€è¦çš„å…±äº«å†…å­˜å¯¹è±¡ã€‚</li>
</ul></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.2.1.1 `shm_open()`" dir="auto" class="heading" id="3.2.1.1_`shm_open()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.1.1 <code>shm_open()</code></h5><div class="heading-children"><div class="el-p"><p dir="auto"><code>shm_open</code>&nbsp;ç”¨äºåˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªå…±äº«å†…å­˜å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç”¨äºåç»­çš„å†…å­˜æ“ä½œã€‚åˆ›å»ºæ—¶ä¼šåœ¨æ–‡ä»¶ç³»ç»Ÿï¼ˆé€šå¸¸æ˜¯<code>/dev/shm</code>ï¼‰ä¸­æ˜¾ç¤ºä¸€ä¸ªå¯¹åº”çš„æ–‡ä»¶æ¡ç›®ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">shm_open</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">int</span> oflag<span class="token punctuation">,</span> <span class="token class-name">mode_t</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. name: The name of the shared memory object.
	2. oflag: The open flags (e.g., O_CREAT, O_RDWR).
	3. mode: The permission mode of the shared memory object (e.g., 0666).

Return value: Returns a file descriptor on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.2.1.2 `ftruncate()`" dir="auto" class="heading" id="3.2.1.2_`ftruncate()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.1.2 <code>ftruncate()</code></h5><div class="heading-children"><div class="el-p"><p dir="auto"><code>ftruncate</code>&nbsp;ç”¨äºè®¾ç½®å…±äº«å†…å­˜æ®µçš„å¤§å°ï¼Œç¡®ä¿å…¶æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥å­˜å‚¨æ•°æ®ã€‚ç”±äºåœ¨å†…å­˜ä¸­é¡µæ¡†çš„å¤§å°é€šå¸¸æ˜¯4KBï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬è®¾ç½®å…±äº«å†…å­˜æ®µå¤§å°æ—¶é€šå¸¸è®¾ç½®ä¸º4096çš„å€æ•°ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">ftruncate</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token class-name">off_t</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. fd: The file descriptor of the shared memory object.
	2. length: The size to set for the shared memory object in bytes.

Return value: Returns 0 on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.2.1.3 `close()`" dir="auto" class="heading" id="3.2.1.3_`close()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.1.3 <code>close()</code></h5><div class="heading-children"><div class="el-p"><p dir="auto"><code>close</code>&nbsp;ç”¨äºå…³é—­å…±äº«å†…å­˜å¯¹è±¡çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç±»ä¼¼äºå…³é—­æ–‡ä»¶ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. fd: The file descriptor to close.

Return value: Returns 0 on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.2.1.4 `shm_unlink()`" dir="auto" class="heading" id="3.2.1.4_`shm_unlink()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.1.4 <code>shm_unlink()</code></h5><div class="heading-children"><div class="el-p"><p dir="auto"><code>shm_unlink</code>&nbsp;ç”¨äºåˆ é™¤å…±äº«å†…å­˜å¯¹è±¡ï¼Œç±»ä¼¼äºåˆ é™¤æ–‡ä»¶ï¼Œé‡Šæ”¾ä¸å†éœ€è¦çš„å…±äº«å†…å­˜ã€‚å¯¹äºPOSIXå…±äº«å†…å­˜ï¼Œå¦‚æœæœªè°ƒç”¨<code>shm_unlink</code>å‡½æ•°æ¥åˆ é™¤å…±äº«å†…å­˜å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä¼šç»§ç»­é©»ç•™åœ¨ç³»ç»Ÿå†…å­˜ä¸­ï¼Œç›´åˆ°ç³»ç»Ÿé‡å¯æˆ–æ˜¾å¼åˆ é™¤ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">shm_unlink</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. name: The name of the shared memory object.

Return value: Returns 0 on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">å¦‚æœåœ¨<code>shm_unlink</code>ä¹‹å‰æ²¡æœ‰closeå…±äº«å†…å­˜å¯¹è±¡ï¼Œè¯¥å‡½æ•°ä¼šæ ‡è®°è¿™æ®µå…±äº«å†…å­˜ï¼Œå½“æ‰€æœ‰è¿›ç¨‹éƒ½å…³é—­æè¿°ç¬¦åï¼Œç³»ç»Ÿä¼šæ¸…ç†èµ„æºï¼ˆå±Šæ—¶åˆ é™¤å…±äº«å†…å­˜æ®µï¼‰ã€‚</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.2.1.5 Manipulate a shm Object" dir="auto" class="heading" id="3.2.1.5_Manipulate_a_shm_Object"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.1.5 Manipulate a shm Object</h5><div class="heading-children"><div class="el-p"><p dir="auto">æˆ‘ä»¬ä¸‹é¢ç”¨ä»£ç ç®€å•æ¼”ç¤ºä¸€ä¸‹POSIXä¸­shmçš„åˆ›å»ºï¼ˆæ‰“å¼€ï¼‰ã€è®¾ç½®å¤§å°ã€å…³é—­ã€åˆ é™¤shmfdçš„ä¸€ç³»åˆ—æ“ä½œã€‚è¿™é‡Œè¯·æ³¨æ„ï¼Œè®¾ç½®shmå¤§å°æˆ‘ä»¬äº¤ç»™å†™è¿›ç¨‹æ¥è®¾ç½®ï¼š</p></div><div class="el-pre"><pre class="language-cpp" tabindex="0"><code data-line="0" class="language-cpp is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>

<span class="token comment">//Write process</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> shm_name <span class="token operator">=</span> <span class="token string">"my_shm"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">"hello world"</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> shm_fd <span class="token operator">=</span> <span class="token function">shm_open</span><span class="token punctuation">(</span>shm_name<span class="token punctuation">,</span> O_CREAT <span class="token operator">|</span> O_RDWR<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>shm_fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"shm_open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ftruncate</span><span class="token punctuation">(</span>shm_fd<span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"ftruncate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>shm_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token operator">*</span>ptr <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">,</span> PROT_WRITE<span class="token punctuation">,</span> MAP_SHARED<span class="token punctuation">,</span> shm_fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ptr <span class="token operator">==</span> MAP_FAILED<span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"mmap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token function">close</span><span class="token punctuation">(</span>shm_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token function">memcpy</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">close</span><span class="token punctuation">(</span>shm_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Character string's been sent"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//Read process</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> shm_name <span class="token operator">=</span> <span class="token string">"my_shm"</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> rdBuf<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> rdshm_fd <span class="token operator">=</span> <span class="token function">shm_open</span><span class="token punctuation">(</span>shm_name<span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">void</span> <span class="token operator">*</span>ptr <span class="token operator">=</span> <span class="token function">mm</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">,</span> PROT_READ<span class="token punctuation">,</span> MAP_SHARED<span class="token punctuation">,</span> rdshm_fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ptr <span class="token operator">==</span> MAP_FAILED<span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"mmap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token function">close</span><span class="token punctuation">(</span>rdshm_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Read from shared memory: "</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>ptr <span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

	<span class="token function">close</span><span class="token punctuation">(</span>rdshm_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">shm_unlink</span><span class="token punctuation">(</span>shm_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.2.1.6 Shared Memory Implementation Mechanism | POSIX" dir="auto" class="heading" id="3.2.1.6_Shared_Memory_Implementation_Mechanism_|_POSIX"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.1.6 Shared Memory Implementation Mechanism | POSIX</h5><div class="heading-children"><div class="el-p"><p dir="auto">æ—¢ç„¶åœ¨POSIXä¸‹ä¸‡ç‰©çš†æ–‡ä»¶ï¼Œè€Œä¸”æˆ‘ä»¬ç”¨<code>shm_open</code>ç³»ç»Ÿè°ƒç”¨ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥èƒ½åœ¨ç£ç›˜ä¸­æ‰¾åˆ°ç›¸å…³çš„å…±äº«å†…å­˜æ–‡ä»¶å§ï¼Ÿæ²¡é”™ï¼Œç¡®å®ä¼šå¦‚æ­¤ã€‚å½“æˆ‘ä»¬æ‰§è¡Œä¸‹é¢ä¸€è¡Œä»£ç <code>int shm_fd = shm_open(shm_name, O_CREAT | O_RDWR, 0666);</code>åï¼Œæˆ‘ä»¬æŸ¥çœ‹<code>/dev/shm</code>ï¼Œåº”å½“å¯ä»¥çœ‹åˆ°ç›¸å…³çš„æ–‡ä»¶ã€‚è¿è¡ŒåæŸ¥çœ‹ç›®å½•ï¼š</p></div><div class="el-pre"><pre><code data-line="0">du@du-virtual-machine:~/Desktop/OS$ ls /dev/shm
my_shm
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">å®é™…ä¸Šï¼Œå…±äº«å†…å­˜åœ¨ä¼ é€’ä¿¡æ¯ä¹‹å‰é€šè¿‡æ‰“å¼€æ–‡ä»¶å¯¹è±¡<code>my_shm</code>è¿”å›ä¸€ä¸ªæ–‡ä»¶çš„æè¿°ç¬¦<code>shm_fd</code>ã€‚æœ‰äº†è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¿›ç¨‹å°±å¯ä»¥å¯¹ç‰¹å®šçš„å…±äº«å†…å­˜æ®µä¸­è¿›è¡Œè¯»å†™æ“ä½œï¼ˆä¹Ÿå°±ç›¸å½“äºfdå®é™…ä¸Šæ˜¯å…±äº«å†…å­˜æ®µçš„ç´¢å¼•ï¼‰ã€‚å†™ç«¯è¿›ç¨‹åœ¨ä¿®æ”¹è¿™éƒ¨åˆ†å†…å­˜æ—¶ï¼Œæ•°æ®ä¼šåœ¨å†…å­˜ä¸­è¢«æ›´æ–°ï¼Œå®ç°äº†æ•°æ®åœ¨ä¸åŒè¿›ç¨‹é—´çš„äº¤æ¢ã€‚ç»“åˆä¿¡å·é‡å¯ä»¥å®ç°åŒæ­¥åˆ†æ¬¡è¯»å†™ã€‚</p></div></div></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="3.2.2&nbsp;shm&nbsp;in&nbsp;System&nbsp;V" dir="auto" class="heading" id="3.2.2&nbsp;shm&nbsp;in&nbsp;System&nbsp;V"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.2&nbsp;shm&nbsp;in&nbsp;System&nbsp;V</h4><div class="heading-children"><div class="el-p"><p dir="auto">System Vä½¿ç”¨ä¸åŒäºPOSIXæ ‡å‡†çš„IPCæœºåˆ¶ï¼Œ&nbsp;<strong>System&nbsp;Vä¸‹çš„shmå¹¶ä¸ä¾èµ–æ–‡ä»¶ç³»ç»ŸæŒä¹…å­˜å‚¨ï¼ˆä¸åŒäºPOSIXä¸­ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦å’Œè·¯å¾„åç®¡ç†å…±äº«å†…å­˜æ®µï¼‰ï¼Œè€Œæ˜¯é€šè¿‡ç‰¹å®šçš„æ ‡è¯†ç¬¦ï¼ˆshmidï¼‰æ¥ç®¡ç†</strong>ã€‚System&nbsp;Vå…±äº«å†…å­˜å¹¶ä¸ä¼šæŒä¹…åŒ–å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç”¨äºè¿›ç¨‹é—´çš„å¿«é€Ÿé€šä¿¡ã€‚ç›¸æ¯”äºä¸‡ç‰©çš†æ–‡ä»¶çš„POSIXè€Œè¨€æ•ˆç‡å’Œæ€§èƒ½æ›´å¥½ã€‚</p></div><div class="el-p"><p dir="auto">åœ¨System Vçš„shmæ–¹å¼ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ç”¨åˆ°å››ä¸ªç³»ç»Ÿè°ƒç”¨<code>shmget</code>ã€<code>shmat</code>ã€<code>shmdt</code>å’Œ<code>shmctl</code>ã€‚è¿™å››ä¸ªç³»ç»Ÿè°ƒç”¨çš„å«ä¹‰åˆ†åˆ«æ˜¯ï¼š</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><code>shmget</code>è·å–(get)ä¸€ä¸ªæ–°çš„å…±äº«å†…å­˜æ®µ(shm)ï¼Œå¹¶è¿”å›å”¯ä¸€çš„æ ‡è¯†ç¬¦(shmid)ç”¨äºåç»­çš„æ“ä½œã€‚</li>
<li data-line="1" dir="auto"><code>shmat</code>å°†åˆ›å»ºçš„shmé™„åŠ (attach)åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚</li>
<li data-line="2" dir="auto"><code>shmdt</code>ä»è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­å°†shmåˆ†ç¦»(detach)å‡ºæ¥ã€‚</li>
<li data-line="3" dir="auto"><code>shmctl</code>ç”¨äºæ§åˆ¶å’Œæ“ä½œshmï¼Œé€šå¸¸ç”¨æ¥åˆ é™¤å†…å­˜æ®µã€‚</li>
</ol></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.2.2.1 shm Get" dir="auto" class="heading" id="3.2.2.1_shm_Get"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.2.1 shm Get</h5><div class="heading-children"><div class="el-p"><p dir="auto">System&nbsp;Vçš„å…±äº«å†…å­˜é€šè¿‡æ ‡è¯†ç¬¦ï¼ˆshmidï¼‰æ¥ç®¡ç†ï¼Œè¿™äº›æ ‡è¯†ç¬¦é€šè¿‡<code>shmget</code>å’Œ<code>ftok</code>ç­‰å‡½æ•°ç”Ÿæˆã€‚è¦åˆ›å»ºæ–°çš„æˆ–è·å–å­˜åœ¨çš„å…±äº«å†…å­˜æ®µçš„å¼•ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>shmget</code>ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒçš„å‡½æ•°åŸå‹æ˜¯ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/shm.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">shmget</span><span class="token punctuation">(</span><span class="token class-name">key_t</span> key<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> shmflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. key: A unique identifier for the shared memory segment. This can either be the result of an ftok() call or the constant IPC_PRIVATE.
	2. size: Indicates the size of the shared memory segment in bytes.
	3. shmflg: Access permissions (UNIX standards, e.g., 0600). Optional flags include:
	   - IPC_CREAT: Create a new segment if it does not exist.
	   - IPC_EXCL: Fail if the segment already exists.

Return value: Returns the shared memory segment identifier (shmid), which is an integer.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">è¦è·å¾—å¯¹ä¸€æ®µå…±äº«å†…å­˜æ®µçš„å”¯ä¸€æ ‡è¯†ï¼ˆé”®å€¼ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°<code>ftok</code>å‡½æ•°ã€‚å…¶å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>

<span class="token class-name">key_t</span> <span class="token function">ftok</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pathname<span class="token punctuation">,</span> <span class="token keyword">int</span> proj_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. pathname: A pointer to the path of an existing and accessible file.
	2. proj_id: A project identifier. This is usually a single character.

Return value: Returns a key of type key_t, which can be used to identify a shared memory segment, message queue, or semaphore.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">å¦‚æœæ²¡æœ‰ç›¸å…³æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶æ¥ç”Ÿæˆé”®å€¼ã€‚ï¼ˆ<code>open</code>ç³»ç»Ÿè°ƒç”¨ï¼‰</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.2.2.2 shm Attachment" dir="auto" class="heading" id="3.2.2.2_shm_Attachment"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.2.2 shm Attachment</h5><div class="heading-children"><div class="el-p"><p dir="auto">å½“å…±äº«å†…å­˜æ®µå­˜åœ¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶é™„åŠ åˆ°æˆ‘ä»¬çš„è¿›ç¨‹ç©ºé—´ä¸­äº†ã€‚é™„åŠ å®Œæˆä¹‹åï¼Œè¿›ç¨‹å°±å¯ä»¥é€šè¿‡æŒ‡é’ˆå¯¹è¿™æ®µç©ºé—´è¿›è¡Œæ“ä½œï¼Œä»è€Œå®ç°ä¸å…¶ä»–è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚å…¶å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">shmat</span><span class="token punctuation">(</span><span class="token keyword">int</span> shmid<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> shmaddr<span class="token punctuation">,</span> <span class="token keyword">int</span> shmflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. shmid: ID of the shared memory segment.
	2. shmaddr: Address at which to attach the shared memory segment (always use NULL to allow the system to choose the address).
	3. shmflg: Flags for the operation (e.g., SHM_RDONLY to attach in read-only mode).

Return value: Standard C pointer with the address of the shared memory.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.2.2.3 shm Detachment" dir="auto" class="heading" id="3.2.2.3_shm_Detachment"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.2.3 shm Detachment</h5><div class="heading-children"><div class="el-p"><p dir="auto">ä½¿ç”¨å®Œæˆå…±äº«å†…å­˜æ®µä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ç”¨<code>detach</code>ç³»ç»Ÿè°ƒç”¨å°†å…¶ä¸è¿›ç¨‹å†…å­˜ç©ºé—´è¿›è¡Œåˆ†ç¦»ã€‚è¿™ä¸ªç³»ç»Ÿè°ƒç”¨éå¸¸ç®€å•ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">shmdt</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> shmaddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. shmaddr: The address returned by the attach call.

Return value: 0 for success and -1 for error.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">è™½ç„¶å¾ˆç®€å•ï¼Œä½†æ˜¯è¯·ä¸è¦å¿½è§†å…¶é‡è¦æ€§ã€‚è™½ç„¶è¿›ç¨‹ç»ˆæ­¢åæ“ä½œç³»ç»Ÿä¹Ÿä¼šå¸®æˆ‘ä»¬è¿›è¡Œèµ„æºç®¡ç†ï¼Œä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬éœ€è¦è¿›ç¨‹ä¸€ç›´è¿è¡Œï¼Œè¿™æ—¶ï¼Œå¦‚æœä¸è¿›è¡Œ<code>shmdt</code>å°±ä¼šå¯¼è‡´shmä¸€ç›´é©»ç•™åˆ°å†…å­˜ä¸­ã€‚</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="3.2.2.4 shm Control" dir="auto" class="heading" id="3.2.2.4_shm_Control"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.2.2.4 shm Control</h5><div class="heading-children"><div class="el-p"><p dir="auto">æˆ‘ä»¬ç”¨<code>shmctl</code>æ¥åˆ é™¤å…±äº«å†…å­˜æ®µï¼Œè¿™ä¸ªå‡½æ•°èƒ½åšçš„ä¸ä»…ä»…æ˜¯åˆ é™¤ï¼Œä½†è¿™é‡Œæˆ‘ä»¬ä»…ä»…å…³æ³¨å…¶åˆ é™¤çš„åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªå‡½æ•°çš„åŸå‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">shmctl</span><span class="token punctuation">(</span><span class="token keyword">int</span> shmid<span class="token punctuation">,</span> <span class="token keyword">int</span> cmd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">shmid_ds</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. shmid: Shared memory segment ID.
	2. cmd: Command to perform on the shared memory segment. For deletion, use IPC_RMID(ReMove ID).
	3. buf: Pointer to a struct shmid_ds, used for control commands that require or return data, not needed for IPC_RMID(in this case, just set to NULL).

Return value: Returns 0 on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">System Vçš„shmä½¿ç”¨å¼•ç”¨è®¡æ•°(reference count)æ¥ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸã€‚å½“è¿›ç¨‹é€šè¿‡<code>shmat</code>é™„åŠ å…±äº«å†…å­˜æ—¶ï¼Œå¼•ç”¨è®¡æ•°å¢åŠ ã€‚å½“è¿›ç¨‹é€šè¿‡<code>shmdt</code>åˆ†ç¦»å…±äº«å†…å­˜æ®µæ—¶ï¼Œå¼•ç”¨è®¡æ•°å‡å°‘ã€‚åªè¦å¼•ç”¨è®¡æ•°ä¸ä¸º0ï¼Œæˆ‘ä»¬è°ƒç”¨<code>shmctl</code>åˆ é™¤å…±äº«å†…å­˜æ®µæ—¶è¿™ä¸ªå…±äº«å†…å­˜æ®µå¹¶ä¸ä¼šç«‹åˆ»è¢«åˆ é™¤ï¼Œå†…æ ¸ä¼šå°†å…¶æ ‡è®°ä¸ºâ€å¾…åˆ é™¤â€œçŠ¶æ€ï¼Œç›´åˆ°å¼•ç”¨è®¡æ•°å½’é›¶ã€‚</p></div></div></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="3.3 Message Queue" dir="auto" class="heading" id="3.3_Message_Queue"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.3 Message Queue</h3><div class="heading-children"><div class="el-p"><p dir="auto">é™¤äº†ç®¡é“å’Œå…±äº«å†…å­˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„IPCæœºåˆ¶ã€‚æ¶ˆæ¯é˜Ÿåˆ—å’Œç®¡é“æœ‰äº›ç›¸ä¼¼ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€ç§å†…æ ¸å¯¹è±¡ã€ä»¥å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼å¯¹æ¶ˆæ¯è¿›ç¨‹å¤„ç†ï¼ˆé»˜è®¤æƒ…å†µï¼‰ã€‚ä½†å®ƒä»¬å¤„ç†çš„å¯¹è±¡ä¸åŒã€‚ç®¡é“ä¼ é€’çš„æ¶ˆæ¯æ˜¯ä»¥å­—èŠ‚æµçš„æ–¹å¼è¿›è¡Œä¼ è¾“çš„ï¼Œè€Œ<strong>æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä¼ é€’çš„æ¶ˆæ¯å…·æœ‰æ¶ˆæ¯ç±»å‹ä¿¡æ¯</strong>ï¼ˆåŒ…å«ç€æ¶ˆæ¯ç±»å‹å’Œæ¶ˆæ¯ä½“ï¼‰ã€‚</p></div><div class="el-p"><p dir="auto">è€Œä¸”åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¶ˆæ¯ç±»å‹è¿›è¡Œ<strong>ç­›é€‰å’Œä¼˜å…ˆçº§å¤„ç†</strong>ï¼Œè€Œç®¡é“ä¸å…·å¤‡è¿™ç§èƒ½åŠ›ã€‚æ¶ˆæ¯é˜Ÿåˆ—å…è®¸ä½ æ ¹æ®ä¸åŒçš„æ¶ˆæ¯ç±»å‹æœ‰é€‰æ‹©åœ°è¯»å–æ¶ˆæ¯ï¼Œä»è€Œå®ç°æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚è€Œç®¡é“åªèƒ½æŒ‰ç…§æ•°æ®åˆ°è¾¾çš„é¡ºåºé€ä¸ªè¯»å–ï¼Œæ— æ³•è·³è¿‡æˆ–ä¼˜å…ˆå¤„ç†ç‰¹å®šçš„æ•°æ®ã€‚</p></div><div class="el-p"><p dir="auto">ç”±äºæ¶ˆæ¯å…·æœ‰ç±»å‹ä¿¡æ¯ï¼Œè€Œä¸”æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥ä½œä¸ºè¿›ç¨‹é—´é€šä¿¡çš„ä¸­é—´äººå­˜å‚¨æ¶ˆæ¯ï¼Œä»è€Œè§£è€¦åˆè¿›ç¨‹ä¹‹é—´çš„åŒæ­¥é—®é¢˜ï¼Œå³è¿›ç¨‹å¯ä»¥ç‹¬ç«‹åœ°æ‰§è¡Œä»»åŠ¡ï¼Œè€Œä¸å¿…é¢‘ç¹åœ°ç­‰å¾…æˆ–ä¸å…¶ä»–è¿›ç¨‹ç›´æ¥åŒæ­¥ã€‚æ‰€ä»¥æ¶ˆæ¯é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œç”Ÿäº§è€…è¿›ç¨‹å°†æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—åå¯ä»¥ç«‹å³ç»§ç»­ç”Ÿæˆæ–°çš„æ•°æ®ï¼Œä¸å¿…ç­‰å¾…æ¶ˆè´¹è€…è¿›ç¨‹å¤„ç†å®Œæ¯•ã€‚</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="3.3.1 Message Queue in POSIX" dir="auto" class="heading" id="3.3.1_Message_Queue_in_POSIX"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.3.1 Message Queue in POSIX</h4><div class="heading-children"><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mqueue.h&gt;</span></span>

<span class="token class-name">mqd_t</span> <span class="token function">mq_open</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">,</span> <span class="token keyword">int</span> oflag<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. name: Name of the message queue.
	2. oflag: Flags for the operation (e.g., O_CREAT to create the queue if it doesn't exist).
	3. ...: Optional mode and attributes (used when creating the queue).

Return value: Message queue descriptor (mqd_t) on success, (mqd_t)-1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">mq_send</span><span class="token punctuation">(</span><span class="token class-name">mqd_t</span> mqdes<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg_ptr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> msg_len<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> msg_prio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. mqdes: Message queue descriptor.
	2. msg_ptr: Pointer to the message to be sent.
	3. msg_len: Size of the message in bytes.
	4. msg_prio: Priority of the message.

Return value: 0 on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token class-name">ssize_t</span> <span class="token function">mq_receive</span><span class="token punctuation">(</span><span class="token class-name">mqd_t</span> mqdes<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg_ptr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> msg_len<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span>msg_prio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. mqdes: Message queue descriptor.
	2. msg_ptr: Pointer to the buffer where the received message will be stored.
	3. msg_len: Size of the message buffer in bytes.
	4. msg_prio: Pointer to store the message priority (optional).

Return value: Number of bytes received on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">mq_close</span><span class="token punctuation">(</span><span class="token class-name">mqd_t</span> mqdes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. mqdes: Message queue descriptor.

Return value: 0 on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">mq_unlink</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. name: Name of the message queue.

Return value: 0 on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="3.3.2 Message Queue in System V" dir="auto" class="heading" id="3.3.2_Message_Queue_in_System_V"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.3.2 Message Queue in System V</h4><div class="heading-children"><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">msgget</span><span class="token punctuation">(</span><span class="token class-name">key_t</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> msgflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. key: Unique key to identify the message queue.
	2. msgflg: Flags for the operation (e.g., IPC_CREAT to create the queue if it doesn't exist).

Return value: Message queue identifier (msgid) on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">msgsnd</span><span class="token punctuation">(</span><span class="token keyword">int</span> msqid<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>msgp<span class="token punctuation">,</span> <span class="token class-name">size_t</span> msgsz<span class="token punctuation">,</span> <span class="token keyword">int</span> msgflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. msqid: Message queue identifier.
	2. msgp: Pointer to the message to be sent.
	3. msgsz: Size of the message in bytes.
	4. msgflg: Message flags to alter default behavior (e.g., IPC_NOWAIT).

Return value: 0 on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token class-name">ssize_t</span> <span class="token function">msgrcv</span><span class="token punctuation">(</span><span class="token keyword">int</span> msqid<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>msgp<span class="token punctuation">,</span> <span class="token class-name">size_t</span> msgsz<span class="token punctuation">,</span> <span class="token keyword">long</span> msgtyp<span class="token punctuation">,</span> <span class="token keyword">int</span> msgflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. msqid: Message queue identifier.
	2. msgp: Pointer to the buffer where the received message will be stored.
	3. msgsz: Size of the message buffer in bytes.
	4. msgtyp: Type of message to be received.
	5. msgflg: Message flags to alter default behavior (e.g., IPC_NOWAIT).

Return value: Number of bytes received on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">msgctl</span><span class="token punctuation">(</span><span class="token keyword">int</span> msqid<span class="token punctuation">,</span> <span class="token keyword">int</span> cmd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">msqid_ds</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. msqid: Message queue identifier.
	2. cmd: Command to perform on the message queue (e.g., IPC_RMID to remove the queue).
	3. buf: Pointer to a struct msqid_ds, used for control commands that require or return data.

Return value: 0 on success, -1 on failure and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="3.4 IPC Comparisons" dir="auto" class="heading" id="3.4_IPC_Comparisons"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.4 IPC Comparisons</h3><div class="heading-children"><div class="el-h4 heading-wrapper"><h4 data-heading="3.4.1 Shared Memory in Differnet Standards" dir="auto" class="heading" id="3.4.1_Shared_Memory_in_Differnet_Standards"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.4.1 Shared Memory in Differnet Standards</h4><div class="heading-children"><div class="el-p"><p dir="auto">å¯¹æ¯”POSIXå’ŒSystem&nbsp;Vä¸‹çš„å…±äº«å†…å­˜ï¼ŒPOSIXçš„å…±äº«å†…å­˜é€šè¿‡<code>shm_open</code>ç³»ç»Ÿè°ƒç”¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªå…±äº«å†…å­˜æ–‡ä»¶ï¼Œä¹‹åé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦å¯¹å…±äº«å†…å­˜æ®µè¿›è¡Œç®¡ç†ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨SystemVä¸­çš„å…±äº«å†…å­˜æœºåˆ¶ä½¿ç”¨æ ‡è¯†ç¬¦ï¼ˆshmidï¼‰ç®¡ç†ï¼Œä¸ä¾èµ–äºæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œç´¢å¼•ã€‚</p></div><div class="el-p"><p dir="auto">ç›¸åŒç‚¹åœ¨äºï¼Œè¿™ä¸¤ç§æ ‡å‡†éƒ½ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ä½œä¸ºå…±äº«å†…å­˜æ®µæ ‡è¯†ç¬¦çš„ç”Ÿæˆä¾æ®ï¼Œå°½ç®¡æ–¹å¼ä¸åŒï¼ˆPOSIXæ˜¯ç›´æ¥ä¾èµ–ï¼ŒSystem&nbsp;Væ˜¯é—´æ¥ä¾èµ–ï¼‰ã€‚è€Œä¸”ä¸è®ºæ˜¯POSIXè¿˜æ˜¯System&nbsp;Vï¼Œå®é™…çš„æ•°æ®éƒ½æ˜¯å­˜å‚¨åœ¨ç”¨æˆ·ç¾¤çš„å†…å­˜ä¸­ã€‚</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="3.4.2 Shared Memory vs. Pipes" dir="auto" class="heading" id="3.4.2_Shared_Memory_vs._Pipes"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.4.2 Shared Memory vs. Pipes</h4><div class="heading-children"><div class="el-p"><p dir="auto">POSIXæ ‡å‡†ä¸‹çš„shmï¼Œç®¡é“çš„ä½¿ç”¨åœºæ™¯æ›´åŠ specificã€‚ç®¡é“å…·æœ‰å…ˆè¿›å…ˆå‡ºçš„ç‰¹æ€§ï¼Œè€Œä¸”æœ‰å†…æ ¸ç»´æŠ¤å…¶ç¼“å†²åŒºï¼Œæ‰€ä»¥ç®¡é“ä¸éœ€è¦æ˜¾å¼åœ°åŒæ­¥æœºåˆ¶ï¼Œä½†æ˜¯å¤§å°è¾ƒä¸ºå±€é™ï¼ˆé€šå¸¸ä¸º4KB-64KBï¼‰ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå…±äº«å†…å­˜éœ€è¦ä¿¡å·é‡æˆ–äº’æ–¥é”ç­‰åŒæ­¥æœºåˆ¶æ¥é˜²æ­¢æ•°æ®ç«äº‰ã€‚</p></div><div class="el-p"><p dir="auto">è¿˜ä¸å…±äº«å†…å­˜ä¸åŒçš„æ˜¯ï¼Œç®¡é“æ˜¯ä¸€ç§æµå¼ä¼ è¾“ä¿¡æ¯çš„é€šä¿¡å·¥å…·ï¼Œå› ä¸ºè¿™ç§å­—èŠ‚æµä¼ é€’æ–¹å¼ï¼Œæ‰€ä»¥ä»ç®¡é“ä¸­ä¼ è¾“çš„æ•°æ®ä¸èƒ½æœ‰å¤æ‚çš„ç±»å‹ï¼ˆå¦‚ç»“æ„ä½“ï¼‰ã€‚è€Œå…±äº«å†…å­˜åˆ™æä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œæ›´é«˜çš„æ€§èƒ½ï¼Œå…±äº«å†…å­˜å¯ä»¥å­˜å‚¨å’Œè®¿é—®å¦‚ç»“æ„ä½“ç­‰å¤æ‚çš„æ•°æ®ç»“æ„ã€‚</p></div><div class="el-p"><p dir="auto">æ­¤å¤–ï¼Œå†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„åˆ‡æ¢å¼€é”€ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„ã€‚è™½ç„¶å†…æ ¸ä¿è¯äº†æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§ï¼Œä½†æ˜¯é¢‘ç¹çš„åˆ‡æ¢ä½¿å¾—ç®¡é“çš„æ€§èƒ½ä¸åŠå…±äº«å†…å­˜é«˜ã€‚</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="3.4.3 Pipes vs. Message Queue" dir="auto" class="heading" id="3.4.3_Pipes_vs._Message_Queue"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>3.4.3 Pipes vs. Message Queue</h4><div class="heading-children"><div class="el-p"><p dir="auto">ç®¡é“å’Œæ¶ˆæ¯é˜Ÿåˆ—å¾ˆç›¸ä¼¼ï¼Œåœ¨æ•°æ®ä¼ è¾“çš„é¡ºåºä¸Šï¼Œå®ƒä»¬éƒ½æ˜¯ä»¥FIFOçš„é¡ºåºè¿›è¡Œä¼ è¾“çš„ã€‚ä½†æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ç›¸æ¯”æŒ‡å‘æ›´åŠ çµæ´»ï¼Œå› ä¸º<strong>æ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡é“¾è¡¨ç»“æ„å­˜æ”¾ä¿¡æ¯å¹¶ä¼ è¾“æ•°æ®</strong>ã€‚è¿™å°±é€ å°±äº†æ¶ˆæ¯é˜Ÿåˆ—ä¸€äº›ç®¡é“ä¸æ”¯æŒçš„ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼š<strong>æ¶ˆæ¯å¸¦æœ‰ç±»å‹æ ‡è¯†ç¬¦</strong>ï¼Œèƒ½å¤Ÿæ ‡è¯†æ¶ˆæ¯çš„ç±»å‹å’Œä¼˜å…ˆçº§ã€‚è¿™æ ·ï¼Œæ¶ˆæ¯å°±å¯ä»¥æ ¹æ®ç‰¹å®šçš„ç±»å‹å’Œä¼˜å…ˆçº§è¢«æ¶ˆæ¯æ¥æ”¶æ–¹æ‰€æ¥æ”¶ã€‚ï¼ˆé“¾è¡¨ç»“æ„çš„ä¾¿åˆ©ï¼‰</p></div><div class="el-p"><p dir="auto">ç®¡é“çš„åŒæ­¥æœºåˆ¶æ¯”è¾ƒç®€å•ï¼Œç”Ÿäº§è€…è¿›ç¨‹å†™å…¥æ•°æ®åï¼Œæ¶ˆè´¹è€…è¿›ç¨‹è¯»å–æ•°æ®ï¼Œè¿‡ç¨‹ç”±å†…æ ¸è‡ªåŠ¨ç®¡ç†ï¼Œä½†ç¼ºä¹æ˜¾å¼çš„åŒæ­¥æ§åˆ¶ã€‚è€Œæ¶ˆæ¯é˜Ÿåˆ—æ”¯æŒæ˜¾å¼åŒæ­¥ï¼Œé€šè¿‡<code>msgsnd</code>å’Œ<code>msgrcv</code>ç³»ç»Ÿè°ƒç”¨ï¼Œæä¾›è¿›ç¨‹é—´æ›´çµæ´»çš„åŒæ­¥ä¸è°ƒåº¦æœºåˆ¶ã€‚</p></div></div></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="ç¬¬å››è¯¾ Memory Mapped Files" dir="auto" class="heading" id="ç¬¬å››è¯¾_Memory_Mapped_Files"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>ç¬¬å››è¯¾ Memory Mapped Files</h2><div class="heading-children"><div class="el-hr"><hr></div><div class="el-p"><p dir="auto">ä¸€èˆ¬æˆ‘ä»¬å¯èƒ½å¹¶ä¸ä¼šå°†å†…å­˜æ˜ å°„æ–‡ä»¶ <code>mmap</code> æœºåˆ¶ä½œä¸ºä¸€ç§è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼å»ä½¿ç”¨ã€‚ä½†å®ƒç¡®å®å¯ä»¥æä¾›ä¿¡æ¯åœ¨ä¸åŒè¿›ç¨‹é—´çš„é€šä¿¡çš„åŠŸèƒ½ã€‚æˆ‘ä»¬ä¸‹é¢å°±ä¸€èµ·æ¥çœ‹çœ‹å®ƒçš„åŠŸèƒ½ã€‚</p></div><div class="el-p"><p dir="auto">è¿›ç¨‹æ˜ å°„æ–‡ä»¶ï¼Œä½ ä»åå­—ä¸Šå°±èƒ½çŸ¥é“å’Œæ–‡ä»¶è„±ä¸äº†å¹²ç³»ã€‚å®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†æ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä½¿å¾—è¿›ç¨‹å¯ä»¥ç›´æ¥é€šè¿‡å†…å­˜åœ°å€è®¿é—®æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸éœ€è¦ <code>read/write</code>ã€‚å³è®¿é—®å†…å­˜å°±ç­‰ä»·äºè®¿é—®æ–‡ä»¶ï¼ˆæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ç¼ºé¡µå’Œå›å†™ï¼‰ã€‚æˆ‘ä»¬å…ˆäº†è§£äº†è§£æ–‡ä»¶æ˜¯å¦‚ä½•æ‰“å¼€çš„ã€‚</p></div><div class="el-h3 heading-wrapper"><h3 data-heading="4.1 How Files are Opened" dir="auto" class="heading" id="4.1_How_Files_are_Opened"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.1 How Files are Opened</h3><div class="heading-children"><div class="el-p"><p dir="auto">è¯¦ç»†è¯·å‚é˜…<a data-href="13. File Systems" href="congzhi's-os-series/13.-file-systems.html" class="internal-link" target="_self" rel="noopener nofollow">13. File Systems</a>ï¼Œè¿™é‡Œä»…ä½œæ¦‚è¿°ã€‚</p></div><div class="el-p"><p dir="auto">æ“ä½œç³»ç»Ÿå†…ç»´æŠ¤äº†ä¸€å¼ <strong>æ‰“å¼€æ–‡ä»¶è¡¨&nbsp;(Open&nbsp;File&nbsp;Table,&nbsp;OFT)</strong>ï¼Œå…¶ä¸­åŒ…å«è®¸å¤šè¡¨é¡¹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º&nbsp;<strong>OFD&nbsp;(Open&nbsp;File Description)</strong>ã€‚å½“ä½ ä½¿ç”¨ <code>open("example.txt", O_RDONLY)</code> æ‰“å¼€æŸä¸€æ–‡ä»¶æ—¶ï¼Œå®é™…ä¸Šä½ åªæ˜¯å°†æ–‡ä»¶è¡¨é¡¹è¢«åŠ è½½è¿›äº†å†…å­˜ã€‚æ‰“å¼€æ–‡ä»¶è¡¨é¡¹åŒ…å«è¯¥æ–‡ä»¶çš„å…ƒæ•°æ®å’Œæ§åˆ¶ä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œä½ å°±å¯ä»¥çŸ¥é“å¦‚ä½•åœ¨ç£ç›˜ä¸­å¯»å¾—æ–‡ä»¶å†…å®¹äº†ã€‚</p></div><div class="el-p"><p dir="auto">å½“æŸä¸ªè¿›ç¨‹è¦æ‰“å¼€æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šé¦–å…ˆåœ¨æ‰“å¼€æ–‡ä»¶è¡¨ä¸­æŸ¥æ‰¾ç›¸å…³è¡¨é¡¹ï¼Œå¦‚æœæ‰¾åˆ°äº†ç›¸åº”çš„è¡¨é¡¹ï¼Œå°±è¯´æ˜æˆ‘ä»¬ä¸éœ€è¦ä»ç£ç›˜åŠ è½½æ–‡ä»¶æ‰“å¼€è¡¨é¡¹äº†ã€‚å³ä½¿å†…å®¹å¯èƒ½å¹¶æ²¡æœ‰è¢«åŠ è½½è¿›å†…å­˜ï¼Œä½†è¿™æ—¶æˆ‘ä»¬ä¹Ÿè¯´è¯¥æ–‡ä»¶å·²ç»æ‰“å¼€ã€‚ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰éœ€è¦ç”¨åˆ°å†…å®¹çš„æ—¶å€™æ‰ä¼šæŠŠæ–‡ä»¶å†…å®¹ä»ç£ç›˜ä¸ŠåŠ è½½è¿›å†…å­˜ï¼Œå³"lazy approach"ï¼‰</p></div><div class="el-p"><p dir="auto">å¯¹äºåªè¯»æ–‡ä»¶äº§ç”Ÿçš„æ¡ç›®ï¼Œæˆ‘ä»¬ä¸ç”¨æ‹…å¿ƒå¤šç¨‹åºå¹¶å‘å¸¦æ¥çš„åŒæ­¥äº’æ–¥é—®é¢˜ã€‚ä½†å½“æœ‰è¿›ç¨‹å†™æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ç•™æ„åŒæ­¥äº’æ–¥è®¿é—®æ–‡ä»¶èµ„æºçš„é—®é¢˜ã€‚</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="4.2 Memory Mapping Files Implementation:`mmap()`" dir="auto" class="heading" id="4.2_Memory_Mapping_Files_Implementation:`mmap()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.2 Memory Mapping Files Implementation:<code>mmap()</code></h3><div class="heading-children"><div class="el-p"><p dir="auto">å½“æ–‡ä»¶æ‰“å¼€ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ <code>mmap()</code> ç³»ç»Ÿè°ƒç”¨å»ºç«‹ä»æ–‡ä»¶åˆ°è¿›ç¨‹è™šæ‹Ÿå†…å­˜ç©ºé—´ä¹‹é—´çš„æ˜ å°„ã€‚ç”±äºè®¿é—® IO å¾ˆè€—æ—¶é—´ï¼Œæ‰€ä»¥è¿™æ—¶å€™ï¼Œæ–‡ä»¶å†…å®¹ä»ç„¶ä¸ä¼šåŠ è½½è¿›å†…å­˜ï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®æ˜ å°„åçš„åœ°å€ç©ºé—´æ—¶æ‰ä¼šï¼ˆç¼ºé¡µä¸­æ–­-&gt;åŠ è½½æ–‡ä»¶å†…å®¹ï¼‰ã€‚æˆ‘ç”¨ä¸€å¼ å›¾æ¥ç®€å•çš„å½¢å®¹ä¸€ä¸‹ï¼š</p></div><div class="el-p"><p dir="auto">åœ¨è¿›ç¨‹é€šè¿‡ <code>open()</code> ç³»ç»Ÿè°ƒç”¨çŸ¥é“æ–‡ä»¶çš„æºä¿¡æ¯åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ <code>mmap</code> å°†æ–‡ä»¶çš„å‰ 4KB å†…å®¹æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ã€‚è¿™æ—¶ä»…ä»…å»ºç«‹è™šæ‹Ÿåœ°å€åˆ°æ–‡ä»¶çš„è™šæ‹Ÿæ˜ å°„ã€‚å½“ç¨‹åºè¦è¯»/å†™æ–‡ä»¶æ—¶ï¼Œç”±äºç¼ºé¡µï¼Œè¿™æ—¶ç³»ç»Ÿåˆ†é… 4KB ç‰©ç†å†…å­˜å¹¶å»ºç«‹è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†å†…å­˜åœ°å€çš„æ˜ å°„ï¼Œå¹¶å°†æ–‡ä»¶å†…å®¹ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ï¼ˆå›¾åº”è¯¥æ˜¯ 0-4095 å­—èŠ‚ï¼‰<br>
<span alt="mmap.png" src="mmap.png" class="internal-embed media-embed image-embed is-loaded"><img alt="mmap.png" src="congzhi's-os-series/pics/mmap.png"></span></p></div><div class="el-h4 heading-wrapper"><h4 data-heading="4.2.1 `mmap()`" dir="auto" class="heading" id="4.2.1_`mmap()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.2.1 <code>mmap()</code></h4><div class="heading-children"><div class="el-p"><p dir="auto">ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“äº†å†…å­˜æ˜ å°„æ˜¯å°†ä¸€ä¸ªæ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚è¿›è€Œå®ç°æ–‡ä»¶ç£ç›˜å’Œè¿›ç¨‹è™šæ‹Ÿç©ºé—´ä¸­ä¸€æ®µè™šæ‹Ÿåœ°å€çš„ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚è¿™ç§å¯¹åº”å…³ç³»ä¼šä¿å­˜åœ¨è™šæ‹Ÿå­˜å‚¨ç©ºé—´çš„<strong>æ–‡ä»¶æ˜ å°„ä¸åŒ¿åæ˜ å°„åŒº</strong>ä¸­ï¼Œè¿™æ®µåŒºåŸŸä½äºå †å’Œæ ˆä¹‹é—´ã€‚</p></div><div class="el-p"><p dir="auto"><code>mmap</code>å‡½æ•°çš„å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">mmap</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> length<span class="token punctuation">,</span> <span class="token keyword">int</span> prot<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token class-name">off_t</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. addr: Starting address for the new mapping. Typically set to NULL to let the kernel choose the address.
	2. length: Length of the mapping in bytes. Must be a multiple of the system's page size.
	3. prot: Desired memory protection of the mapping. This can be a combination of the following:
	   - PROT_READ: Pages can be read.
	   - PROT_WRITE: Pages can be written.
	   - PROT_EXEC: Pages can be executed.
	   - PROT_NONE: Pages cannot be accessed.
	4. flags: Flags that determine the nature of the mapping. Common flags include:
       - MAP_SHARED: Write updates to the mapping are visible to other processes mapping the same region, and also reflected in the underlying file.
       - MAP_PRIVATE: Changes to the mapping are private to the process and not visible to other processes. Changes are not reflected in the underlying file (copy-on-write).
       - MAP_ANONYMOUS: Mapping is not backed by any file; the fd parameter is ignored (should be -1).
       - MAP_FIXED: Forces the mapping to use exactly the address specified in addr. Be cautious as it may overwrite existing mappings.
       - MAP_FIXED_NOREPLACE: Similar to MAP_FIXED, but will fail with EINVAL if the specified address is already occupied.
       - MAP_POPULATE: Populates page tables for the mapping immediately instead of waiting for lazy access.
       - MAP_NORESERVE: Prevents reserving swap space for the mapping. If physical memory runs out, the process may be terminated.
       - MAP_LOCKED: Locks the mapping in memory, preventing it from being swapped out.
       - MAP_HUGETLB: Uses huge pages for the mapping to reduce TLB (Translation Lookaside Buffer) overhead.
       - MAP_UNINITIALIZED: Allocates uninitialized memory. Unsafe and supported only on specific architectures.
	5. fd: File descriptor of the file to be mapped. Ignored if MAP_ANONYMOUS is set.
	6. offset: Offset in the file where the mapping starts. Typically set to 0.

Return value: Returns a pointer to the mapped area on success, or MAP_FAILED on failure. The errno variable is set to indicate the error.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="4.2.2 Protection Access Modification: `mprotect()`" dir="auto" class="heading" id="4.2.2_Protection_Access_Modification:_`mprotect()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.2.2 Protection Access Modification: <code>mprotect()</code></h4><div class="heading-children"><div class="el-p"><p dir="auto">å¦‚æœä½ æƒ³è¦ä¿®æ”¹æ˜ å°„åŒºåŸŸçš„ä¿æŠ¤æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>mprotect</code> ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">mprotect</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> address<span class="token punctuation">,</span> <span class="token class-name">size_t</span> length<span class="token punctuation">,</span> <span class="token keyword">int</span> prot<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. address: Starting address of the memory region to be protected.
	2. length: Length of the memory region in bytes.
	3. prot: Desired protection of the memory region. It can be a combination of the following:
	   - PROT_READ: Pages can be read.
	   - PROT_WRITE: Pages can be written.
	   - PROT_EXEC: Pages can be executed.
	   - PROT_NONE: Pages cannot be accessed.
   
Return value: Returns 0 on success, -1 on failure and sets errno to indicate the error.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="4.2.3 Mapping Consistency Guarantee : `msync()" dir="auto" class="heading" id="4.2.3_Mapping_Consistency_Guarantee_:_`msync()"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.2.3 Mapping Consistency Guarantee : `msync()</h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>msync</code>&nbsp;å‡½æ•°ç”¨äºåŒæ­¥å†…å­˜æ˜ å°„åŒºåŸŸä¸å…¶åº•å±‚å­˜å‚¨ä¹‹é—´çš„å†…å®¹ã€‚é€šè¿‡<code>msync</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿å†…å­˜ä¸­è¿›è¡Œçš„ä¿®æ”¹èƒ½å¤Ÿè¢«å†™å›åˆ°æ˜ å°„çš„æ–‡ä»¶ä¸Šï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚é€šå¸¸è€Œè¨€ï¼Œæˆ‘ä»¬åœ¨å¯¹å†…å­˜æ˜ å°„åŒºåŸŸè¿›è¡Œå†™æ“ä½œä¹‹åä½¿ç”¨<code>msync</code>ç¡®ä¿æ•°æ®çš„æŒä¹…ä¿å­˜ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">msync</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> address<span class="token punctuation">,</span> <span class="token class-name">size_t</span> length<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. address: Starting address of the memory region to be synchronized.
	2. length: Length of the memory region to be synchronized.
	3. flags: Flags that determine the synchronization behavior. Common flags include:
	   - MS_SYNC: Perform synchronous writes(blocking).
	   - MS_ASYNC: Perform asynchronous writes.
	   - MS_INVALIDATE: Invalidate all cached data.

Return value: Returns 0 on success, -1 on failure and sets errno to indicate the error.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="4.2.4 Memory Un-Mapping : `munmap()`" dir="auto" class="heading" id="4.2.4_Memory_Un-Mapping_:_`munmap()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.2.4 Memory Un-Mapping : <code>munmap()</code></h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>munmap</code> ç³»ç»Ÿè°ƒç”¨ç”¨äºè§£é™¤ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼Œå°†ä¹‹å‰é€šè¿‡ <code>mmap</code> æ˜ å°„çš„å†…å­˜åŒºåŸŸé‡Šæ”¾å›æ“ä½œç³»ç»Ÿã€‚å®ƒçš„å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">int</span> <span class="token function">munmap</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. addr: Starting address of the memory region to be unmapped. This should be the address returned by a previous call to mmap.
	2. length: Length of the memory region to be unmapped. Must be the same length as that specified in the original mmap call.

Return value: Returns 0 on success, -1 on failure and sets errno to indicate the error.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="4.3 IPC with `mmap()`" dir="auto" class="heading" id="4.3_IPC_with_`mmap()`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.3 IPC with <code>mmap()</code></h3><div class="heading-children"><div class="el-p"><p dir="auto">äº†è§£äº†å†…å­˜æ˜ å°„æ–‡ä»¶æ˜¯ä»€ä¹ˆã€‚ä½ åº”è¯¥èƒ½æƒ³å¾—åˆ°å¦‚æœä¸¤ä¸ªè¿›ç¨‹éƒ½å°†åŒä¸€ä¸ªæ–‡ä»¶æ˜ å°„åˆ°è‡ªå·±çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œå®ç°åŸºæœ¬çš„åŒæ­¥äº’æ–¥ã€‚é‚£ä¹ˆå°±å¯ä»¥å®ç°è¿›ç¨‹é—´çš„é€šä¿¡ã€‚è¿™å½“ç„¶æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¹Ÿå¤ªæ‰¯äº†ï¼Œéå¸¸æ— èŠã€‚æˆ‘ä»¬ä¸æƒ³å’Œæ–‡ä»¶æ‰“äº¤é“ã€‚</p></div><div class="el-p"><p dir="auto">å¦‚æœä½ ç»†å¿ƒï¼Œä½ å¯èƒ½ä¼šå¯¹ <code>mmap()</code> ç³»ç»Ÿè°ƒç”¨çš„ flags é¡¹æ„Ÿå…´è¶£ï¼š<code>MAP_PRIVATE</code>ã€<code>MAP_SHARED</code> å’Œ <code>MAP_ANONYMOUS</code>ã€‚å®ƒä»¬ä»€ä¹ˆæ„æ€ï¼Ÿæˆ‘ä»¬ä¸€é¡¹ä¸€é¡¹è§£é‡Šã€‚</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="4.3.1 `MAP_PRIVATE` and `MAP_SHARED`" dir="auto" class="heading" id="4.3.1_`MAP_PRIVATE`_and_`MAP_SHARED`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.3.1 <code>MAP_PRIVATE</code> and <code>MAP_SHARED</code></h4><div class="heading-children"><div class="el-p"><p dir="auto"><code>MAP_PRIVATE</code> æä¾›ä¸€ç§åªæœ‰è¿›ç¨‹å†…éƒ¨ç§æœ‰è¿™æ®µè™šæ‹Ÿå†…å­˜çš„æ˜ å°„å…³ç³»ã€‚</p></div><div class="el-p"><p dir="auto">è€Œ <code>MAP_SHARED</code> æä¾›å¤šçº¿ç¨‹å…±äº«åŒä¸€ç‰©ç†èµ„æºã€‚</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="4.3.2 Anonymous Mapping" dir="auto" class="heading" id="4.3.2_Anonymous_Mapping"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.3.2 Anonymous Mapping</h4><div class="heading-children"><div class="el-p"><p dir="auto">å½“ä½ ä½¿ç”¨ <code>MAP_ANONMYMOUS</code> æ—¶ï¼Œè™šæ‹Ÿå†…å­˜å°†ä¸ä¼šå’Œä»»ä½•æ–‡ä»¶äº§ç”Ÿæ˜ å°„å…³ç³»ï¼Œè€Œæ˜¯åœ¨è®¿é—®çš„æ—¶å€™ç³»ç»Ÿä¼šåˆ†é…ç‰©ç†å†…å­˜å¹¶å»ºç«‹è™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜ä¸Šçš„æ˜ å°„ã€‚</p></div><div class="el-p"><p dir="auto">ä½ å¯èƒ½äº†è§£è¿‡ï¼Œå½“åº“å‡½æ•° <code>malloc</code> ç”³è¯·å †å†…å­˜æ—¶ï¼Œç”³è¯·å†…å­˜å°äº 128KB æ—¶ï¼ˆä¸€èˆ¬è€Œè¨€ï¼‰ï¼Œåº•å±‚ä¼šè°ƒç”¨ <code>sbrk()</code> ç³»ç»Ÿè°ƒç”¨ã€‚å½“ç”³è¯·çš„å †å†…å­˜å¤§äº 128KB æ—¶ï¼Œåº•å±‚ä¼šè°ƒç”¨ <code>mmap()</code>ã€‚ä½ å¯èƒ½ä¼šå¥‡æ€ªä¸ºä»€ä¹ˆå †å†…å­˜çš„ç”³è¯·ä¼šå’Œå†…å­˜æ˜ å°„æ–‡ä»¶äº§ç”Ÿè”ç³»ï¼Œå³ä¾¿æ²¡æœ‰ä»»ä½•æ–‡ä»¶å‚ä¸ã€‚è€Œåˆ°è¿™é‡Œï¼Œä½ å¯èƒ½å°±æ˜ç™½æ˜¯æ€ä¹ˆå›äº‹äº†ã€‚</p></div><div class="el-p"><p dir="auto">å®é™…ä¸Šï¼Œè¿›ç¨‹å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šç”¨ <code>malloc</code> ç”³è¯·å†…å­˜æ®µç©ºé—´ï¼ˆæ•°æ®æ®µã€ä»£ç æ®µç­‰ï¼‰ã€‚è¿™äº›åœ¨ç¨‹åºè¿è¡Œçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸéƒ½ä¸ä¼šæ”¹å˜çš„å†…å­˜å°±ç›¸å½“äºï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span> MAP_PRIVATE <span class="token operator">|</span> MAP_FIXED <span class="token operator">|</span> MAP_ANONYMOUS<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Size must be a multiple of the system's page size. (4n * KB)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½ ä½¿ç”¨ <code>malloc</code> ç”³è¯·å¤§å—å†…å­˜æ—¶ï¼Œåº•å±‚è°ƒç”¨çš„ <code>mmap</code> å®é™…ä¸Šç›¸å½“äºï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span> MAP_PRIVATE <span class="token operator">|</span> MAP_ANONYMOUS<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Size must be a multiple of the system's page size. (4n * KB)</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">å¦‚æœé…åˆ <code>MAP_SHARED</code> æˆ‘ä»¬å°±å¯ä»¥å®ç°ç±»ä¼¼ <code>shm</code> å…±äº«å†…å­˜çš„è¿›ç¨‹é—´é€šä¿¡äº†ã€‚ä½†æ˜¯è¿™ç§è¿›ç¨‹é—´é€šä¿¡ä»…ä»…å­˜åœ¨äºçˆ¶å­è¿›ç¨‹æˆ–å…¶ä»–æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´ã€‚ä½†è¿™é‡Œä½ éœ€è¦çŸ¥é“ <code>mmap()</code> æ˜ å°„çš„å¤§å°åº”ä¸ºç³»ç»Ÿé¡µå¤§å°çš„å€æ•°ã€‚ï¼ˆé¡µå¤§å°ä¸€èˆ¬ä¸º 4KB ï¼Œä¹Ÿæœ‰ 16KB ç­‰çš„ï¼‰</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="4.4 Easy Peasy Example" dir="auto" class="heading" id="4.4_Easy_Peasy_Example"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>4.4 Easy Peasy Example</h3><div class="heading-children"><div class="el-p"><p dir="auto">ä¸‹é¢æˆ‘ä»¬è®©çˆ¶è¿›ç¨‹åœ¨â€å…±äº«å†…å­˜â€œä¸­å†™ <code>Hello, kid</code>ï¼Œç„¶åè®©å­è¿›ç¨‹è¯»ã€‚æˆ‘ä»¬ä¸è®¾ç½®å¤æ‚çš„åŒæ­¥äº’æ–¥æœºåˆ¶ï¼Œå…ˆè®©å­è¿›ç¨‹é˜»å¡ä¸€ç§’ã€‚è¿™é‡Œè¯·æ³¨æ„ï¼Œ<code>fork()</code>ç³»ç»Ÿè°ƒç”¨ä¼šå°†çˆ¶è¿›ç¨‹æ‰€æœ‰çš„èµ„æºéƒ½å¤åˆ¶ä¸€ä»½ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬å…³é—­æ–‡ä»¶æè¿°ç¬¦çš„æ—¶å€™åº”å½“å…³é—­ä¸¤æ¬¡ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MY_SHM_SIZE</span> <span class="token expression"><span class="token number">4096</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 1. create my shared memory</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>my_shm <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> MY_SHM_SIZE<span class="token punctuation">,</span>
                    PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span>
                    MAP_ANONYMOUS <span class="token operator">|</span> MAP_SHARED<span class="token punctuation">,</span>
                    <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>my_shm <span class="token operator">==</span> MAP_FAILED<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"mmap failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2. write-in</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>my_shm<span class="token punctuation">,</span> <span class="token string">"Hello, kid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. fork</span>
    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fork failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_FAILURE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Child received: %s\n"</span><span class="token punctuation">,</span> my_shm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span>EXIT_SUCCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">wait</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 4. unmapping</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">munmap</span><span class="token punctuation">(</span>my_shm<span class="token punctuation">,</span> MY_SHM_SIZE<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"munmap failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="ç¬¬äº”è¯¾ IPC for Process Control: Signals" dir="auto" class="heading" id="ç¬¬äº”è¯¾_IPC_for_Process_Control:_Signals"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>ç¬¬äº”è¯¾ IPC for Process Control: Signals</h2><div class="heading-children"><div class="el-hr"><hr></div><div class="el-p"><p dir="auto">åœ¨ä¸Šä¸ªé˜¶æ®µçš„æœ€åï¼Œæˆ‘ä»¬çœ‹äº†çœ‹å¦‚ä½•ç”¨ä¿¡å·å¤„ç†åƒµå°¸è¿›ç¨‹çš„é—®é¢˜ã€‚æˆ‘ä»¬é€šè¿‡æ³¨å†Œ<code>SIGCHILD</code>ä¿¡å·çš„å¤„ç†ç¨‹åºæ¥æ•è·å­è¿›ç¨‹ç»ˆæ­¢çš„ä¿¡å·ï¼Œä»è€Œé¿å…åƒµå°¸è¿›ç¨‹çš„äº§ç”Ÿã€‚ä¿¡å·æœºåˆ¶ä½œä¸ºä¸€ç§è½»é‡çº§çš„è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œæˆ‘ä»¬æœ¬èŠ‚è¯¾æ¥è¯¦ç»†æ¢è®¨æ¢è®¨ç›¸å…³çš„ç»†èŠ‚ã€‚</p></div><div class="el-h3 heading-wrapper"><h3 data-heading="5.1 Signaling vs. Exception" dir="auto" class="heading" id="5.1_Signaling_vs._Exception"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.1 Signaling vs. Exception</h3><div class="heading-children"><div class="el-p"><p dir="auto">åœ¨<a data-tooltip-position="top" aria-label="5. Interruption" data-href="5. Interruption" href="congzhi's-os-series/5.-interruption.html" class="internal-link" target="_self" rel="noopener nofollow">Interruption</a>çš„é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†å†…æ ¸æ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ã€‚å½“ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå†…æ ¸ä¼šæ¥ç®¡å¹¶æ‰§è¡Œç›¸åº”çš„å¼‚å¸¸å¤„ç†ä¾‹ç¨‹(exception handler)ã€‚å› ä¸ºå¼‚å¸¸çš„å¤„ç†ç¨‹åºéƒ½åœ¨å†…æ ¸ä¸­ï¼Œç”¨æˆ·ç¨‹åºå¯¹å¼‚å¸¸çš„å‘ç”Ÿæ˜¯æ¯«ä¸çŸ¥æƒ…çš„ã€‚æ¯”æ–¹è¯´ç¼ºé¡µä¸­æ–­ã€‚</p></div><div class="el-p"><p dir="auto"><a data-tooltip-position="top" aria-label="https://www.man7.org/linux/man-pages/man7/signal.7.html" rel="noopener nofollow" class="external-link" href="https://www.man7.org/linux/man-pages/man7/signal.7.html" target="_blank">ä¿¡å·æœºåˆ¶</a>åœ¨è½¯ä»¶å±‚é¢ä¸Šæ¨¡æ‹Ÿäº†ç¡¬ä»¶ä¸­æ–­ã€‚ä¿¡å·æä¾›äº†ä¸€ç§æœºåˆ¶æ¥é€šçŸ¥ç”¨æˆ·è¿›ç¨‹å‘ç”Ÿäº†ä½•ç§å¼‚å¸¸ï¼Œä»¥ä¾¿ç”¨æˆ·ç¨‹åºèƒ½å¤Ÿæ ¹æ®è‡ªèº«æƒ…å†µåšå‡ºå“åº”ã€‚å›æƒ³åœ¨ç”¨ä¿¡å·å¤„ç†åƒµå°¸è¿›ç¨‹æ—¶ï¼Œæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„handlerå®é™…ä¸Šæ˜¯æ”¾åœ¨ç”¨æˆ·åŒºçš„ï¼Œè€Œä¸­æ–­é€šå¸¸ä¼šåœ¨å†…æ ¸ç©ºé—´ä¸­æ‰§è¡Œã€‚æ­¤å¤–ï¼Œä¿¡å·çš„è§¦å‘å’Œå¤„ç†æœºåˆ¶å’Œä¸­æ–­å¹¶ä¸ç›¸åŒã€‚ï¼ˆä¿¡å·çš„åµŒå¥—æ˜¯è¢«å…è®¸çš„ã€‚ï¼‰</p></div><div class="el-p"><p dir="auto">Linuxä¸­å…±æœ‰64ç§ä¿¡å·ï¼Œå…¶ä¸­1-34å±äºéå®æ—¶ä¿¡å·ï¼Œè€Œ35-64å±äºå®æ—¶ä¿¡å·ï¼Œç”¨äºå®æ—¶ç³»ç»Ÿã€‚</p></div><div class="el-pre"><pre class="language-sh" tabindex="0"><code data-line="0" class="language-sh is-loaded">$ <span class="token function">kill</span> <span class="token parameter variable">-l</span>
 <span class="token number">1</span><span class="token punctuation">)</span> SIGHUP	 <span class="token number">2</span><span class="token punctuation">)</span> SIGINT	 <span class="token number">3</span><span class="token punctuation">)</span> SIGQUIT	 <span class="token number">4</span><span class="token punctuation">)</span> SIGILL	 <span class="token number">5</span><span class="token punctuation">)</span> SIGTRAP
 <span class="token number">6</span><span class="token punctuation">)</span> SIGABRT	 <span class="token number">7</span><span class="token punctuation">)</span> SIGBUS	 <span class="token number">8</span><span class="token punctuation">)</span> SIGFPE	 <span class="token number">9</span><span class="token punctuation">)</span> SIGKILL	<span class="token number">10</span><span class="token punctuation">)</span> SIGUSR1
<span class="token number">11</span><span class="token punctuation">)</span> SIGSEGV	<span class="token number">12</span><span class="token punctuation">)</span> SIGUSR2	<span class="token number">13</span><span class="token punctuation">)</span> SIGPIPE	<span class="token number">14</span><span class="token punctuation">)</span> SIGALRM	<span class="token number">15</span><span class="token punctuation">)</span> SIGTERM
<span class="token number">16</span><span class="token punctuation">)</span> SIGSTKFLT	<span class="token number">17</span><span class="token punctuation">)</span> SIGCHLD	<span class="token number">18</span><span class="token punctuation">)</span> SIGCONT	<span class="token number">19</span><span class="token punctuation">)</span> SIGSTOP	<span class="token number">20</span><span class="token punctuation">)</span> SIGTSTP
<span class="token number">21</span><span class="token punctuation">)</span> SIGTTIN	<span class="token number">22</span><span class="token punctuation">)</span> SIGTTOU	<span class="token number">23</span><span class="token punctuation">)</span> SIGURG	<span class="token number">24</span><span class="token punctuation">)</span> SIGXCPU	<span class="token number">25</span><span class="token punctuation">)</span> SIGXFSZ
<span class="token number">26</span><span class="token punctuation">)</span> SIGVTALRM	<span class="token number">27</span><span class="token punctuation">)</span> SIGPROF	<span class="token number">28</span><span class="token punctuation">)</span> SIGWINCH	<span class="token number">29</span><span class="token punctuation">)</span> SIGIO	<span class="token number">30</span><span class="token punctuation">)</span> SIGPWR
<span class="token number">31</span><span class="token punctuation">)</span> SIGSYS	<span class="token number">34</span><span class="token punctuation">)</span> SIGRTMIN	<span class="token number">35</span><span class="token punctuation">)</span> SIGRTMIN+1	<span class="token number">36</span><span class="token punctuation">)</span> SIGRTMIN+2	<span class="token number">37</span><span class="token punctuation">)</span> SIGRTMIN+3
<span class="token number">38</span><span class="token punctuation">)</span> SIGRTMIN+4	<span class="token number">39</span><span class="token punctuation">)</span> SIGRTMIN+5	<span class="token number">40</span><span class="token punctuation">)</span> SIGRTMIN+6	<span class="token number">41</span><span class="token punctuation">)</span> SIGRTMIN+7	<span class="token number">42</span><span class="token punctuation">)</span> SIGRTMIN+8
<span class="token number">43</span><span class="token punctuation">)</span> SIGRTMIN+9	<span class="token number">44</span><span class="token punctuation">)</span> SIGRTMIN+10	<span class="token number">45</span><span class="token punctuation">)</span> SIGRTMIN+11	<span class="token number">46</span><span class="token punctuation">)</span> SIGRTMIN+12	<span class="token number">47</span><span class="token punctuation">)</span> SIGRTMIN+13
<span class="token number">48</span><span class="token punctuation">)</span> SIGRTMIN+14	<span class="token number">49</span><span class="token punctuation">)</span> SIGRTMIN+15	<span class="token number">50</span><span class="token punctuation">)</span> SIGRTMAX-14	<span class="token number">51</span><span class="token punctuation">)</span> SIGRTMAX-13	<span class="token number">52</span><span class="token punctuation">)</span> SIGRTMAX-12
<span class="token number">53</span><span class="token punctuation">)</span> SIGRTMAX-11	<span class="token number">54</span><span class="token punctuation">)</span> SIGRTMAX-10	<span class="token number">55</span><span class="token punctuation">)</span> SIGRTMAX-9	<span class="token number">56</span><span class="token punctuation">)</span> SIGRTMAX-8	<span class="token number">57</span><span class="token punctuation">)</span> SIGRTMAX-7
<span class="token number">58</span><span class="token punctuation">)</span> SIGRTMAX-6	<span class="token number">59</span><span class="token punctuation">)</span> SIGRTMAX-5	<span class="token number">60</span><span class="token punctuation">)</span> SIGRTMAX-4	<span class="token number">61</span><span class="token punctuation">)</span> SIGRTMAX-3	<span class="token number">62</span><span class="token punctuation">)</span> SIGRTMAX-2
<span class="token number">63</span><span class="token punctuation">)</span> SIGRTMAX-1	<span class="token number">64</span><span class="token punctuation">)</span> SIGRTMAX
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">åœ¨ä¸Šä¸ªé˜¶æ®µçš„æœ€åï¼Œæˆ‘ä»¬è¿˜ç®€å•åœ°äº†è§£äº†ä¿¡å·çš„ default actionï¼Œç„¶è€Œå¯¹äºå¤§éƒ¨åˆ†ä¿¡å·è€Œè¨€ï¼Œè¿›ç¨‹å¯ä»¥å¯¹ç‰¹å®šçš„ä¿¡å·è¿›è¡Œå¿½ç•¥æˆ–è®¾ç½®è‡ªå·±çš„ä¿¡å·å¤„ç†ç¨‹åºã€‚</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="5.2 Signal Control" dir="auto" class="heading" id="5.2_Signal_Control"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.2 Signal Control</h3><div class="heading-children"><div class="el-h4 heading-wrapper"><h4 data-heading="5.2.1 Kernel Data Structure (`include/linux/sched/signal.h`)" dir="auto" class="heading" id="5.2.1_Kernel_Data_Structure_(`include/linux/sched/signal.h`)"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.2.1 Kernel Data Structure (<code>include/linux/sched/signal.h</code>)</h4><div class="heading-children"><div class="el-p"><p dir="auto">å­¦å®Œè¿›ç¨‹ï¼Œæˆ‘ä»¬ç°åœ¨çŸ¥é“æ¯ä¸ªè¿›ç¨‹ä¼šå¯¹åº”ä¸€ä¸ª <code>task_struct</code> ç»“æ„ä½“ï¼Œå…¶ä¸­ï¼Œå°±æœ‰å¾ˆå¤šä¸ä¿¡å·ç›¸å…³çš„æ•°æ®ç»“æ„ã€‚å¯¹äºä¿¡å·çš„ç®¡ç†ï¼Œæˆ‘ä»¬æœ‰ <code>signal_struct</code> ç»“æ„ä½“ã€<code>sighand_struct</code>ã€ä¿¡å·é›† <code>sigset_t</code> å’Œç”¨äºè®°å½•å½“å‰æŒ‚èµ·ä¿¡å·çš„ <code>sigpending</code> ç»“æ„ä½“ã€‚</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">struct</span> <span class="token class-name">task_struct</span><span class="token punctuation">{</span>
<span class="token comment">// ...</span>
	<span class="token comment">// æŒ‡å‘ä¸€ä¸ªsignal_structç»“æ„ä½“çš„æŒ‡é’ˆã€‚ç”¨äºç®¡ç†ä¸è¿›ç¨‹ç›¸å…³çš„ä¿¡å·ä¿¡æ¯ã€‚</span>
	<span class="token keyword">struct</span> <span class="token class-name">signal_struct</span> <span class="token operator">*</span>signal<span class="token punctuation">;</span> 
	<span class="token comment">// æŒ‡å‘ä¸€ä¸ªsighand_structç»“æ„ä½“ã€‚ç”¨äºç®¡ç†ä¿¡å·æœåŠ¡ä¾‹ç¨‹ã€‚	</span>
	<span class="token keyword">struct</span> <span class="token class-name">sighand_struct</span> <span class="token operator">*</span>sighand<span class="token punctuation">;</span> 
	<span class="token comment">// ç”¨äºè¡¨ç¤ºå½“å‰è¢«é˜»å¡çš„ä¿¡å·ã€‚å…¶ä¸­sigset_tæ˜¯ä¸€ä¸ª64ä½çš„ä½æ©ç ã€‚</span>
	<span class="token class-name">sigset_t</span> blocked<span class="token punctuation">;</span>
	<span class="token comment">// sigpendingç”¨äºè¡¨ç¤ºå½“å‰æŒ‚èµ·çš„ä¿¡å·ã€‚</span>
	<span class="token keyword">struct</span> <span class="token class-name">sigpending</span> pending<span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20250128190859.png" src="Pasted image 20250128190859.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20250128190859.png" src="congzhi's-os-series/pics/pasted-image-20250128190859.png"></span></p></div><div class="el-h5 heading-wrapper"><h5 data-heading="5.2.1.1 `struct signal_struct`" dir="auto" class="heading" id="5.2.1.1_`struct_signal_struct`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.2.1.1 <code>struct signal_struct</code></h5><div class="heading-children"><div class="el-p"><p dir="auto">åœ¨ <code>task_struct</code> ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°æ¯ä¸ªè¿›ç¨‹ç§æœ‰çš„æŒ‚èµ·ä¿¡å· <code>sigpending</code>ã€‚è€Œåœ¨ <code>signal_struct</code> ä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªå­˜æ”¾è¿›ç¨‹ç»„å…±äº«æŒ‚èµ·ä¿¡å·çš„æ•°æ®ç»“æ„ <code>shared_pending</code>ã€‚åœ¨å­¦ä¹ <a data-tooltip-position="top" aria-label="6. Processing The Processes > 3.2.1 Process Group" data-href="6. Processing The Processes#3.2.1 Process Group" href="congzhi's-os-series/6.-processing-the-processes.html#3.2.1_Process_Group" class="internal-link" target="_self" rel="noopener nofollow">è¿›ç¨‹ç»„</a>æ—¶æåˆ°ï¼Œä¿¡å·çš„å¤„ç†å¯ä»¥ä»¥è¿›ç¨‹ç»„ä¸ºå•ä½è¿›è¡Œã€‚å½“ä¿¡å·å‘å‡ºæ—¶ï¼Œä¿¡å·ä¼šè¢«å­˜æ”¾åœ¨ <code>shared_pending</code> ç»“æ„ä½“ä¸­ã€‚</p></div><div class="el-p"><p dir="auto"><code>signal_struct</code>çš„ç»“æ„ä½“åŸå‹å¦‚ä¸‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">struct</span> <span class="token class-name">signal_struct</span> <span class="token punctuation">{</span>
    <span class="token class-name">atomic_t</span> sigcnt<span class="token punctuation">;</span>
    <span class="token class-name">atomic_t</span> live<span class="token punctuation">;</span>
    <span class="token keyword">int</span> nr_threads<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">list_head</span> thread_head<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sigpending</span> shared_pending<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sigpending</span> group_exit_pending<span class="token punctuation">;</span>
    <span class="token keyword">int</span> group_exit_code<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> flags<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">rcu_head</span> rcu<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. sigcnt: Atomic counter for the number of signals.
	2. live: Atomic counter for the number of live processes in the signal group.
	3. nr_threads: Number of threads in the signal group.
	4. thread_head: List head for the threads in the signal group.
	5. shared_pending: Shared pending signals for the signal group.
	6. group_exit_pending: Pending signals for group exit.
	7. group_exit_code: Exit code for the group exit.
	8. flags: Flags for the signal group.
	9. rcu: RCU head for the signal group.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="5.2.1.2 `typedef unsigned long sigset_t`" dir="auto" class="heading" id="5.2.1.2_`typedef_unsigned_long_sigset_t`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.2.1.2 <code>typedef unsigned long sigset_t</code></h5><div class="heading-children"><div class="el-p"><p dir="auto"><code>sigset_t</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ªä½æ©ç (bitmask)ï¼Œç”¨äºè¡¨ç¤ºä¸€ç»„ä¿¡å·ã€‚åœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸­ï¼Œ<code>sigset_t</code> æ˜¯ä¸€ä¸ª 64 ä½çš„ <code>unsigned long</code> æ•°æ®ç±»å‹ï¼Œæ¯ä¸€ä½ä»£è¡¨ä¸€ä¸ªä¿¡å·ã€‚ç”±äºæˆ‘ä»¬æœ‰ 64 ç§ä¿¡å·ï¼Œå› æ­¤æ¯ä¸€ä½å¯ä»¥è¡¨ç¤ºä¸€ä¸ªä¿¡å·çš„çŠ¶æ€ã€‚å½“æˆ‘ä»¬å‘é€æŸä¸ªä¿¡å·æ—¶ï¼Œå°±å°† <code>sigset_t</code> çš„é‚£ä¸€ä½ç½®ä¸º 1ã€‚</p></div><div class="el-p"><p dir="auto">ä¿¡å·çš„è½»é‡å‹å°±ä½“ç°åœ¨è¿™ç§ä½¿ç”¨ä½æ“ä½œæ¥ç®¡ç†å’Œæ“ä½œä¿¡å·é›†çš„æ–¹å¼ã€‚</p></div></div></div><div class="el-h5 heading-wrapper"><h5 data-heading="5.2.1.3 `sighand_struct`" dir="auto" class="heading" id="5.2.1.3_`sighand_struct`"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.2.1.3 <code>sighand_struct</code></h5><div class="heading-children"><div class="el-p"><p dir="auto"><code>sighand_struct</code>æ˜¯ä¿¡å·å¤„ç†ç¨‹åºçš„ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸‰ä¸ªå‚æ•°ã€‚æˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯<code>struct k_sigaction action[64];</code>ã€‚ä»æ•°ç»„çš„å¤§å°å°±èƒ½çœ‹æ¥ï¼Œå…¶å¯¹åº”Linuxä¸­æ”¯æŒçš„64ç§ä¿¡å·ï¼Œæ ¹æ®æ•°ç»„ç¼–å·çš„ä¸åŒï¼Œè®°å½•ç€ä¸åŒä¿¡å·çš„å¤„ç†æ–¹å¼ï¼ˆactionsï¼‰ã€‚</p></div><div class="el-p"><p dir="auto">ç»“æ„ä½“<code>k_sigaction</code>çš„åŸå‹å¦‚ä¸‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">struct</span> <span class="token class-name">k_sigaction</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">sigaction</span> sa<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> sa_flags<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>sa_restorer<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    __sigaction_handler_t sa_handler<span class="token punctuation">;</span>
    <span class="token class-name">sigset_t</span> sa_mask<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. sa: User-defined signal handler structure, containing the signal handling function and signal mask.
	2. sa_flags: Signal handling flags, used to control the behavior of signal handling.
	3. sa_restorer: Restorer function pointer, used to restore the execution environment after the signal handler returns.
	4. sa_handler: User-defined signal handler function pointer.
	5. sa_mask: Signal mask, used to block certain signals during the execution of the signal handler.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">å…¶ä¸­çš„<code>struct sigaction</code>å°±æ˜¯ç”¨äºå®šä¹‰ä¿¡å·å¤„ç†ç¨‹åºçš„ç»“æ„ä½“ã€‚å…¶å‚æ•°åŒ…å«ä¿¡å·å¤„ç†å‡½æ•°ã€ä¿¡å·æ©ç å’Œæ§åˆ¶æ ‡å¿—ç­‰ã€‚ä¸‹é¢æ˜¯<code>struct sigaction</code>çš„ç»“æ„ä½“åŸå‹ï¼š</p></div><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token keyword">struct</span> <span class="token class-name">sigaction</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>sa_handler<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>sa_sigaction<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">siginfo_t</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">sigset_t</span> sa_mask<span class="token punctuation">;</span>
    <span class="token keyword">int</span> sa_flags<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>sa_restorer<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. sa_handler: Signal handling function pointer, which is called when the signal is received.
	2. sa_sigaction: Alternative signal handling function pointer, used when the SA_SIGINFO flag is set.
	3. sa_mask: Signal mask, used to block certain signals during the execution of the signal handler.
	4. sa_flags: Signal handling flags, used to control the behavior of signal handling.
	5. sa_restorer: Restorer function pointer, used to restore the execution environment after the signal handler returns.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">è¿™é‡Œé¢ï¼Œ<code>sa_handler</code>æ˜¯æŒ‡å‘ä¿¡å·å¤„ç†å‡½æ•°çš„å‡½æ•°æŒ‡é’ˆï¼Œå½“æ”¶åˆ°ä¿¡å·æ—¶è°ƒç”¨ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢„å®šä¹‰çš„å¸¸é‡<code>SIG_DFL</code>ï¼ˆé»˜è®¤ä¿¡å·å¤„ç†ï¼‰æˆ–è€…<code>SIG_IGN</code>ï¼ˆå¿½ç•¥ä¿¡å·ï¼‰æ¥è®¾ç½®è¿™ä¸ªå­—æ®µã€‚</p></div></div></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="5.1.3 Signal Blocking and Signal Pending" dir="auto" class="heading" id="5.1.3_Signal_Blocking_and_Signal_Pending"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.1.3 Signal Blocking and Signal Pending</h4><div class="heading-children"><div class="el-p"><p dir="auto">ä¿¡å·å¯ä»¥è¢«é˜»å¡å±è”½(blocked)ï¼Œè¢«å±è”½ä¿¡å·ä¸ä¼šç«‹å³è¢«ä¼ é€’ç»™è¿›ç¨‹çš„ä¿¡å·å¤„ç†ç¨‹åºã€‚è¿™äº›ä¿¡å·ä¼šè¢«ä¿ç•™ï¼Œç›´åˆ°å®ƒè¢«è§£é™¤å±è”½åæ‰ä¼šè¢«å¤„ç†ã€‚å±è”½è¿›ç¨‹ç”¨äºé˜»æ­¢æŸäº›ä¿¡å·çš„å¹²æ‰°ï¼Œä»¥ç¡®ä¿è¿›ç¨‹åœ¨å…³é”®æ“ä½œæœŸé—´ä¸ä¼šè¢«ä¿¡å·ä¸­æ–­ã€‚åœ¨å±è”½æœŸé—´åˆ°æ¥çš„ä¿¡å·å¹¶ä¸ä¼šè¢«å¤„ç†ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä¿¡å·çš„æŒ‚èµ·(pending)ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è‡ªå·±çš„æŒ‚èµ·ä¿¡å·é›†(pending signal set)ï¼Œé›†åˆä¸­çš„ä¿¡å·è¡¨ç¤ºä¸æ˜¯0å°±æ˜¯1ï¼ˆè¡¨ç¤ºè¢«æŒ‚èµ·ï¼Œéœ€è¦è¢«å¤„ç†ï¼‰,ä¸€ä¸ªä¿¡å·æ— è®ºæœ‰è¢«æŒ‚èµ·å¤šå°‘æ¬¡ï¼Œæœ€ç»ˆåªä¼šè¢«å¤„ç†ä¸€æ¬¡ã€‚è¿›ç¨‹çš„ä¿¡å·æŒ‚èµ·é›†åˆæ˜¯æœ‰çº¿ç¨‹å±è”½é›†åˆåˆå¹¶ç”Ÿæˆçš„ã€‚<code>fork(2)</code>åˆ›å»ºå¥½çš„å­è¿›ç¨‹ä¼šåˆå§‹åŒ–è‡ªå·±çš„é›†åˆã€‚</p></div><div class="el-p"><p dir="auto">è¿›ç¨‹å¯ä»¥ä½¿ç”¨<code>sigprocmask(2)</code>æ¥æ“ä½œä¿¡å·çš„å±è”½ï¼Œä½œç”¨äºä¸‹è¾–æ‰€æœ‰çš„çº¿ç¨‹ã€‚åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ <code>pthread_sigmask(2)</code> å¯ä»¥ç¡®ä¿ä¿¡å·å±è”½è®¾ç½®ä»…å½±å“å½“å‰çº¿ç¨‹ã€‚forkä½†å­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹å¯¹ä¿¡å·çš„å±è”½ï¼Œåœ¨<code>execve(2)</code>åä»ç„¶ä¼šä¿ç•™ã€‚</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="5.3 Signal Handling" dir="auto" class="heading" id="5.3_Signal_Handling"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.3 Signal Handling</h3><div class="heading-children"><div class="el-p"><p dir="auto">å¦‚æœæˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšï¼Œä¸åŒçš„ä¿¡å·ä¼šè¡¨ç°å‡ºä¸åŒçš„é»˜è®¤æ“ä½œã€‚æ ¹æ®ä¿¡å·çš„ä¸åŒï¼Œä¸åŒçš„ä¿¡å·æœ‰ä»¥ä¸‹äº”ç§ä¸åŒçš„ default actionï¼š</p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr">Default Action</th>
<th dir="ltr">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr">Term</td>
<td dir="ltr">to terminate the process</td>
</tr>
<tr>
<td dir="ltr">Ign</td>
<td dir="ltr">to ignore the signal</td>
</tr>
<tr>
<td dir="ltr">Core</td>
<td dir="ltr">to terminate the process and core dump</td>
</tr>
<tr>
<td dir="ltr">Stop</td>
<td dir="ltr">to stop the process</td>
</tr>
<tr>
<td dir="ltr">Cont</td>
<td dir="ltr">to continue the process if it is currently stopped.</td>
</tr>
</tbody>
</table></div><div class="el-p"><p dir="auto">ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä½¿ç”¨<code>signal(2)</code>æˆ–<code>sigaction(2)</code>æ¥æ”¹å˜ä¿¡å·çš„é»˜è®¤å¤„ç†æ–¹å¼ã€‚å½“ä¸€ä¸ªä¿¡å·è¢«ä¼ é€ç»™è¿›ç¨‹æ—¶ï¼Œå¯¹äºå¤§å¤šæ•°ä¿¡å·ï¼Œè¿›ç¨‹å¯ä»¥è‡ªè¡Œå†³å®šæ˜¯æŒ‰ç…§é»˜è®¤æ–¹å¼å¤„ç†å‘¢ã€è¿˜æ˜¯å¿½è§†æ‰è¿™ä¸ªä¿¡å·ã€äº¦æˆ–æ˜¯ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„å‡½æ•°æ¥å¤„ç†ä¿¡å·ã€‚è¿›ç¨‹çš„å¤„ç†æ–¹å¼æ˜¯ä¸€ä¸ªper-processçš„äº‹æƒ…ï¼Œè¿™å°±æ„å‘³ç€åŒä¸€è¿›ç¨‹ä¸­çš„ä¸åŒçº¿ç¨‹å¯¹äºç›¸åŒä¿¡å·çš„å¤„ç†æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚<code>fork()</code>åï¼Œå­è¿›ç¨‹çš„ä¿¡å·å¤„ç†å’Œçˆ¶è¿›ç¨‹ç›¸åŒï¼Œåœ¨<code>execve(2)</code>åæ”¹å˜ã€‚</p></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="5.4 Signal Sending and Receiving" dir="auto" class="heading" id="5.4_Signal_Sending_and_Receiving"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.4 Signal Sending and Receiving</h3><div class="heading-children"><div class="el-p"><p dir="auto">ä¿¡å·æœ‰å¾ˆå¤šä¸åŒçš„ç±»å‹ï¼Œåˆ†åˆ«ä»£è¡¨ç€ä¸åŒäº‹ä»¶çš„å‘ç”Ÿã€‚ä¿¡å·å¯ä»¥ç”±å†…æ ¸ã€å…¶ä»–è¿›ç¨‹æˆ–è‡ªèº«è¿›ç¨‹å‘é€ï¼Œç”¨äºé€šçŸ¥è¿›ç¨‹å‘ç”Ÿäº†æŸäº›äº‹ä»¶ã€‚å½“ä¸€ä¸ªè¿›ç¨‹å‘å¦ä¸€ä¸ªè¿›ç¨‹å‘é€ä¿¡å·æ—¶ï¼Œä¼šç»ç”±å†…æ ¸å°†ä¿¡å·ä¼ é€’ç»™ç›®æ ‡è¿›ç¨‹ï¼Œå†…æ ¸èµ·åˆ°ä¸­ä»‹çš„ä½œç”¨ã€‚</p></div><div class="el-h4 heading-wrapper"><h4 data-heading="5.4.1 Sending a Signal" dir="auto" class="heading" id="5.4.1_Sending_a_Signal"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.4.1 Sending a Signal</h4><div class="heading-children"><div class="el-p"><p dir="auto">Send a signal, raise a flagï¼Œä¿¡å·éå¸¸å°ï¼Œä¸€èˆ¬ä¸æºå¸¦æ•°æ®ä¿¡æ¯ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¯´ä¿¡å·æ˜¯è½»é‡çº§çš„è¿›ç¨‹é—´é€šä¿¡ã€‚å½“è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·æ—¶ï¼Œå†…æ ¸ä¼šåœ¨ç›®æ ‡è¿›ç¨‹çš„ä¿¡å·é˜Ÿåˆ—ï¼ˆsignal pending setï¼‰ä¸­æ·»åŠ è¯¥ä¿¡å·ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™å°†å…¶ä¼ é€’ç»™ç›®æ ‡è¿›ç¨‹ã€‚ä¿¡å·å¯èƒ½è¢«é˜»å¡ï¼Œè¿™å°±æ„å‘³ç€ä¿¡å·æš‚æ—¶ä¸ä¼šè¢«å¤„ç†ã€‚è‹¥æœªé˜»å¡ä¿¡å·ï¼Œç›®æ ‡è¿›ç¨‹æ¥æ”¶åˆ°ä¿¡å·åï¼Œä¼šåœ¨é€‚å½“çš„å®é™…ç”¨é¢„å…ˆè®¾å®šçš„ä¿¡å·å¤„ç†ç¨‹åºæ¥å¤„ç†è¯¥ä¿¡å·ã€‚</p></div><div class="el-p"><p dir="auto">æ ¹æ®ä¸åŒçš„ç³»ç»Ÿè°ƒç”¨æ¥å£ï¼Œä¿¡å·ä¼šè¢«å‘é€ç»™è¿›ç¨‹ç»„ï¼ˆ<code>killpg()</code>ï¼‰ã€è¿›ç¨‹ï¼ˆ<code>kill()</code>, <code>sigqueue()</code>, <code>pid_send_signal()</code>ï¼‰æˆ–æ˜¯çº¿ç¨‹ï¼ˆ<code>raise()</code>, <code>pthread_kill()</code>, <code>tgkill()</code>ï¼‰ã€‚å½“ä¿¡å·å‘é€ç»™çº¿ç¨‹æ—¶ï¼Œç‰¹å®šçš„çº¿ç¨‹ä¼šåœ¨æœªé˜»å¡ç›¸å…³ä¿¡å·æ—¶å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚å½“å‘é€ç»™è¿›ç¨‹æ—¶ï¼Œæœ¬ç€é˜»å¡ä¸ç»å¯¹å°±æ˜¯ç»å¯¹ä¸é˜»å¡çš„åŸåˆ™ï¼Œå†…æ ¸ä¼šä»»æ„æŒ‘é€‰ä¸€ä¸ªæœªå¯¹ç‰¹ç‚¹ä¿¡å·è¿›è¡Œé˜»å¡çš„çº¿ç¨‹æ¥å¤„ç†ç›¸å…³çš„ä¿¡å·æœåŠ¡ä¾‹ç¨‹ã€‚</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="5.4.2 Waiting for a Signal to be Caught" dir="auto" class="heading" id="5.4.2_Waiting_for_a_Signal_to_be_Caught"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.4.2 Waiting for a Signal to be Caught</h4><div class="heading-children"><div class="el-p"><p dir="auto">æˆ‘ä»¬æœ‰ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ <code>pause()</code> å’Œ <code>sigsuspend()</code> æ¥æŒ‚èµ·çº¿ç¨‹çš„æ‰§è¡Œï¼Œç›´åˆ°æœ‰ä¿¡å·è¢«æ•è·ã€‚</p></div><div class="el-p"><p dir="auto"><code>pause()</code> ç³»ç»Ÿè°ƒç”¨ä¼šæŒ‚èµ·æ‰§è¡Œï¼Œæ•è·ä»»ä½•ä¿¡å·éƒ½ä¼šè®©çº¿ç¨‹æ¥ç€æ‰§è¡Œã€‚</p></div><div class="el-p"><p dir="auto"><code>sigsuspend()</code> ä¹Ÿä¼šæŒ‚èµ·çº¿ç¨‹ï¼Œä½†ä¸åŒçš„æ˜¯ï¼Œ<code>sigsuspend()</code> ä¼šä¸´æ—¶æ”¹å˜ä¿¡å·å±è”½å­—ï¼Œå¹¶ä¸”åªä¼šåœ¨æœªè¢«å±è”½çš„ä¿¡å·è¢«æ•è·æ—¶æ‰æ¢å¤çº¿ç¨‹çš„æ‰§è¡Œã€‚è¿™ä½¿å¾— <code>sigsuspend()</code> æ›´çµæ´»ï¼Œå› ä¸ºä½ èƒ½æ§åˆ¶åœ¨ç­‰å¾…æ—¶å“ªäº›ä¿¡å·æ˜¯å±è”½çš„ï¼Œå“ªäº›ä¿¡å·æ˜¯å¯å¤„ç†çš„ã€‚</p></div></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="5.4.3 Receiving a Signal" dir="auto" class="heading" id="5.4.3_Receiving_a_Signal"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.4.3 Receiving a Signal</h4><div class="heading-children"></div></div><div class="el-h4 heading-wrapper"><h4 data-heading="5.1.4 Execution of Signal Handler" dir="auto" class="heading" id="5.1.4_Execution_of_Signal_Handler"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.1.4 Execution of Signal Handler</h4><div class="heading-children"><div class="el-p"><p dir="auto">å½“å‘ç”Ÿä»å†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„è½¬å˜ï¼ˆç³»ç»Ÿè°ƒç”¨è¿”å›ã€å‘ç”Ÿçº¿ç¨‹çš„è°ƒåº¦ï¼‰æ—¶ï¼Œå†…æ ¸ä¼šæ£€æŸ¥æ˜¯å¦æœ‰æœªé˜»å¡çš„æŒ‚èµ·ä¿¡å·ã€‚å¦‚æœè¿›ç¨‹è‡ªå·±æ³¨å†Œäº†ç›¸å…³çš„ä¿¡å·æœåŠ¡ä¾‹ç¨‹ï¼Œé‚£ä¹ˆä¸€æ—¦å‘ç”Ÿä»å†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„è½¬å˜ï¼Œå°±ä¼šå‘ç”Ÿï¼š</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">æŒ‚èµ·ä¿¡å·é›†åˆä¸­çš„ç›¸å…³ä½æ¸…é›¶ï¼ˆä¿¡å·ä»é›†åˆä¸­ç§»é™¤ï¼‰ã€‚</li>
<li data-line="1" dir="auto">å¦‚æœä¿¡å·å¤„ç†å‡½æ•°æ˜¯ä½¿ç”¨<code>sigaction</code>ç³»ç»Ÿè°ƒç”¨æ³¨å†Œçš„ï¼Œå¹¶ä¸”æŒ‡å®šäº†<code>SA_ONSTACK</code>æ ‡å¿—ã€‚å†…æ ¸ä¼šä¸ºä¿¡å·å¤„ç†å‡½æ•°åŠ è½½ä¸€ä¸ªå•ç‹¬çš„ä¿¡å·æ ˆï¼ˆé»˜è®¤ä¿¡å·çš„æœåŠ¡ä¾‹ç¨‹åœ¨è¿›ç¨‹çš„æ ˆç©ºé—´ä¸­å»ºç«‹æ ˆå¸§ï¼‰ã€‚</li>
<li data-line="2" dir="auto">å’Œä¸­æ–­ç±»ä¼¼çš„ï¼Œæ‰§è¡Œhandlerå‰ï¼Œæˆ‘ä»¬è¿˜è¦å°†ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ä¿å­˜åˆ°ä¸€ä¸ªæ ˆå¸§é‡Œï¼Œä¾¿äºä¿¡å·å¤„ç†å®Œæ¯•åæ¢å¤ç»§ç»­æ‰§è¡Œã€‚</li>
<li data-line="3" dir="auto">ä¹‹åï¼Œå†…æ ¸ä¼šä¸ºä¿¡å·å¤„ç†ç¨‹åºæ„å»ºä¸€ä¸ªæ ˆå¸§ï¼Œè®¾ç½®PCä¸ºæŒ‡å‘ä¿¡å·å¤„ç†ç¨‹åºå‡½æ•°çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚</li>
<li data-line="4" dir="auto">å†…æ ¸å°†æ§åˆ¶æƒäº¤ç»™ç”¨æˆ·ç©ºé—´ï¼Œä¿¡å·å¤„ç†ç¨‹åºå¼€å§‹å¤„ç†ã€‚å®Œæˆåå°†æ§åˆ¶æƒäº¤ç»™signal trampolineã€‚</li>
<li data-line="5" dir="auto">signal trampolineè°ƒç”¨<code>sigreturn(2)</code>ï¼Œè¿™ä¸ªç³»ç»Ÿè°ƒç”¨å’Œæ¢å¤ä¸Šä¸‹æ–‡ï¼Œç»§ç»­æ‰§è¡Œæœ‰å…³ã€‚</li>
</ol></div><div class="el-p"><p dir="auto">ä»å†…æ ¸çš„è§’åº¦æ¥çœ‹ï¼Œä¿¡å·å¤„ç†ç¨‹åºä»£ç çš„æ‰§è¡Œä¸ä»»ä½•å…¶ä»–ç”¨æˆ·ç©ºé—´ä»£ç çš„æ‰§è¡Œå®Œå…¨ç›¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå†…æ ¸ä¸ä¼šè®°å½•ä»»ä½•ç‰¹æ®Šçš„çŠ¶æ€ä¿¡æ¯æ¥æŒ‡ç¤ºçº¿ç¨‹å½“å‰æ­£åœ¨æ‰§è¡Œä¿¡å·å¤„ç†ç¨‹åºã€‚æ‰€æœ‰å¿…è¦çš„çŠ¶æ€ä¿¡æ¯éƒ½ä¿å­˜åœ¨ç”¨æˆ·ç©ºé—´çš„å¯„å­˜å™¨å’Œç”¨æˆ·ç©ºé—´æ ˆä¸­ã€‚åµŒå¥—ä¿¡å·å¤„ç†ç¨‹åºçš„è°ƒç”¨æ·±åº¦ä»…å—ç”¨æˆ·ç©ºé—´æ ˆçš„é™åˆ¶ï¼ˆä»¥åŠåˆç†çš„è½¯ä»¶è®¾è®¡ï¼‰ã€‚</p></div></div></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="5.2 Signal Handling in Practice" dir="auto" class="heading" id="5.2_Signal_Handling_in_Practice"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>5.2 Signal Handling in Practice</h3><div class="heading-children"><div class="el-pre"><pre class="language-c" tabindex="0"><code data-line="0" class="language-c is-loaded"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>handler<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 
Parameters:
	1. sig: The signal number to be handled. Common signals include SIGINT, SIGTERM, SIGKILL, etc.
	2. handler: A pointer to the signal handling function. This function takes a single argument of type int (the signal number) and returns void.
		- SIG_IGN: Ignore the signal.
		- SIG_DFL: Treat signal as its default manner.
		- Your own handler.

Return value:
	- On success: Returns the previous signal handler.
	- On failure: Returns SIG_ERR and sets errno appropriately.
*/</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="The Null Signal" dir="auto" class="heading" id="The_Null_Signal"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>The Null Signal</h3><div class="heading-children"><div class="el-p"><p dir="auto">null ä¿¡å·ï¼ˆä¿¡å·å€¼ä¸º 0ï¼‰æ˜¯ Unix-like ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç‰¹æ®Šä¿¡å·ã€‚åœ¨å‰é¢ï¼Œæˆ‘ä»¬çœ‹åˆ°è®°å½•ä¿¡å·çš„ç»“æ„ <code>sigset_t</code> åªæœ‰ 64 ä½ã€‚æ‰€ä»¥ null ä¿¡å·å®é™…ä¸Šä¸å­˜åœ¨ï¼Œä»–æ²¡æœ‰ä»»ä½• default actionï¼Œå®ƒå”¯ä¸€çš„ä½œç”¨å°±æ˜¯æµ‹è¯•ã€‚ç”¨äºæ£€æµ‹è¿›ç¨‹æ˜¯å¦å­˜åœ¨æˆ–æµ‹è¯•ç”¨æˆ·æƒé™ã€‚</p></div><div class="el-pre"><pre class="language-cpp" tabindex="0"><code data-line="0" class="language-cpp is-loaded"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kill</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// the process exists and we have promission to send a signal</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// the process is non-existing, or we don't have much promission</span>
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="mod-footer mod-ui"></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#6.5 Inter-Process Communications"><div class="tree-item-contents heading-link" heading-name="6.5 Inter-Process Communications"><span class="tree-item-title">6.5 Inter-Process Communications</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#ç¬¬ä¸€è¯¾_IPC"><div class="tree-item-contents heading-link" heading-name="ç¬¬ä¸€è¯¾ IPC"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">ç¬¬ä¸€è¯¾ IPC</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#1.1_IPC_Motivation"><div class="tree-item-contents heading-link" heading-name="1.1 IPC Motivation"><span class="tree-item-title">1.1 IPC Motivation</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#1.3_IPC_Types"><div class="tree-item-contents heading-link" heading-name="1.3 IPC Types"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">1.3 IPC Types</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#1.3.1_IPC_on_the_Same_Machine"><div class="tree-item-contents heading-link" heading-name="1.3.1 IPC on the Same Machine"><span class="tree-item-title">1.3.1 IPC on the Same Machine</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#1.3.2_IPC_on_Different_Machines"><div class="tree-item-contents heading-link" heading-name="1.3.2 IPC on Different Machines"><span class="tree-item-title">1.3.2 IPC on Different Machines</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#1.3_Send-Receive_Protocol"><div class="tree-item-contents heading-link" heading-name="1.3 Send-Receive Protocol"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">1.3 Send-Receive Protocol</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#1.3.1_Formats"><div class="tree-item-contents heading-link" heading-name="1.3.1 Formats"><span class="tree-item-title">1.3.1 Formats</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#1.3.2_Order"><div class="tree-item-contents heading-link" heading-name="1.3.2 Order"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">1.3.2 Order</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#1.3.2.1_Synchronous"><div class="tree-item-contents heading-link" heading-name="1.3.2.1 Synchronous"><span class="tree-item-title">1.3.2.1 Synchronous</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#1.3.2.2_Asynchronous"><div class="tree-item-contents heading-link" heading-name="1.3.2.2 Asynchronous"><span class="tree-item-title">1.3.2.2 Asynchronous</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#ç¬¬äºŒè¯¾_Sockets_for_Network_Communication"><div class="tree-item-contents heading-link" heading-name="ç¬¬äºŒè¯¾ Sockets for Network Communication"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">ç¬¬äºŒè¯¾ Sockets for Network Communication</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.1_Sockets"><div class="tree-item-contents heading-link" heading-name="2.1 Sockets"><span class="tree-item-title">2.1 Sockets</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2_Sockets_as_Files"><div class="tree-item-contents heading-link" heading-name="2.2 Sockets as Files"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2 Sockets as Files</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.1_socket()_Attr."><div class="tree-item-contents heading-link" heading-name="2.2.1 socket() Attr."><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2.1 socket() Attr.</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.1.1_`domain`"><div class="tree-item-contents heading-link" heading-name="2.2.1.1 `domain`"><span class="tree-item-title">2.2.1.1 <code>domain</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.1.2_`type`"><div class="tree-item-contents heading-link" heading-name="2.2.1.2 `type`"><span class="tree-item-title">2.2.1.2 <code>type</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.1.3_`protocol`"><div class="tree-item-contents heading-link" heading-name="2.2.1.3 `protocol`"><span class="tree-item-title">2.2.1.3 <code>protocol</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.1.4_Illegal_Combination"><div class="tree-item-contents heading-link" heading-name="2.2.1.4 Illegal Combination"><span class="tree-item-title">2.2.1.4 Illegal Combination</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.2_Creating_an_Socket"><div class="tree-item-contents heading-link" heading-name="2.2.2 Creating an Socket"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2.2 Creating an Socket</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.2.1_TCP_Sockets_in_IPv4"><div class="tree-item-contents heading-link" heading-name="2.2.2.1 TCP Sockets in IPv4"><span class="tree-item-title">2.2.2.1 TCP Sockets in IPv4</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.2.2_UDP_Sockets_in_IPv4"><div class="tree-item-contents heading-link" heading-name="2.2.2.2 UDP Sockets in IPv4"><span class="tree-item-title">2.2.2.2 UDP Sockets in IPv4</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.3._`setsockopt()`"><div class="tree-item-contents heading-link" heading-name="2.2.3. `setsockopt()`"><span class="tree-item-title">2.2.3. <code>setsockopt()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.4_Endianness_and_Network_Byte_Order"><div class="tree-item-contents heading-link" heading-name="2.2.4 Endianness and Network Byte Order"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2.4 Endianness and Network Byte Order</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.4.1_Host&nbsp;and&nbsp;Network&nbsp;Byte&nbsp;Order&nbsp;Conversion"><div class="tree-item-contents heading-link" heading-name="2.2.4.1 Host&nbsp;and&nbsp;Network&nbsp;Byte&nbsp;Order&nbsp;Conversion"><span class="tree-item-title">2.2.4.1 Host&nbsp;and&nbsp;Network&nbsp;Byte&nbsp;Order&nbsp;Conversion</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.4.2_Decimal_Presentation_and&nbsp;Network_Byte_Order_Address_Conversion"><div class="tree-item-contents heading-link" heading-name="2.2.4.2 Decimal Presentation and&nbsp;Network Byte Order Address Conversion"><span class="tree-item-title">2.2.4.2 Decimal Presentation and&nbsp;Network Byte Order Address Conversion</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.5_Socket_Addresses"><div class="tree-item-contents heading-link" heading-name="2.2.5 Socket Addresses"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.2.5 Socket Addresses</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.5.1_IPv4_Address"><div class="tree-item-contents heading-link" heading-name="2.2.5.1 IPv4 Address"><span class="tree-item-title">2.2.5.1 IPv4 Address</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.5.2_IPv6_Address"><div class="tree-item-contents heading-link" heading-name="2.2.5.2 IPv6 Address"><span class="tree-item-title">2.2.5.2 IPv6 Address</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.5.3_Local_Domain_Address"><div class="tree-item-contents heading-link" heading-name="2.2.5.3 Local Domain Address"><span class="tree-item-title">2.2.5.3 Local Domain Address</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.5.4_Port_Number:_Just_Like_the_House_Number"><div class="tree-item-contents heading-link" heading-name="2.2.5.4 Port Number: Just Like the House Number"><span class="tree-item-title">2.2.5.4 Port Number: Just Like the House Number</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.5.5_String_<--->_IP_Address"><div class="tree-item-contents heading-link" heading-name="2.2.5.5 String <---> IP Address"><span class="tree-item-title">2.2.5.5 String &lt;---&gt; IP Address</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.5.6_Initial_the_Network_Address_(IPv4)"><div class="tree-item-contents heading-link" heading-name="2.2.5.6 Initial the Network Address (IPv4)"><span class="tree-item-title">2.2.5.6 Initial the Network Address (IPv4)</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.2.6_Get_the_Address"><div class="tree-item-contents heading-link" heading-name="2.2.6 Get the Address"><span class="tree-item-title">2.2.6 Get the Address</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.3_Client_Workflow:_Connect_(TCP)"><div class="tree-item-contents heading-link" heading-name="2.3 Client Workflow: Connect (TCP)"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.3 Client Workflow: Connect (TCP)</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.3.1_`connect()`"><div class="tree-item-contents heading-link" heading-name="2.3.1 `connect()`"><span class="tree-item-title">2.3.1 <code>connect()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.3.2_Say_Hello_to_Server"><div class="tree-item-contents heading-link" heading-name="2.3.2 Say Hello to Server"><span class="tree-item-title">2.3.2 Say Hello to Server</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.4_Server_Workflow:_Bind,_Listen_and_Accept_(TCP)"><div class="tree-item-contents heading-link" heading-name="2.4 Server Workflow: Bind, Listen and Accept (TCP)"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.4 Server Workflow: Bind, Listen and Accept (TCP)</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.4.1_`bind()`"><div class="tree-item-contents heading-link" heading-name="2.4.1 `bind()`"><span class="tree-item-title">2.4.1 <code>bind()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.4.2_`listen()`"><div class="tree-item-contents heading-link" heading-name="2.4.2 `listen()`"><span class="tree-item-title">2.4.2 <code>listen()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.4.3_`accept()`"><div class="tree-item-contents heading-link" heading-name="2.4.3 `accept()`"><span class="tree-item-title">2.4.3 <code>accept()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.5_Communication_(TCP)"><div class="tree-item-contents heading-link" heading-name="2.5 Communication (TCP)"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.5 Communication (TCP)</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.5.1_`send()`"><div class="tree-item-contents heading-link" heading-name="2.5.1 `send()`"><span class="tree-item-title">2.5.1 <code>send()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.5.2_`recv()`"><div class="tree-item-contents heading-link" heading-name="2.5.2 `recv()`"><span class="tree-item-title">2.5.2 <code>recv()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.5.3_Are_You_Still_There?"><div class="tree-item-contents heading-link" heading-name="2.5.3 Are You Still There?"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.5.3 Are You Still There?</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.5.3.1_TCP_Keep-Alive"><div class="tree-item-contents heading-link" heading-name="2.5.3.1 TCP Keep-Alive"><span class="tree-item-title">2.5.3.1 TCP Keep-Alive</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.5.3.2_Timeouts"><div class="tree-item-contents heading-link" heading-name="2.5.3.2 Timeouts"><span class="tree-item-title">2.5.3.2 Timeouts</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.5.3.3_Heartbeat_Messages"><div class="tree-item-contents heading-link" heading-name="2.5.3.3 Heartbeat Messages"><span class="tree-item-title">2.5.3.3 Heartbeat Messages</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.5.4_Use_Format_to_Serialization"><div class="tree-item-contents heading-link" heading-name="2.5.4 Use Format to Serialization"><span class="tree-item-title">2.5.4 Use Format to Serialization</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.6_Datagrams"><div class="tree-item-contents heading-link" heading-name="2.6 Datagrams"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.6 Datagrams</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.6.1_sendto()"><div class="tree-item-contents heading-link" heading-name="2.6.1 sendto()"><span class="tree-item-title">2.6.1 sendto()</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.6.2_recvfrom()"><div class="tree-item-contents heading-link" heading-name="2.6.2 recvfrom()"><span class="tree-item-title">2.6.2 recvfrom()</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.7_cURL_(libcurl)"><div class="tree-item-contents heading-link" heading-name="2.7 cURL (libcurl)"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.7 cURL (libcurl)</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.7.1_Webservices"><div class="tree-item-contents heading-link" heading-name="2.7.1 Webservices"><span class="tree-item-title">2.7.1 Webservices</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.7.2_Callbacks_Setting_Up"><div class="tree-item-contents heading-link" heading-name="2.7.2 Callbacks Setting Up"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">2.7.2 Callbacks Setting Up</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.7.2.1_Read_Callback"><div class="tree-item-contents heading-link" heading-name="2.7.2.1 Read Callback"><span class="tree-item-title">2.7.2.1 Read Callback</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.7.2.2_Write_Callback"><div class="tree-item-contents heading-link" heading-name="2.7.2.2 Write Callback"><span class="tree-item-title">2.7.2.2 Write Callback</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#2.7.2.3_Registration_of_Callback"><div class="tree-item-contents heading-link" heading-name="2.7.2.3 Registration of Callback"><span class="tree-item-title">2.7.2.3 Registration of Callback</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#ç¬¬ä¸‰è¯¾_Pipes_and_Shared_Memory"><div class="tree-item-contents heading-link" heading-name="ç¬¬ä¸‰è¯¾ Pipes and Shared Memory"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">ç¬¬ä¸‰è¯¾ Pipes and Shared Memory</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.1_UNIX_Pipes"><div class="tree-item-contents heading-link" heading-name="3.1 UNIX Pipes"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.1 UNIX Pipes</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.1.1_Ordinary_Pipes(Anonymous_Pipes)"><div class="tree-item-contents heading-link" heading-name="3.1.1 Ordinary Pipes(Anonymous Pipes)"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.1.1 Ordinary Pipes(Anonymous Pipes)</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.1.1.1_Creating_an_Anonymous_Pipe"><div class="tree-item-contents heading-link" heading-name="3.1.1.1 Creating an Anonymous Pipe"><span class="tree-item-title">3.1.1.1 Creating an Anonymous Pipe</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.1.2_FIFO_(Named_Pipe)"><div class="tree-item-contents heading-link" heading-name="3.1.2 FIFO (Named Pipe)"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.1.2 FIFO (Named Pipe)</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.1.2.1_Creating_a_Named_Pipe"><div class="tree-item-contents heading-link" heading-name="3.1.2.1 Creating a Named Pipe"><span class="tree-item-title">3.1.2.1 Creating a Named Pipe</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.1.3_Pipe_and_Disk_I/O"><div class="tree-item-contents heading-link" heading-name="3.1.3 Pipe and Disk I/O"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.1.3 Pipe and Disk I/O</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.1.3.1_Anonymous_Pipes_Have_Nothing_To_Do_with_Disk"><div class="tree-item-contents heading-link" heading-name="3.1.3.1 Anonymous Pipes Have Nothing To Do with Disk"><span class="tree-item-title">3.1.3.1 Anonymous Pipes Have Nothing To Do with Disk</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.1.3.2_Named_Pipes_Use_Disk_I/O"><div class="tree-item-contents heading-link" heading-name="3.1.3.2 Named Pipes Use Disk I/O"><span class="tree-item-title">3.1.3.2 Named Pipes Use Disk I/O</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2_Shared_Memory"><div class="tree-item-contents heading-link" heading-name="3.2 Shared Memory"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.2 Shared Memory</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.1&nbsp;shm&nbsp;in&nbsp;POSIX"><div class="tree-item-contents heading-link" heading-name="3.2.1&nbsp;shm&nbsp;in&nbsp;POSIX"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.2.1&nbsp;shm&nbsp;in&nbsp;POSIX</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.1.1_`shm_open()`"><div class="tree-item-contents heading-link" heading-name="3.2.1.1 `shm_open()`"><span class="tree-item-title">3.2.1.1 <code>shm_open()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.1.2_`ftruncate()`"><div class="tree-item-contents heading-link" heading-name="3.2.1.2 `ftruncate()`"><span class="tree-item-title">3.2.1.2 <code>ftruncate()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.1.3_`close()`"><div class="tree-item-contents heading-link" heading-name="3.2.1.3 `close()`"><span class="tree-item-title">3.2.1.3 <code>close()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.1.4_`shm_unlink()`"><div class="tree-item-contents heading-link" heading-name="3.2.1.4 `shm_unlink()`"><span class="tree-item-title">3.2.1.4 <code>shm_unlink()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.1.5_Manipulate_a_shm_Object"><div class="tree-item-contents heading-link" heading-name="3.2.1.5 Manipulate a shm Object"><span class="tree-item-title">3.2.1.5 Manipulate a shm Object</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.1.6_Shared_Memory_Implementation_Mechanism_|_POSIX"><div class="tree-item-contents heading-link" heading-name="3.2.1.6 Shared Memory Implementation Mechanism | POSIX"><span class="tree-item-title">3.2.1.6 Shared Memory Implementation Mechanism | POSIX</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.2&nbsp;shm&nbsp;in&nbsp;System&nbsp;V"><div class="tree-item-contents heading-link" heading-name="3.2.2&nbsp;shm&nbsp;in&nbsp;System&nbsp;V"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.2.2&nbsp;shm&nbsp;in&nbsp;System&nbsp;V</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.2.1_shm_Get"><div class="tree-item-contents heading-link" heading-name="3.2.2.1 shm Get"><span class="tree-item-title">3.2.2.1 shm Get</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.2.2_shm_Attachment"><div class="tree-item-contents heading-link" heading-name="3.2.2.2 shm Attachment"><span class="tree-item-title">3.2.2.2 shm Attachment</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.2.3_shm_Detachment"><div class="tree-item-contents heading-link" heading-name="3.2.2.3 shm Detachment"><span class="tree-item-title">3.2.2.3 shm Detachment</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.2.2.4_shm_Control"><div class="tree-item-contents heading-link" heading-name="3.2.2.4 shm Control"><span class="tree-item-title">3.2.2.4 shm Control</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.3_Message_Queue"><div class="tree-item-contents heading-link" heading-name="3.3 Message Queue"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.3 Message Queue</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.3.1_Message_Queue_in_POSIX"><div class="tree-item-contents heading-link" heading-name="3.3.1 Message Queue in POSIX"><span class="tree-item-title">3.3.1 Message Queue in POSIX</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.3.2_Message_Queue_in_System_V"><div class="tree-item-contents heading-link" heading-name="3.3.2 Message Queue in System V"><span class="tree-item-title">3.3.2 Message Queue in System V</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.4_IPC_Comparisons"><div class="tree-item-contents heading-link" heading-name="3.4 IPC Comparisons"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">3.4 IPC Comparisons</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.4.1_Shared_Memory_in_Differnet_Standards"><div class="tree-item-contents heading-link" heading-name="3.4.1 Shared Memory in Differnet Standards"><span class="tree-item-title">3.4.1 Shared Memory in Differnet Standards</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.4.2_Shared_Memory_vs._Pipes"><div class="tree-item-contents heading-link" heading-name="3.4.2 Shared Memory vs. Pipes"><span class="tree-item-title">3.4.2 Shared Memory vs. Pipes</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#3.4.3_Pipes_vs._Message_Queue"><div class="tree-item-contents heading-link" heading-name="3.4.3 Pipes vs. Message Queue"><span class="tree-item-title">3.4.3 Pipes vs. Message Queue</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#ç¬¬å››è¯¾_Memory_Mapped_Files"><div class="tree-item-contents heading-link" heading-name="ç¬¬å››è¯¾ Memory Mapped Files"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">ç¬¬å››è¯¾ Memory Mapped Files</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#4.1_How_Files_are_Opened"><div class="tree-item-contents heading-link" heading-name="4.1 How Files are Opened"><span class="tree-item-title">4.1 How Files are Opened</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#4.2_Memory_Mapping_Files_Implementation:`mmap()`"><div class="tree-item-contents heading-link" heading-name="4.2 Memory Mapping Files Implementation:`mmap()`"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">4.2 Memory Mapping Files Implementation:<code>mmap()</code></span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#4.2.1_`mmap()`"><div class="tree-item-contents heading-link" heading-name="4.2.1 `mmap()`"><span class="tree-item-title">4.2.1 <code>mmap()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#4.2.2_Protection_Access_Modification:_`mprotect()`"><div class="tree-item-contents heading-link" heading-name="4.2.2 Protection Access Modification: `mprotect()`"><span class="tree-item-title">4.2.2 Protection Access Modification: <code>mprotect()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#4.2.3_Mapping_Consistency_Guarantee_:_`msync()"><div class="tree-item-contents heading-link" heading-name="4.2.3 Mapping Consistency Guarantee : `msync()"><span class="tree-item-title">4.2.3 Mapping Consistency Guarantee : `msync()</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#4.2.4_Memory_Un-Mapping_:_`munmap()`"><div class="tree-item-contents heading-link" heading-name="4.2.4 Memory Un-Mapping : `munmap()`"><span class="tree-item-title">4.2.4 Memory Un-Mapping : <code>munmap()</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#4.3_IPC_with_`mmap()`"><div class="tree-item-contents heading-link" heading-name="4.3 IPC with `mmap()`"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">4.3 IPC with <code>mmap()</code></span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#4.3.1_`MAP_PRIVATE`_and_`MAP_SHARED`"><div class="tree-item-contents heading-link" heading-name="4.3.1 `MAP_PRIVATE` and `MAP_SHARED`"><span class="tree-item-title">4.3.1 <code>MAP_PRIVATE</code> and <code>MAP_SHARED</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#4.3.2_Anonymous_Mapping"><div class="tree-item-contents heading-link" heading-name="4.3.2 Anonymous Mapping"><span class="tree-item-title">4.3.2 Anonymous Mapping</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#4.4_Easy_Peasy_Example"><div class="tree-item-contents heading-link" heading-name="4.4 Easy Peasy Example"><span class="tree-item-title">4.4 Easy Peasy Example</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#ç¬¬äº”è¯¾_IPC_for_Process_Control:_Signals"><div class="tree-item-contents heading-link" heading-name="ç¬¬äº”è¯¾ IPC for Process Control: Signals"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">ç¬¬äº”è¯¾ IPC for Process Control: Signals</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.1_Signaling_vs._Exception"><div class="tree-item-contents heading-link" heading-name="5.1 Signaling vs. Exception"><span class="tree-item-title">5.1 Signaling vs. Exception</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.2_Signal_Control"><div class="tree-item-contents heading-link" heading-name="5.2 Signal Control"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">5.2 Signal Control</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.2.1_Kernel_Data_Structure_(`include/linux/sched/signal.h`)"><div class="tree-item-contents heading-link" heading-name="5.2.1 Kernel Data Structure (`include/linux/sched/signal.h`)"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">5.2.1 Kernel Data Structure (<code>include/linux/sched/signal.h</code>)</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.2.1.1_`struct_signal_struct`"><div class="tree-item-contents heading-link" heading-name="5.2.1.1 `struct signal_struct`"><span class="tree-item-title">5.2.1.1 <code>struct signal_struct</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.2.1.2_`typedef_unsigned_long_sigset_t`"><div class="tree-item-contents heading-link" heading-name="5.2.1.2 `typedef unsigned long sigset_t`"><span class="tree-item-title">5.2.1.2 <code>typedef unsigned long sigset_t</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="5"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.2.1.3_`sighand_struct`"><div class="tree-item-contents heading-link" heading-name="5.2.1.3 `sighand_struct`"><span class="tree-item-title">5.2.1.3 <code>sighand_struct</code></span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.1.3_Signal_Blocking_and_Signal_Pending"><div class="tree-item-contents heading-link" heading-name="5.1.3 Signal Blocking and Signal Pending"><span class="tree-item-title">5.1.3 Signal Blocking and Signal Pending</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.3_Signal_Handling"><div class="tree-item-contents heading-link" heading-name="5.3 Signal Handling"><span class="tree-item-title">5.3 Signal Handling</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.4_Signal_Sending_and_Receiving"><div class="tree-item-contents heading-link" heading-name="5.4 Signal Sending and Receiving"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">5.4 Signal Sending and Receiving</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.4.1_Sending_a_Signal"><div class="tree-item-contents heading-link" heading-name="5.4.1 Sending a Signal"><span class="tree-item-title">5.4.1 Sending a Signal</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.4.2_Waiting_for_a_Signal_to_be_Caught"><div class="tree-item-contents heading-link" heading-name="5.4.2 Waiting for a Signal to be Caught"><span class="tree-item-title">5.4.2 Waiting for a Signal to be Caught</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.4.3_Receiving_a_Signal"><div class="tree-item-contents heading-link" heading-name="5.4.3 Receiving a Signal"><span class="tree-item-title">5.4.3 Receiving a Signal</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="4"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.1.4_Execution_of_Signal_Handler"><div class="tree-item-contents heading-link" heading-name="5.1.4 Execution of Signal Handler"><span class="tree-item-title">5.1.4 Execution of Signal Handler</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#5.2_Signal_Handling_in_Practice"><div class="tree-item-contents heading-link" heading-name="5.2 Signal Handling in Practice"><span class="tree-item-title">5.2 Signal Handling in Practice</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="congzhi's-os-series\6.5-inter-process-communications.html#The_Null_Signal"><div class="tree-item-contents heading-link" heading-name="The Null Signal"><span class="tree-item-title">The Null Signal</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>